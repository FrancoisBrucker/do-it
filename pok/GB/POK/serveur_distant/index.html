
<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

    <title>Serveur Distant</title>

    <link href=/do-it/assets/node_modules/prismjs/themes/prism-solarizedlight.min.css rel="stylesheet">
    <link href=/do-it/assets/node_modules/prismjs/plugins/line-numbers/prism-line-numbers.min.css rel="stylesheet">

    <link href=/do-it/assets/stylesheets/main.css rel="stylesheet">
  </head>
  <body>
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [
            [
              '$', '$'
            ],
            [
              '\\(', '\\)'
            ]
          ]
        },
        svg: {
          fontCache: 'global'
        }
      };
    </script>
    <script type="text/javascript" id="MathJax-script" 
  src=/do-it/assets/node_modules/mathjax/es5/tex-svg-full.js></script>

    <header class="border-b-2 border-gray-200 mb-4">
      <div class="max-w-[1000px] mx-auto px-4">
        <div class="min-h-[50px] flex justify-between items-center">
          <a class="mx-2" href="/do-it/">Home</a>
          <a class="mx-2" href="/do-it/about">About</a>
        </div>
      </div>
    </header>

    <main class="max-w-[1000px] mx-auto px-4">

      
<article>
  <h1  class="mb-1">Serveur Distant</h1>
  <div class="mb-4">
    

    
      <div class=" px-4 flex items-center">
        
          <div class="font-bold">Auteur : </div>
        
        <ul class="flex not-prose list-none my-0 last:after:content-['•'] last:after:px-1 mx-0 px-1">
          
            <li class="before:content-['•'] before:px-1">Gabriel BARBE</li>
          
        </ul>
      </div>
    
  </div>

  

  <!-- Début Résumé -->
<p>POK visant à reproduire le site effectué dans le temps mais sur un serveur distant et en y rajoutant du back-end.</p>
<!-- Fin Résumé -->
<h1>Organisation</h1>
<p>Dans un premier temps, ajouter du back-end grâce au MON suivi sur le site de M. Brucker puis dans un second temps l'implémenter sur un serveur distant.<br>
TO do-list :<br>
Sprint 1 :</p>
<ul>
<li>Ramener le site sur l'ovh</li>
<li>Gérer des cookies pour implémenter une page de connexion<br>
<br><br>
Sprint 2 :</li>
<li>Insérer une base de donnée</li>
<li>Gérer le backend en node</li>
<li>Si le temps le permet voir un peu pour la sécurité</li>
</ul>
<h3>Nouveau projet Express</h3>
<p>Pour le développement du projet, j'ai choisi de le faire via Express car c'est ce que recommandait M. Brucker et donc dans un premier temps je crée un nouveau projet à l'adresse <a href="http://localhost:3000/">http://localhost:3000/</a>. <br><br>
Concernant la base de données et le langage associée à utiliser, j'ai longtemps hésité mais j'ai finalement décidé de suivre l'exemple associé à Express sur &quot;<a href="http://developer.mozilla.org">http://developer.mozilla.org</a>&quot; et donc d'utiliser l'ORM Mongoose associée à une base de données MangoDB.</p>
<h3>Création de la base de données</h3>
<p>Afin de compléter mon premier site, j'ai eu pour idée d'ajouter une option permettant de sélectionner un champion et un pays : ainsi J1 sera désigné par le champion Zidane ou le pays Brésil. Le but est donc de créer une base de données avec 5 champions et 5 pays. J'ai repris en grande partie le code visible sur <a href="../../../mon/GB/Mons/coteweb">mon MON</a> que j'ai personnalisé afin d'y mettre mes exigences. Le champion devra donc avoir les caractéristiques &quot;nom&quot;, &quot;prénom&quot; et &quot;numéro&quot; ; le pays, lui, sera associé aux caractéristiques &quot;nom&quot; et &quot;couleur&quot;. Ci-dessous le code concernant le champion :</p>
<pre class="language-bash " style="counter-reset: linenumber 0"><code class="language-bash">const mongoose <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">"mongoose"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

const Schema <span class="token operator">=</span> mongoose.Schema<span class="token punctuation">;</span>

const JoueurSchema <span class="token operator">=</span> new Schema<span class="token punctuation">(</span><span class="token punctuation">{</span>
  first_name: <span class="token punctuation">{</span> type: String, required: true, maxLength: <span class="token number">100</span> <span class="token punctuation">}</span>,
  family_name: <span class="token punctuation">{</span> type: String, required: true, maxLength: <span class="token number">100</span> <span class="token punctuation">}</span>,
  number:<span class="token punctuation">{</span> type: Number, required: true, maxLength:2<span class="token punctuation">}</span>,
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

JoueurSchema.virtual<span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span>.get<span class="token punctuation">(</span><span class="token function-name function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  // To avoid errors <span class="token keyword">in</span> cases where an author does not have either a family name or first name
  // We want to <span class="token function">make</span> sure we handle the exception by returning an empty string <span class="token keyword">for</span> that <span class="token keyword">case</span>
  <span class="token builtin class-name">let</span> fullname <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>this.first_name <span class="token operator">&amp;&amp;</span> this.family_name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fullname <span class="token operator">=</span> <span class="token variable"><span class="token variable">`</span>$<span class="token punctuation">{</span>this.family_name<span class="token punctuation">}</span>, $<span class="token punctuation">{</span>this.first_name<span class="token punctuation">}</span><span class="token variable">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>this.first_name <span class="token operator">||</span> <span class="token operator">!</span>this.family_name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fullname <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token builtin class-name">return</span> fullname<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

JoueurSchema.virtual<span class="token punctuation">(</span><span class="token string">"url"</span><span class="token punctuation">)</span>.get<span class="token punctuation">(</span><span class="token function-name function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin class-name">return</span> <span class="token variable"><span class="token variable">`</span>/catalog/joueur/$<span class="token punctuation">{</span>this._id<span class="token punctuation">}</span><span class="token variable">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

// Export model
module.exports <span class="token operator">=</span> mongoose.model<span class="token punctuation">(</span><span class="token string">"Joueur"</span>, JoueurSchema<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<pre class="language-bash " style="counter-reset: linenumber 0"><code class="language-bash"><span class="token keyword">function</span> JoueurCreate<span class="token punctuation">(</span>first_name, family_name, number, cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  joueurdetail <span class="token operator">=</span> <span class="token punctuation">{</span>first_name:first_name , family_name: family_name, number:number<span class="token punctuation">}</span>
  
  var joueur <span class="token operator">=</span> new Joueur<span class="token punctuation">(</span>joueurdetail<span class="token punctuation">)</span><span class="token punctuation">;</span>
       
  joueur.save<span class="token punctuation">(</span>function <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      cb<span class="token punctuation">(</span>err, null<span class="token punctuation">)</span>
      <span class="token builtin class-name">return</span>
    <span class="token punctuation">}</span>
    console.log<span class="token punctuation">(</span><span class="token string">'New Joueur: '</span> + joueur<span class="token punctuation">)</span><span class="token punctuation">;</span>
    joueurs.push<span class="token punctuation">(</span>joueur<span class="token punctuation">)</span>
    cb<span class="token punctuation">(</span>null, joueur<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h3>Routes</h3>
<p>Nous en arrivons ici à la partie création des routes pour notre site sur le serveur. En premier lieu, nous crééons un dossier &quot;controllers&quot; où l'on mettra,  pour chaque fichier de notre base de donées, les requêtes de création, d'affichages, de supression etc. Ensuite, nous crééons un fichier javascript &quot;catalog.js&quot; où l'on définit les routes de notre site à proprement parlé. J'obtients donc les routes suivantes :</p>
<ul>
<li><a href="http://localhost3000/catalog">http://localhost3000/catalog</a></li>
<li><a href="http://localhost:3000/catalog/pays">http://localhost:3000/catalog/pays</a></li>
<li><a href="http://localhost:3000/catalog/joueurs">http://localhost:3000/catalog/joueurs</a></li>
<li><a href="http://localhost:3000/users">http://localhost:3000/users</a><br>
Ici, la route &quot;catalogue&quot; n'a pas de sens en soi, j'ai simplement utilisé des fichiers similaires à mon cours afin de ne pas me perdre. Les routes pays et joueurs sont pour le moment vide car on n'y a pas encore implenté la base de données.<br>
<img src="C:\do-it\src\pok\GB\POK\images\routes.png"/></li>
</ul>
<h3>Etablissement des premières pages</h3>
<p>On arrive donc à une partie plus intéressante, celle de la liaison entre ma première partie, le front-end, et mon site actuellement hébérgé sur un serveur.<br>
Pour ce faire, nous utilisons pug (choix par défaut du cours que je regrette un peu à ce moment car je dois réadapter certains de mes codes sources).<br><br>
Dans les dossiers créés lors de l'utilisation d'express, nous avons un dossier &quot;views&quot;. Comme son nom l'indique, celui-ci contiendra les interfaces vus par l'utilisateur. J'implémente donc mon code html &quot;PFC&quot; dans le fichier &quot;index.pug&quot;. C'est à ce moment que cela se complique car bien que pug reprend complétement l'idée de html, il y'a tout de même de nombreux changements à opérer dans un langage que je ne connais pas.</p>
<h1>Fin du sprint 1</h1>
<h3>Ce qu'il reste à faire</h3>
<p>Comme on peut le voir, il reste de nombreuses choses à effectuer, j'ai désormais plus de visibilité sur l'ensemble du projet :</p>
<ul>
<li>Adapter mon script afin que le site marche comme avant</li>
<li>Je pense à modifier la base de données afin que celle-ci soit juste un historique des anciens coups car l'objectif initiale demanderait beaucoup de changement sur le front et me limiterai dans la suite des évènement.</li>
<li>Ramener le site sur l'ovh une fois que tout cela sera fait</li>
<li>Insérer une page de connexion</li>
<li>Sécurité si le temps me le permet mais cela me parait compliqué.</li>
<li>Rajouter des routes pour amener aussi la partie de timothée sur le serveur</li>
</ul>


</article>

    </main>

    <footer class="min-h-[50px] border-t-2 border-gray-200 mt-4">
      <div class="max-w-[1000px] mx-auto px-4">
        <div class="min-h-[50px] flex justify-center items-center">
          <p>
            do-it : option de troisième année à l'école centrale Marseille
          </p>
        </div>
      </div>
    </footer>

    <script>
      MathJax
        .startup
        .document
        .getMathItemsWithin(document.body);
    </script>

  </body>
</html>
