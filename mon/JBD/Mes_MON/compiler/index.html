
<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

    <title>Compilateurs</title>

    <link href=/do-it/assets/node_modules/prismjs/themes/prism-solarizedlight.min.css rel="stylesheet">
    <link href=/do-it/assets/node_modules/prismjs/plugins/line-numbers/prism-line-numbers.min.css rel="stylesheet">

    <link href=/do-it/assets/stylesheets/main.css rel="stylesheet">
  </head>
  <body>
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [
            [
              '$', '$'
            ],
            [
              '\\(', '\\)'
            ]
          ]
        },
        svg: {
          fontCache: 'global'
        }
      };
    </script>
    <script type="text/javascript" id="MathJax-script" 
  src=/do-it/assets/node_modules/mathjax/es5/tex-svg-full.js></script>

    <header class="border-b-2 border-gray-200 mb-4">
      <div class="max-w-[1000px] mx-auto px-4">
        <div class="min-h-[50px] flex justify-between items-center">
          <a class="mx-2" href="/do-it/">Home</a>
          <a class="mx-2" href="/do-it/about">About</a>
        </div>
      </div>
    </header>

    <main class="max-w-[1000px] mx-auto px-4">

      
<article>
  <h1  class="mb-1">Compilateurs</h1>
  <div class="mb-4">
    
      <div class=" px-4 flex items-center">
        
          <div class="font-bold">Tags : </div>
        
        <ul class="flex not-prose list-none my-0 last:after:content-['•'] last:after:px-1 mx-0 px-1">
          
            <li class="before:content-['•'] before:px-1">Compilateur</li>
          
            <li class="before:content-['•'] before:px-1">Yacc et Lex</li>
          
            <li class="before:content-['•'] before:px-1">C</li>
          
            <li class="before:content-['•'] before:px-1">Structures de données</li>
          
        </ul>
      </div>
    

    
      <div class=" px-4 flex items-center">
        
          <div class="font-bold">Auteur : </div>
        
        <ul class="flex not-prose list-none my-0 last:after:content-['•'] last:after:px-1 mx-0 px-1">
          
            <li class="before:content-['•'] before:px-1">Jean-Baptiste Durand</li>
          
        </ul>
      </div>
    
  </div>

  

  <!-- début résumé -->
<p>Terminer le compilateur en ajoutant des fonctionnalités complexes (variables, boucles, fonctions)</p>
<!-- fin résumé -->
<div class="quote relative  py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-pink-500 bg-pink-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-pink-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
</svg>
<div class="pl-8 mr-8">
<p>La lecture de mon <a href="https://francoisbrucker.github.io/do-it/mon/JBD/Mes_MON/yaccLex/">premier MON</a> sur le sujet n'est pas nécessaire pour la compréhension de ce MON mais est important pour la compréhension du projet.</p>
</div></div>
<h2 id="toc"> Table des matières </h2>
<ul>
<li><a href="#toc">Table des matières</a></li>
<li><a href="#h1">Évolution du projet</a>
<ul>
<li><a href="#h1-1">Avant</a></li>
<li><a href="#h1-2">Après</a></li>
</ul>
</li>
<li><a href="#h2">Nouvelle utilisation de Yacc</a></li>
<li><a href="#h3">Construction de la liste d'exécution</a></li>
<li><a href="#h4">Structures de données</a>
<ul>
<li><a href="#h4-1">Stockage des variables</a></li>
<li><a href="#h4-2">Stockage des calculs</a></li>
<li><a href="#h4-3">Tableaux dynamiques</a></li>
</ul>
</li>
<li><a href="#liens">Liens Utiles</a></li>
</ul>
<h2 id="h1">Évolution du projet</h2>
<p>Le résultat obtenu après le premier MON n'était pas satisfaisant, et avait une utilité limité. C'est pourquoi j'ai décidé de reprendre le projet pour ce MON.</p>
<h3 id="h1-1">Avant</h3>
<pre class="language-python " style="counter-reset: linenumber 0"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">>=</span><span class="token number">1</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> <span class="token number">6</span><span class="token operator">!=</span><span class="token number">5</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="h1-2">Après</h3>
<div class="codeContainer">
<div style="width:26%;">
<p><strong>Condition</strong></p>
<pre class="language-js " style="counter-reset: linenumber 0"><code class="language-js"><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token function">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">print</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">print</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
  <span class="token function">print</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div>
<div style="width:32%;">
<p><strong>Loop</strong></p>
<pre class="language-js " style="counter-reset: linenumber 0"><code class="language-js"><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword">while</span><span class="token punctuation">(</span>j<span class="token operator">&lt;</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">print</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
  j <span class="token operator">=</span> j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">15</span><span class="token punctuation">;</span> i<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre>
</div>
<div style="width:38%;">
<p><strong>Function</strong></p>
<pre class="language-js " style="counter-reset: linenumber 0"><code class="language-js"><span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">let</span> var1<span class="token punctuation">,</span> <span class="token keyword">let</span> var2 <span class="token operator">=</span> <span class="token number">1</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> var1 <span class="token operator">+</span> var2<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">factoriel</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">let</span> nb</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>nb<span class="token operator">&lt;=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> nb<span class="token operator">*</span><span class="token function">factoriel</span><span class="token punctuation">(</span>nb<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
</div>
</div>
<h2 id="h2">Nouvelle utilisation de Yacc</h2>
<div class="quote relative drop-shadow  py-2 pr-2 rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-amber-800 bg-amber-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-amber-800" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
</svg>
<div class="pl-8 mr-8">
<p><strong>Rappel</strong> : Yacc est un générateur d’analyseur syntaxique, il va, l'aide de Lex, reconstruire la structure du document, en retrouvant des pattern. Ex : pour comprendre qu'il y a une boucle <em>for</em>, Yacc va repérer le mot clé <em>for</em>, suivit de paramètres : initialisation de variable, condition d'arrêt, incrémentation.</p>
</div></div>
<p>Avec Yacc, on peut exécuter une commande C quand on reconnaît un pattern. Avant, quand le programme reconnaissait la fonction <em>print</em>, il affichait directement la valeur.</p>
<p>Maintenant, le programme stocke dans l'ordre les instructions, qui sont exécutées une fois l'analyse de Yacc faite.</p>
<p><strong>Pourquoi faire ça ?</strong></p>
<p>L'objectif de Yacc, est de reconnaître tous les patterns du code écrit. Pour cela, il passe dans tout le programme une fois et une unique fois.</p>
<ul>
<li>Le fait qu'il passe dans tout le programme fait qu'il va executer les 2 cas d'une fonction <em>if</em></li>
<li>Le fait qu'il passe une unique fois, fait qu'il est impossible de revenir sur ses pas, ce qu'on voudrait potentiellement, avec une boucle <em>for</em> ou <em>while</em></li>
</ul>
<p>Si on enregistre les différentes actions possible, on est alors libre de sauter des actions et/ou de revenir sur nos pas.</p>
<h2 id="h3">Construction de la liste d'exécution</h2>
<div class="codeContainer">
<div style="width:48%;">
<p><strong>Code exécuté - if</strong></p>
<pre class="language-js " style="counter-reset: linenumber 0"><code class="language-js"><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">>=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div>
<div style="width:48%;">
<p><strong>Liste d'execution</strong></p>
<pre class="language-bash " style="counter-reset: linenumber 0"><code class="language-bash">Line <span class="token number">0</span> - Assignment var <span class="token builtin class-name">:</span> i
Line <span class="token number">1</span> - If calcul <span class="token builtin class-name">:</span> <span class="token number">1</span>
Line <span class="token number">2</span> - Goto line <span class="token builtin class-name">:</span> <span class="token number">5</span>
Line <span class="token number">3</span> - Print calcul <span class="token builtin class-name">:</span> <span class="token number">2</span>
Line <span class="token number">4</span> - Goto line <span class="token builtin class-name">:</span> <span class="token number">6</span>
Line <span class="token number">5</span> - Print calcul <span class="token builtin class-name">:</span> <span class="token number">3</span>
</code></pre>
</div>
</div>
<p>Le programme va executer les lignes une par une, sauf si une instruction demande d'aller à une ligne (notamment avec l'instruction <strong>Goto</strong>). La commande <strong>If</strong> exécute la ligne suivante si le résultat du calcul est faux, et la deuxième ligne qui suit si le résultat est vrai.</p>
<p>Avec ça il est possible de comprendre les différentes actions effectuées par le programme dans tous les cas.</p>
<div class="codeContainer">
<div style="width:48%;">
<p><strong>Code exécuté - for</strong></p>
<pre class="language-js " style="counter-reset: linenumber 0"><code class="language-js">
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token keyword">var</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token keyword">var</span><span class="token operator">&lt;</span><span class="token number">15</span><span class="token punctuation">;</span> <span class="token keyword">var</span> <span class="token operator">=</span> <span class="token keyword">var</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token keyword">var</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


</code></pre>
</div>
<div style="width:48%;">
<p><strong>Liste d'execution</strong></p>
<pre class="language-bash " style="counter-reset: linenumber 0"><code class="language-bash">Line <span class="token number">0</span> - Assignment var <span class="token builtin class-name">:</span> var
Line <span class="token number">1</span> - If calcul <span class="token builtin class-name">:</span> <span class="token number">1</span>
Line <span class="token number">2</span> - Goto line <span class="token builtin class-name">:</span> <span class="token number">6</span>
Line <span class="token number">3</span> - Print calcul <span class="token builtin class-name">:</span> <span class="token number">2</span>
Line <span class="token number">4</span> - Assignment var <span class="token builtin class-name">:</span> var
Line <span class="token number">5</span> - Goto line <span class="token builtin class-name">:</span> <span class="token number">1</span>
Line <span class="token number">6</span> - Kill var <span class="token builtin class-name">:</span> var
</code></pre>
</div>
</div>
<h2 id="h4">Structures de données</h2>
<div class="quote relative  py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-cyan-500 bg-cyan-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-cyan-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
</svg>
<div class="pl-8 mr-8">
<p>L'utilisation de <strong>pointeurs</strong> est une nécessité, car les structures des données sont complexes.</p>
<p>Pour pouvoir comprendre l'implémentation de mon compilateur, il faut aussi avoir des notions d'<strong>allocation de mémoire</strong> (avec <em>malloc</em>), de <strong>libération de mémoire</strong> (avec <em>free</em>), et de création de <strong>structure de données</strong> (avec <em>typedef</em> et <em>struct</em>) en C. Mais ces notions ne sont pas nécessaires pour comprendre la suite.</p>
</div></div>
<h3 id="h4-1">Stockage des variables</h3>
<p>Une variable est stockée avec son <strong>nom</strong>, son <strong>type</strong> et va <strong>valeur</strong>.</p>
<p>La structure de données utilisée généralement pour stocker des variables est la <strong>table de hachage</strong>, qui, si elle est bien construite, permet le <strong>sockage</strong>, la <strong>lecture</strong>, la <strong>modification</strong> et la <strong>suppression</strong> en <em>O(1)</em>.</p>
<p>Cependant, dans mon contexte, ce n'est pas la structure de données la plus adaptée, car voulant utiliser des <strong>fonctions</strong>, je devais avoir un <strong>contexte local</strong> pour les <strong>variables</strong>. C'est à dire, que les fonctions définies dans une fonction, ne sont pas accessible depuis l'extérieur de la fonction. Il faut donc pouvoir <strong>supprimer facilement</strong> les variables définies dans une fonction, une fois celle-ci terminée, et seulement ces variables.</p>
<p>J'ai donc décidé d'utiliser une structure de liste chaînée, qui a une complexité en <strong>stockage</strong> en <em>O(1)</em>, mais qui a une complexité en <strong>lecture</strong>, <strong>modification</strong> et <strong>suppression</strong> en <em>O(n)</em>, avec <em>n</em> le nombre d'éléments stockés.</p>
<p><strong style="text-align:center;width:100%;display:block;font-size:1.5rem;">Illustration d'une liste chaînée</strong><br>
<img src="../../Image/listeChainee.jpg" alt="Liste Chaînée" style="height: 400px; margin: 0 auto; border: 0" /></p>
<h3 id="h4-2">Stockage des calculs</h3>
<p>La majorité des opérateurs utilisés pour nos calculs (<em>+</em>, <em>-</em>, <em>*</em>, <em>/</em>, <em>&amp;&amp;</em>, ...), sont des <em>loi de composition interne</em> associés à l'ensemble des nombres. C'est à dire que ces opérateurs s'appliquent sur <strong>2 éléments</strong> différents.</p>
<p>Il faut donc créer une structure de donnée qui permet de garder les 2 éléments sur lesquels il faut faire les opérations. Pour cela, on va utiliser un <strong>arbre binaire</strong>.<br>
Sur les <strong>nœuds de l'arbre</strong>, il y aura les <strong>opérateurs</strong>, et sur les <strong>feuilles</strong>, soit un <strong>entier</strong>, soit une <strong>variable</strong>, soit un <strong>appel à une fonction</strong>.</p>
<p><strong style="text-align:center;width:100%;display:block;font-size:1.5rem;">Illustration de l'arbre de calcul</strong><br>
<img src="../../Image/calcTree.jpg" alt="Arbre Calcul" style="height: 400px; margin: 0 auto; border: 0"/></p>
<p>Cette structure est parfaite si il n'y a pas de fonction, mais n'est pas suffisante si on intègre les fonctions.</p>
<p>Pour les plus curieux, qui veulent savoir comment je gère les fonctions : j'utilise, en plus de l'arbre de calcul, une liste des fonctions présentes, qui pour chaque liste contient une pile de paramètres qui pointent récursivement vers un calcul. Sur chacun de ces éléments, j'ai une gestion du stockage des valeurs intermédiaires (par pile <em>LIFO</em> : <em>Last In First Out</em>), et des algorithmes de gestion de propriété des valeurs de retour assez complexe.</p>
<p>La complexité de cette structure est expliquée par le fait qu'on puisse faire des <strong>fonctions récursives</strong> et qu'on puisse <strong>appeler des fonctions</strong> dans les <strong>paramètres</strong> d'une fonction (ex : <em>print(add(1,add(2,add(3,4))));</em>)</p>
<h3 id="h4-3">Tableaux dynamiques</h3>
<p>En <strong>C</strong>, il existe des <strong>tableaux</strong>, pour stocker un certain nombre d'éléments de même type.<br>
Dans ces tableaux, on peut accéder à un élément grâce à son <strong>indice</strong>. Le seul défaut c'est qu'on doit définir la taille du tableau à l'initialisation de celui-ci, or il est pas toujours possible de savoir à priori combien d'éléments on veut mettre dans le tableau.</p>
<p>Il a fallu reconstruire les <strong>listes Pythons</strong>, où on peut accéder à un élément mais aussi <strong>rajouter un élément à la fin</strong> autant de fois qu'on veut.</p>
<p>Pour cela, j'initialise le tableau avec une taille fixée, par exemple 4.<br>
Quand j'ajoute un élément :</p>
<ul>
<li>le tableau a encore de la place, donc j'insère l'élément à la première case vide.</li>
<li>sinon, je crée un tableau 2 fois plus grand, je recopie toutes les valeurs déjà présentes, puis j'insère l'élément à la première place de libre.</li>
</ul>
<p>La complexité d'accès à un élément est en <em>O(1)</em><br>
La complexité d'ajout d'un élément est en pire cas en <em>O(n)</em> quand il est nécessaire de recopier le tableau, mais ce cas est suffisament rare pour que l'insertion soit en moyenne en <em>O(1)</em>.</p>
<p>J'ai utilisé cette structure de donnée 3 fois dans mon projet. Pour stocker les lignes d'actions, pour stocker l'ensemble des calculs et pour stocker l'ensemble des fonctions d'un calcul.</p>
<h2 id="liens">Liens Utiles </h2>
<p><a href="https://www.rocq.inria.fr/secret/Anne.Canteaut/COURS_C/chapitre3.html">Pointeurs</a><br>
<a href="https://fr.wikipedia.org/wiki/Table_de_hachage">Table de hachage</a><br>
<a href="https://fr.wikipedia.org/wiki/Liste_cha%C3%AEn%C3%A9e">Liste chaînée</a><br>
<a href="https://fr.wikipedia.org/wiki/Arbre_binaire">Arbre binaires</a><br>
<a href="https://www.w3schools.com/c/c_structs.php">C structures 1</a><br>
<a href="https://www.programiz.com/c-programming/c-structures">C structures 2</a></p>
<style>
    .codeContainer{
        display: flex;
        flex-direction: row;
        width:100%;
        justify-content: space-between;
    }
</style>

</article>

    </main>

    <footer class="min-h-[50px] border-t-2 border-gray-200 mt-4">
      <div class="max-w-[1000px] mx-auto px-4">
        <div class="min-h-[50px] flex justify-center items-center">
          <p>
            do-it : option de troisième année à l'école centrale Marseille
          </p>
        </div>
      </div>
    </footer>

    <script>
      MathJax
        .startup
        .document
        .getMathItemsWithin(document.body);
    </script>

  </body>
</html>
