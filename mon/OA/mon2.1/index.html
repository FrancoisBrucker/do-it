
<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

    <title>MON 2.1: Google Apps Script : Rappel anniversaire</title>

    <link href=/do-it/assets/node_modules/prismjs/themes/prism-solarizedlight.min.css rel="stylesheet">
    <link href=/do-it/assets/node_modules/prismjs/plugins/line-numbers/prism-line-numbers.min.css rel="stylesheet">

    <link href=/do-it/assets/stylesheets/main.css rel="stylesheet">
  </head>
  <body>
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [
            [
              '$', '$'
            ],
            [
              '\\(', '\\)'
            ]
          ]
        },
        svg: {
          fontCache: 'global'
        }
      };
    </script>
    <script type="text/javascript" id="MathJax-script" 
  src=/do-it/assets/node_modules/mathjax/es5/tex-svg-full.js></script>

    <header class="border-b-2 border-gray-200 mb-4">
      <div class="max-w-[1000px] mx-auto px-4">
        <div class="min-h-[50px] flex justify-between items-center">
          <a class="mx-2" href="/do-it/">Home</a>
          <a class="mx-2" href="/do-it/about">About</a>
        </div>
      </div>
    </header>

    <main class="max-w-[1000px] mx-auto px-4">

      
<article>
  <h1  class="mb-1">MON 2.1: Google Apps Script : Rappel anniversaire</h1>
  <div class="mb-4">
    

    
      <div class=" px-4 flex items-center">
        
          <div class="font-bold">Auteur : </div>
        
        <ul class="flex not-prose list-none my-0 last:after:content-['•'] last:after:px-1 mx-0 px-1">
          
            <li class="before:content-['•'] before:px-1">Ossama Abdane</li>
          
        </ul>
      </div>
    
  </div>

  

  <!-- début résumé -->
<p>Après un premier MON qui m'a permis de découvrir les principales fonctionnalités de Google AppScript, j'ai décidé d'approfondir mes connaissances dans ce domaine et plus précisément créer un outil qui permette de prévenir automatiquement par mail de la date d'anniversaire d'une personne.</p>
<!-- fin résumé -->
<h3>Présentation de la fonction utilisée</h3>
<p>Le fonction <code>Date()</code> permet de transformer une donnée en date sous le format voulu par Google Appscript.<br>
L'utilisation des extensions suivantes permet d'obtenir des informations voulus à partir de la date sélectionnée :</p>
<table>
<thead>
<tr>
<th style="text-align:left">Fonction</th>
<th style="text-align:left">Utilisation</th>
<th style="text-align:left">Résultat</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">aujourdhui = new Date()</td>
<td style="text-align:left">Attribue la date du jour</td>
<td style="text-align:left">Tue Dec 27 2022 19:41:46 GMT+0100 (Central European Standard Time)</td>
</tr>
<tr>
<td style="text-align:left">.getFullYear()</td>
<td style="text-align:left">Permet d'extraire l'année</td>
<td style="text-align:left">2022</td>
</tr>
<tr>
<td style="text-align:left">.getMonth()+1</td>
<td style="text-align:left">Permet d'extraire le mois</td>
<td style="text-align:left">12</td>
</tr>
<tr>
<td style="text-align:left">.getDate()</td>
<td style="text-align:left">Permet d'extraire le jour</td>
<td style="text-align:left">27</td>
</tr>
<tr>
<td style="text-align:left">.getDay()</td>
<td style="text-align:left">Permet d'extraire le jour de la semaine (1 étant lundi)</td>
<td style="text-align:left">2</td>
</tr>
<tr>
<td style="text-align:left">.getHours()</td>
<td style="text-align:left">Permet d'extraire l'heure</td>
<td style="text-align:left">19</td>
</tr>
<tr>
<td style="text-align:left">.getMinutes()</td>
<td style="text-align:left">Permet d'extraire les minutes</td>
<td style="text-align:left">41</td>
</tr>
</tbody>
</table>
<h3>Création d'un tableau d'anniversaire</h3>
<p>Il faut d'abord commencer par créer un Google sheet avec une liste de personnes et leur date de naissance comme le tableau suivant :</p>
<p><img src="Image3.png" alt="Optional Text"></p>
<h3>Codage de la fonction</h3>
<pre class="language-java " style="counter-reset: linenumber 0"><code class="language-java">
function <span class="token function">sendBirthdayEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Récupère le tableau </span>
  <span class="token keyword">var</span> sheet <span class="token operator">=</span> <span class="token class-name">SpreadsheetApp</span><span class="token punctuation">.</span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Récupère la dernière ligne du tableau</span>
  <span class="token keyword">var</span> derniereligne <span class="token operator">=</span> sheet<span class="token punctuation">.</span><span class="token function">getLastRow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Récupère la date d'aujourd'hui</span>
  <span class="token keyword">var</span> ajourdhui <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Boucle pour chaque ligne du tableau </span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> derniereligne<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Récupère la date d'anniversaire de la troisième colonne de la ligne</span>
    <span class="token keyword">var</span> anniversaire <span class="token operator">=</span> sheet<span class="token punctuation">.</span><span class="token function">getRange</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Vérification si la date d'anniversaire est la même que la date du jour</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>anniversaire<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> ajourdhui<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> anniversaire<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> ajourdhui<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Récupère le nom et prénom de la personne</span>
      <span class="token keyword">var</span> nom <span class="token operator">=</span> sheet<span class="token punctuation">.</span><span class="token function">getRange</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> prenom <span class="token operator">=</span> sheet<span class="token punctuation">.</span><span class="token function">getRange</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      <span class="token comment">// Envoie un email avec comme objet " Rappel anniversaire " et comme contenu "N'oublie pas l'anniversaire de [Nom] !"</span>
      <span class="token class-name">MailApp</span><span class="token punctuation">.</span><span class="token function">sendEmail</span><span class="token punctuation">(</span><span class="token string">"ossama84130@gmail.com"</span><span class="token punctuation">,</span> <span class="token string">"Rappel anniversaire"</span><span class="token punctuation">,</span> <span class="token string">"N'oublie pas l'anniversaire de "</span> <span class="token operator">+</span> nom <span class="token operator">+</span><span class="token string">" "</span> <span class="token operator">+</span> prenom <span class="token operator">+</span> <span class="token string">" !"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
<h3>Activation d'un déclencheur quotidien</h3>
<p>Il va ensuite falloir mettre en place un déclencheur qui va tout les jours exécuter la fonction et donc vérifier dans le tableau si un anniversaire a lieu aujourd'hui.</p>
<p><img src="Image1.png" alt="Optional Text"></p>
<h3>Mail de Rappel</h3>
<p>Si une date d'anniversaire correspond à la date du jour, un mail est envoyé à l'email indiqué.</p>
<p><img src="Image2.png" alt="Optional Text"></p>
<h3>Autre fonction utile</h3>
<p>Une fonction qui permet de vérifier si le tableau a été rempli par toutes les personnes. Elle va donc vérifier comme par exemple qur tableau suivant si les personnes ont undiqué leur présence dans la quatrième colonne :</p>
<p><img src="Image4.png" alt="Optional Text"></p>
<p>La fonction à rentrer :</p>
<pre class="language-java " style="counter-reset: linenumber 0"><code class="language-java">
function <span class="token class-name">Verifremplissage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Récupère le tableau </span>
  <span class="token keyword">var</span> sheet <span class="token operator">=</span> <span class="token class-name">SpreadsheetApp</span><span class="token punctuation">.</span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Récupère la dernière ligne du tableau</span>
  <span class="token keyword">var</span> derniereligne <span class="token operator">=</span> sheet<span class="token punctuation">.</span><span class="token function">getLastRow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Boucle sur chaque ligne</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> derniereligne<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Récupère la valeur de la quatrième colonne</span>
    <span class="token keyword">var</span> value <span class="token operator">=</span> sheet<span class="token punctuation">.</span><span class="token function">getRange</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Si la case est vide</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Récupère l'adresse email de la troisième colonne</span>
      <span class="token keyword">var</span> email <span class="token operator">=</span> sheet<span class="token punctuation">.</span><span class="token function">getRange</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      <span class="token comment">// Envoie un email à l'adresse email</span>
      <span class="token class-name">MailApp</span><span class="token punctuation">.</span><span class="token function">sendEmail</span><span class="token punctuation">(</span>email<span class="token punctuation">,</span> <span class="token string">"Attention"</span><span class="token punctuation">,</span> <span class="token string">"Vous n'avez toujours pas rempli le tableau. Merci de le faire le plus rapidement possible"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
<p>Le mail envoyé aux personnes n'ayant pas rempli le tableau :</p>
<p><img src="Image5.png" alt="Optional Text"></p>
<h3>Ressources utilisées</h3>
<ul>
<li>Le site Numerilog : <a href="https://thierryvanoffe.com">https://thierryvanoffe.com</a></li>
<li>Le site de Google : <a href="https://developers.google.com/apps-script/guides/triggers">https://developers.google.com/apps-script/guides/triggers</a></li>
<li>La Playlist tuto de Tuto de rien : <a href="https://youtube.com/playlist?list=PLozmtcO5OqdqZZ6sP6faU18jIdyCiiYvS">https://youtube.com/playlist?list=PLozmtcO5OqdqZZ6sP6faU18jIdyCiiYvS</a></li>
</ul>


</article>

    </main>

    <footer class="min-h-[50px] border-t-2 border-gray-200 mt-4">
      <div class="max-w-[1000px] mx-auto px-4">
        <div class="min-h-[50px] flex justify-center items-center">
          <p>
            do-it : option de troisième année à l'école centrale Marseille
          </p>
        </div>
      </div>
    </footer>

    <script>
      MathJax
        .startup
        .document
        .getMathItemsWithin(document.body);
    </script>

  </body>
</html>
