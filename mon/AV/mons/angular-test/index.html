
<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

    <title>Les test dans Angular</title>

    <link href=/do-it/assets/node_modules/prismjs/themes/prism-solarizedlight.min.css rel="stylesheet">
    <link href=/do-it/assets/node_modules/prismjs/plugins/line-numbers/prism-line-numbers.min.css rel="stylesheet">

    <link href=/do-it/assets/stylesheets/main.css rel="stylesheet">
  </head>
  <body>
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [
            [
              '$', '$'
            ],
            [
              '\\(', '\\)'
            ]
          ]
        },
        svg: {
          fontCache: 'global'
        }
      };
    </script>
    <script type="text/javascript" id="MathJax-script" 
  src=/do-it/assets/node_modules/mathjax/es5/tex-svg-full.js></script>

    <header class="border-b-2 border-gray-200 mb-4">
      <div class="max-w-[1000px] mx-auto px-4">
        <div class="min-h-[50px] flex justify-between items-center">
          <a class="mx-2" href="/do-it/">Home</a>
          <a class="mx-2" href="/do-it/about">About</a>
        </div>
      </div>
    </header>

    <main class="max-w-[1000px] mx-auto px-4">

      
<article>
  <h1  class="mb-1">Les test dans Angular</h1>
  <div class="mb-4">
    
      <div class=" px-4 flex items-center">
        
          <div class="font-bold">Tags : </div>
        
        <ul class="flex not-prose list-none my-0 last:after:content-['•'] last:after:px-1 mx-0 px-1">
          
            <li class="before:content-['•'] before:px-1">angular</li>
          
            <li class="before:content-['•'] before:px-1">test</li>
          
            <li class="before:content-['•'] before:px-1">javascript</li>
          
        </ul>
      </div>
    

    
      <div class=" px-4 flex items-center">
        
          <div class="font-bold">Auteur : </div>
        
        <ul class="flex not-prose list-none my-0 last:after:content-['•'] last:after:px-1 mx-0 px-1">
          
            <li class="before:content-['•'] before:px-1">Antoine Varnerot</li>
          
        </ul>
      </div>
    
  </div>

  

  <head>
  <link rel="stylesheet" href="../../assets/style.css">
</head>
<h2>Description du MON</h2>
<p>Dans ce MON j'aimerais bien relier deux connaissances :</p>
<ul>
<li>la programation par les tests qu'on a vu en cours du temps 3</li>
<li>Angular que j'ai pu utiliser dans des projets</li>
</ul>
<p>Sur le site d'Angular, il y a une partie &quot;Testing&quot;, je vais essayer de suivre le tuto qu'il fournisse :<br>
<a href="https://angular.io/guide/testing">https://angular.io/guide/testing</a></p>
<p>Prérequis (selon le tuto):</p>
<ul>
<li>Angular fundamentals</li>
<li>JavaScript</li>
<li>HTML</li>
<li>CSS</li>
<li>Angular CLI</li>
</ul>
<p>Les tests sont effectués avec Jasmin/Karma. <a href="https://jasmine.github.io/">https://jasmine.github.io/</a></p>
<p>Pour lancer les tests unitaires et d'intégration d'une application il y a juste à utiliser la commande :</p>
<pre class="language-bash " style="counter-reset: linenumber 0"><code class="language-bash">ng <span class="token builtin class-name">test</span>
</code></pre>
<p>Si on a implémenté de l'intégration continue, on peut mettre dans le fichier package.json :</p>
<pre class="language-json " style="counter-reset: linenumber 0"><code class="language-json"><span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"ng test"</span><span class="token punctuation">,</span>
    <span class="token property">"test:ci"</span><span class="token operator">:</span> <span class="token string">"ng test --watch=false --browsers=ChromeHeadlessCI"</span>
<span class="token punctuation">}</span>
</code></pre>
<h2>Essais</h2>
<p>Quand je l'utilise sur le projet 3a, on voit :</p>
<pre class="language-bash " style="counter-reset: linenumber 0"><code class="language-bash"><span class="token number">29</span> 03 <span class="token number">2023</span> <span class="token number">15</span>:55:08.683:WARN <span class="token punctuation">[</span>karma<span class="token punctuation">]</span>: No captured browser, <span class="token function">open</span> http://localhost:9876/
<span class="token number">29</span> 03 <span class="token number">2023</span> <span class="token number">15</span>:55:08.765:INFO <span class="token punctuation">[</span>karma-server<span class="token punctuation">]</span>: Karma v6.4.1 server started at http://localhost:9876/
<span class="token number">29</span> 03 <span class="token number">2023</span> <span class="token number">15</span>:55:08.765:INFO <span class="token punctuation">[</span>launcher<span class="token punctuation">]</span>: Launching browsers Chrome with concurrency unlimited
<span class="token number">29</span> 03 <span class="token number">2023</span> <span class="token number">15</span>:55:08.778:INFO <span class="token punctuation">[</span>launcher<span class="token punctuation">]</span>: Starting browser Chrome
<span class="token number">29</span> 03 <span class="token number">2023</span> <span class="token number">15</span>:55:17.648:INFO <span class="token punctuation">[</span>Chrome <span class="token number">111.0</span>.0.0 <span class="token punctuation">(</span>Windows <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">]</span>: Connected on socket lNB9loYvtK6OizDlAAAB with <span class="token function">id</span> <span class="token number">86176802</span>

<span class="token punctuation">..</span>.
<span class="token punctuation">(</span>beaucoup d erreurs<span class="token punctuation">)</span>
<span class="token punctuation">..</span>.

Chrome <span class="token number">111.0</span>.0.0 <span class="token punctuation">(</span>Windows <span class="token number">10</span><span class="token punctuation">)</span>: Executed <span class="token number">29</span> of <span class="token number">29</span> <span class="token punctuation">(</span><span class="token number">18</span> FAILED<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token number">5.695</span> secs / <span class="token number">1.836</span> secs<span class="token punctuation">)</span>
TOTAL: <span class="token number">18</span> FAILED, <span class="token number">11</span> SUCCESS
</code></pre>
<p>Et ca nous ouvre une fenêtre Chrome à l'adresse localhost:9876 où les erreurs sont affichées d'une facon plus lisible :</p>
<figure>
  <img src="../../assets/tests-init.png">
  <figcaption>Résultat des tests du projet 3a</figcaption>
</figure>
<p>Les fichiers de tests dans Angular sont tous les fichiers qui ont l'extension <code>.spec.ts</code>.</p>
<p>Il y a 18 erreurs mais il y a quand même 11 succès ^^.<br>
On va essayer de comprendre comment on peut résoudre ces erreurs et comment implémenter d'autres tests.</p>
<h2>Réalisation</h2>
<p>En regardant de plus près les erreurs, il y en avait beaucoup qui était très simple à résoudre. En effet, il n'y avait pas d'erreur dans le code en lui-même mais le fichier qui était exécuté pour faire le test ne disposait pas de toutes les informations. Par exemple, il n'y avait pas le module pour faire des requêtes HTTP. Je l'ai donc rajouté avant de réaliser tous les tests :</p>
<pre class="language-typescript " style="counter-reset: linenumber 0"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> HttpClientTestingModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@angular/common/http/testing'</span><span class="token punctuation">;</span> <span class="token comment">// Ligne ajoutée</span>

<span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> TestBed<span class="token punctuation">.</span><span class="token function">configureTestingModule</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      imports<span class="token operator">:</span> <span class="token punctuation">[</span>HttpClientTestingModule<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// Ligne ajoutée</span>
      declarations<span class="token operator">:</span> <span class="token punctuation">[</span> PlanningDialogComponent <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">compileComponents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    fixture <span class="token operator">=</span> TestBed<span class="token punctuation">.</span><span class="token function">createComponent</span><span class="token punctuation">(</span>PlanningDialogComponent<span class="token punctuation">)</span><span class="token punctuation">;</span>
    component <span class="token operator">=</span> fixture<span class="token punctuation">.</span>componentInstance<span class="token punctuation">;</span>
    fixture<span class="token punctuation">.</span><span class="token function">detectChanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Après avoir réalisé tout ces imports manquants, il me restait que 5 erreurs.</p>
<h1>J'ai aussi rajouté l'option <code>--code-coverage</code> pour savoir si tout mon code était bien testé.<br>
Résultat :<br>
=============================== Coverage summary ===============================<br>
Statements   : 57.04% ( 174/305 )<br>
Branches     : 9.52% ( 2/21 )<br>
Functions    : 48.67% ( 55/113 )<br>
Lines        : 57.23% ( 174/304 )</h1>
<h2>Ajouter des tests personnalisés</h2>
<p>Il suffit d'utiliser les 3 fonctions suivantes pour implémenter un test :</p>
<ul>
<li>describe : pour définir une suite (ou groupe) de &quot;specs&quot;.</li>
<li>it : pour définir une &quot;spec&quot; (ou un test).</li>
<li>expect : pour implémenter les assertions.</li>
</ul>
<h2>Tests de routage</h2>
<p>On peut maintenant réaliser des tests de routage par exemple pour vérifier que le router nous redirige au bon endroit :</p>
<pre class="language-typescript " style="counter-reset: linenumber 0"><code class="language-typescript"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should navigate to home page'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> router<span class="token punctuation">.</span><span class="token function">navigate</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">''</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>location<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should navigate to about page'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> router<span class="token punctuation">.</span><span class="token function">navigate</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'/about'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>location<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'/about'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should navigate to about page with navigateByUrl()'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> router<span class="token punctuation">.</span><span class="token function">navigateByUrl</span><span class="token punctuation">(</span><span class="token string">'/about'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>location<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'/about'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Et que le bon component est bien chargé (app-home ici pour la route '') :</p>
<pre class="language-typescript " style="counter-reset: linenumber 0"><code class="language-typescript"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should display home component for default route'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> router<span class="token punctuation">.</span><span class="token function">navigate</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">''</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  fixture<span class="token punctuation">.</span><span class="token function">detectChanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> home <span class="token operator">=</span> fixture<span class="token punctuation">.</span>debugElement<span class="token punctuation">.</span>nativeElement<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'app-home'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>home<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeTruthy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>


</article>

    </main>

    <footer class="min-h-[50px] border-t-2 border-gray-200 mt-4">
      <div class="max-w-[1000px] mx-auto px-4">
        <div class="min-h-[50px] flex justify-center items-center">
          <p>
            do-it : option de troisième année à l'école centrale Marseille
          </p>
        </div>
      </div>
    </footer>

    <script>
      MathJax
        .startup
        .document
        .getMathItemsWithin(document.body);
    </script>

  </body>
</html>
