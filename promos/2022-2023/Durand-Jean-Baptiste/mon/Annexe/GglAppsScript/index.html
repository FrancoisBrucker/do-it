
<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>Annexe du MON Google Apps Script</title>

        <link href="/do-it/assets/node_modules/prismjs/themes/prism-solarizedlight.min.css" rel="stylesheet">
        <link href="/do-it/assets/node_modules/prismjs/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet">

        <link href="/do-it/assets/stylesheets/main.css" rel="stylesheet">
    </head>
    <body>
        <script>
        window.MathJax = {
            tex: {
            inlineMath: [
                [
                '$', '$'
                ],
                [
                '\\(', '\\)'
                ]
            ]
            },
            svg: {
            fontCache: 'global'
            }
        };
        </script>
        <script type="text/javascript" id="MathJax-script" src="/do-it/assets/node_modules/mathjax/es5/tex-svg-full.js"></script>

        <header class="border-b-2 border-gray-200 mb-4">
        <div class="max-w-[1000px] mx-auto px-4">
            <div class="min-h-[50px] flex justify-between items-center">
                <a class="mx-2" href="/do-it/">Home</a>
                <div class="flex items-center gap-4 sm:gap-6 ">
                    <a class="" href="/do-it/cs">CS</a>
                    <a class="" href="/do-it/pok">POK</a>
                    <a class="" href="/do-it/mon">MON</a>
                    <a class="" href="/do-it/projets">Projets</a>
                    <a class="hidden sm:block" href="/do-it/promos">Promos</a>
                    <a href="/do-it/search">
                        <svg class="h-5 aspect-square" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"></path>
                        </svg>
                    </a>
                    <a class="hidden sm:block" href="https://github.com/FrancoisBrucker/do-it" target="_blank">
                        <svg class="h-5 aspect-square" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg>
                    </a>
                </div>
            </div>
        </div>
        </header>

        <main class="max-w-[1000px] mx-auto px-4" data-pagefind-body="">
            
<article class="relative">
<h1 class="mb-1">Annexe du MON Google Apps Script</h1>
<div class="mb-4">
    
        <div class="px-4 flex flex-wrap items-center">
            
                <div class="font-bold">Tag : </div>
            
            <ul class="flex flex-wrap overflow-auto not-prose list-none my-1 mx-0 px-1 gap-1" data-pagefind-meta="Tags">
                
                    <li class="bg-yellow-200 rounded-full px-2" data-pagefind-filter="Tags">2022-2023</li>
                

            </ul>
            
            
            <div class="hidden" data-pagefind-meta="Type">
                
                    
                
            </div>
        </div>
    

    
        <div class="px-4 flex flex-wrap items-center">
            <div class="font-bold">Auteurs : </div>
            <ul class="flex flex-wrap not-prose list-none my-1 mx-0 px-1 gap-1" data-pagefind-meta="Auteurs">
                
                    <li class="bg-blue-200 rounded-full px-2" data-pagefind-filter="Auteurs">Jean-Baptiste Durand</li>
                
            </ul>
        </div>
    

    
</div>




<p>Voici le code source de mon projet pour le MON de Google Apps Script. <a href="../../GglAppsScript">lien vers le site</a></p>
<p>Il permet de créer un Google Sheet fonctionnant comme un Tricount.</p>
<pre class="language-javascript"><code class="language-javascript">
<span class="token comment">////////////////////////////////</span>
<span class="token comment">// [START modifiable parameters]</span>
<span class="token keyword">var</span> tricountSettings <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">sourceSheet</span><span class="token operator">:</span> <span class="token string">'Ajout_achat'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">targetSheet</span><span class="token operator">:</span> <span class="token string">'Historique'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">statSheet</span><span class="token operator">:</span> <span class="token string">'Statistiques'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">people</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">"Personne 1"</span><span class="token punctuation">,</span><span class="token string">"Personne 2"</span><span class="token punctuation">,</span> <span class="token string">"Personne 3"</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token comment">// [END modifiable parameters]</span>
<span class="token comment">////////////////////////////////</span>


<span class="token comment">/**
* Take the form from the SourceSheet to add it in the TargetSheet
* It add also formulas to calculate the impact on everybody balance

* I built this function, inspired by the work of --Hyde 
* see https://support.google.com/docs/thread/41717054
*/</span>
<span class="token keyword">function</span> <span class="token function">tricountAddToHistory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>


  <span class="token keyword">var</span> timestamp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Parameters</span>

  <span class="token keyword">let</span> nb_people <span class="token operator">=</span> tricountSettings<span class="token punctuation">.</span>people<span class="token punctuation">.</span>length


  <span class="token comment">// Import Sreadsheet</span>

  <span class="token keyword">var</span> ss <span class="token operator">=</span> SpreadsheetApp<span class="token punctuation">.</span><span class="token function">getActive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> sheet <span class="token operator">=</span> ss<span class="token punctuation">.</span><span class="token function">getSheetByName</span><span class="token punctuation">(</span>tricountSettings<span class="token punctuation">.</span>targetSheet<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>sheet<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sheet <span class="token operator">=</span> ss<span class="token punctuation">.</span><span class="token function">insertSheet</span><span class="token punctuation">(</span>tricountSettings<span class="token punctuation">.</span>targetSheet<span class="token punctuation">)</span><span class="token punctuation">;</span>
    sheet<span class="token punctuation">.</span><span class="token function">appendRow</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Timestamp'</span><span class="token punctuation">,</span> <span class="token string">'Data'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">let</span> A1_range <span class="token operator">=</span> tricountSettings<span class="token punctuation">.</span>sourceSheet <span class="token operator">+</span> <span class="token string">"!A2:"</span> <span class="token operator">+</span> <span class="token function">columnToLetter</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token operator">+</span>nb_people<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"2"</span>
  <span class="token keyword">var</span> range <span class="token operator">=</span> ss<span class="token punctuation">.</span><span class="token function">getRange</span><span class="token punctuation">(</span>A1_range<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> values <span class="token operator">=</span> range<span class="token punctuation">.</span><span class="token function">getValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


  <span class="token comment">// Storage cells</span>

  <span class="token keyword">var</span> casesToDelete <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> turnTrueCases <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">var</span> historiqueRow <span class="token operator">=</span> <span class="token punctuation">[</span>timestamp<span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token comment">// Generate ation to do</span>
  <span class="token keyword">let</span> caseDescision<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"move"</span><span class="token punctuation">,</span><span class="token string">"move"</span><span class="token punctuation">,</span><span class="token string">"move"</span><span class="token punctuation">]</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>nb_people<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    caseDescision<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">"turnTrue"</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">//loop actions</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> column <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> numcolumns <span class="token operator">=</span> values<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span> column <span class="token operator">&lt;</span> numcolumns<span class="token punctuation">;</span> column<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> action <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    action <span class="token operator">=</span> caseDescision<span class="token punctuation">[</span>column<span class="token punctuation">]</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token string">'move'</span><span class="token operator">:</span>
        historiqueRow <span class="token operator">=</span> historiqueRow<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>values<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>column<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        casesToDelete<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>column<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token string">'turnTrue'</span><span class="token operator">:</span>
        historiqueRow <span class="token operator">=</span> historiqueRow<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>values<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>column<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        turnTrueCases<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>column<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">default</span><span class="token operator">:</span>
        <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// row where to put, to add formulas</span>
  <span class="token keyword">const</span> wherePut <span class="token operator">=</span> sheet<span class="token punctuation">.</span><span class="token function">getRange</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token operator">+</span> <span class="token number">2</span><span class="token operator">*</span>nb_people<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>

  <span class="token comment">//add to TargetSheet the values of the SourceSheet</span>
  sheet<span class="token punctuation">.</span><span class="token function">appendRow</span><span class="token punctuation">(</span>historiqueRow<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//formulas to add</span>
  <span class="token keyword">var</span> formulas<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
  formulas <span class="token operator">=</span> formulas<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token string">"=COUNTIF(R[0]C[-"</span><span class="token operator">+</span><span class="token punctuation">(</span>nb_people<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"]:R[0]C[-1];TRUE)"</span><span class="token punctuation">)</span>

  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>nb_people<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    formulas <span class="token operator">=</span> formulas<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token string">"=IF(R[0]C[-"</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">+</span>nb_people<span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"]=\""</span><span class="token operator">+</span>tricountSettings<span class="token punctuation">.</span>people<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">"\";R[0]C[-"</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token operator">+</span>nb_people<span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"];0) - IF(R[0]C[-"</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">+</span>nb_people<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"];R[0]C[-"</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token operator">+</span>nb_people<span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"]/R[0]C[-"</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"];0)"</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  
  sheet<span class="token punctuation">.</span><span class="token function">getRange</span><span class="token punctuation">(</span>tricountSettings<span class="token punctuation">.</span>targetSheet<span class="token operator">+</span><span class="token string">"!"</span><span class="token operator">+</span><span class="token function">columnToLetter</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token operator">+</span>nb_people<span class="token punctuation">)</span><span class="token operator">+</span>wherePut<span class="token operator">+</span><span class="token string">":"</span><span class="token operator">+</span><span class="token function">columnToLetter</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token operator">+</span><span class="token number">2</span><span class="token operator">*</span>nb_people<span class="token punctuation">)</span><span class="token operator">+</span>wherePut<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFormulasR1C1</span><span class="token punctuation">(</span><span class="token punctuation">[</span>formulas<span class="token punctuation">]</span><span class="token punctuation">)</span>
  sheet<span class="token punctuation">.</span><span class="token function">getRange</span><span class="token punctuation">(</span>tricountSettings<span class="token punctuation">.</span>targetSheet<span class="token operator">+</span><span class="token string">"!"</span><span class="token operator">+</span><span class="token function">columnToLetter</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token operator">+</span><span class="token number">2</span><span class="token operator">*</span>nb_people<span class="token punctuation">)</span><span class="token operator">+</span>wherePut<span class="token operator">+</span><span class="token string">":"</span><span class="token operator">+</span><span class="token function">columnToLetter</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token operator">+</span><span class="token number">2</span><span class="token operator">*</span>nb_people<span class="token punctuation">)</span><span class="token operator">+</span>wherePut<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFormulasR1C1</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">"=SUM(R[0]C[-"</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">+</span>nb_people<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"]:R[0]C[-2])"</span><span class="token punctuation">,</span><span class="token string">"=MONTH(R[0]C[-"</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token operator">+</span><span class="token number">2</span><span class="token operator">*</span>nb_people<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"])"</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>


  <span class="token comment">// Delete in SourceSheet cases or turn them to true</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>casesToDelete<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> sourceSheet <span class="token operator">=</span> range<span class="token punctuation">.</span><span class="token function">getSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> rowStart <span class="token operator">=</span> range<span class="token punctuation">.</span><span class="token function">getColumn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> casesToDelete<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      sourceSheet<span class="token punctuation">.</span><span class="token function">getRange</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> rowStart <span class="token operator">+</span> casesToDelete<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>turnTrueCases<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> sourceSheet <span class="token operator">=</span> range<span class="token punctuation">.</span><span class="token function">getSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> rowStart <span class="token operator">=</span> range<span class="token punctuation">.</span><span class="token function">getColumn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> turnTrueCases<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      sourceSheet<span class="token punctuation">.</span><span class="token function">getRange</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> rowStart <span class="token operator">+</span> turnTrueCases<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">//turn the button to validate to false</span>
  SpreadsheetApp<span class="token punctuation">.</span><span class="token function">getActiveSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRange</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token operator">+</span>nb_people<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * Return the letter of the column, having the number
 * https://stackoverflow.com/questions/21229180/convert-column-index-into-corresponding-column-letter
 */</span>

<span class="token keyword">function</span> <span class="token function">columnToLetter</span><span class="token punctuation">(</span><span class="token parameter">column</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">var</span> temp<span class="token punctuation">,</span> letter <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>column <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    temp <span class="token operator">=</span> <span class="token punctuation">(</span>column <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">26</span><span class="token punctuation">;</span>
    letter <span class="token operator">=</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>temp <span class="token operator">+</span> <span class="token number">65</span><span class="token punctuation">)</span> <span class="token operator">+</span> letter<span class="token punctuation">;</span>
    column <span class="token operator">=</span> <span class="token punctuation">(</span>column <span class="token operator">-</span> temp <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">26</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> letter<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * trigger the function tricountAddToHistory, when the form is ready
 */</span>
<span class="token keyword">function</span> <span class="token function">onEdit</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> value <span class="token operator">=</span> SpreadsheetApp<span class="token punctuation">.</span><span class="token function">getActive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSheetByName</span><span class="token punctuation">(</span>tricountSettings<span class="token punctuation">.</span>sourceSheet<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRange</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token operator">+</span>tricountSettings<span class="token punctuation">.</span>people<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">tricountAddToHistory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * Generate all the cells needed to make it work
 */</span>
<span class="token keyword">function</span> <span class="token function">generateSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> ss <span class="token operator">=</span> SpreadsheetApp<span class="token punctuation">.</span><span class="token function">getActive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> sourceSheet <span class="token operator">=</span> ss<span class="token punctuation">.</span><span class="token function">getSheetByName</span><span class="token punctuation">(</span>tricountSettings<span class="token punctuation">.</span>sourceSheet<span class="token punctuation">)</span>
  <span class="token keyword">var</span> targetSheet <span class="token operator">=</span> ss<span class="token punctuation">.</span><span class="token function">getSheetByName</span><span class="token punctuation">(</span>tricountSettings<span class="token punctuation">.</span>targetSheet<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> statSheet <span class="token operator">=</span> ss<span class="token punctuation">.</span><span class="token function">getSheetByName</span><span class="token punctuation">(</span>tricountSettings<span class="token punctuation">.</span>statSheet<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>sourceSheet<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sourceSheet <span class="token operator">=</span> ss<span class="token punctuation">.</span><span class="token function">insertSheet</span><span class="token punctuation">(</span>tricountSettings<span class="token punctuation">.</span>sourceSheet<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>sourceSheet<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>targetSheet<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    targetSheet <span class="token operator">=</span> ss<span class="token punctuation">.</span><span class="token function">insertSheet</span><span class="token punctuation">(</span>tricountSettings<span class="token punctuation">.</span>targetSheet<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>targetSheet<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>statSheet<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    statSheet <span class="token operator">=</span> ss<span class="token punctuation">.</span><span class="token function">insertSheet</span><span class="token punctuation">(</span>tricountSettings<span class="token punctuation">.</span>statSheet<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>targetSheet<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>

  <span class="token keyword">const</span> nb_people <span class="token operator">=</span> tricountSettings<span class="token punctuation">.</span>people<span class="token punctuation">.</span>length


  <span class="token comment">// SourceSheet</span>
  sourceSheet<span class="token punctuation">.</span><span class="token function">appendRow</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"Commentaire"</span><span class="token punctuation">,</span><span class="token string">"Prix"</span><span class="token punctuation">,</span><span class="token string">"Payé par"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>tricountSettings<span class="token punctuation">.</span>people<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token string">"Valider"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">var</span> liste<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">]</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>nb_people<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    liste<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">"TRUE"</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  liste<span class="token operator">=</span>liste<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token string">"FALSE"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  sourceSheet<span class="token punctuation">.</span><span class="token function">appendRow</span><span class="token punctuation">(</span>liste<span class="token punctuation">)</span>

  sourceSheet<span class="token punctuation">.</span><span class="token function">getRange</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token operator">+</span>nb_people<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFormula</span><span class="token punctuation">(</span><span class="token string">"=AND(R[0]C[-1],NOT(ISBLANK(B2)),NOT(ISBLANK(C2)),OR(D2:"</span><span class="token operator">+</span><span class="token function">columnToLetter</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token operator">+</span>nb_people<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"2))"</span><span class="token punctuation">)</span>


  <span class="token comment">// https://spreadsheet.dev/working-with-checkboxes-in-google-sheets-using-google-apps-script</span>
  sourceSheet<span class="token punctuation">.</span><span class="token function">getRange</span><span class="token punctuation">(</span><span class="token string">"D2:"</span><span class="token operator">+</span><span class="token function">columnToLetter</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token operator">+</span>nb_people<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">insertCheckboxes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  sourceSheet<span class="token punctuation">.</span><span class="token function">getRange</span><span class="token punctuation">(</span><span class="token function">columnToLetter</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token operator">+</span>nb_people<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">insertCheckboxes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>


  <span class="token comment">//https://developers.google.com/apps-script/reference/spreadsheet/data-validation-builder</span>
  <span class="token keyword">var</span> cell <span class="token operator">=</span> sourceSheet<span class="token punctuation">.</span><span class="token function">getRange</span><span class="token punctuation">(</span><span class="token string">'C2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> range <span class="token operator">=</span> sourceSheet<span class="token punctuation">.</span><span class="token function">getRange</span><span class="token punctuation">(</span><span class="token string">'D1:'</span><span class="token operator">+</span><span class="token function">columnToLetter</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token operator">+</span>nb_people<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> rule <span class="token operator">=</span> SpreadsheetApp<span class="token punctuation">.</span><span class="token function">newDataValidation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">requireValueInRange</span><span class="token punctuation">(</span>range<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  cell<span class="token punctuation">.</span><span class="token function">setDataValidation</span><span class="token punctuation">(</span>rule<span class="token punctuation">)</span><span class="token punctuation">;</span>

  sourceSheet<span class="token punctuation">.</span><span class="token function">getRange</span><span class="token punctuation">(</span><span class="token function">columnToLetter</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token operator">+</span>nb_people<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFontColor</span><span class="token punctuation">(</span><span class="token string">"white"</span><span class="token punctuation">)</span>

  <span class="token comment">//TargetSheet</span>
  
  liste <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"Timestamp"</span><span class="token punctuation">,</span><span class="token string">"Commentaire"</span><span class="token punctuation">,</span><span class="token string">"Prix"</span><span class="token punctuation">,</span><span class="token string">"Payé par"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>tricountSettings<span class="token punctuation">.</span>people<span class="token punctuation">)</span>
  liste<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">"Nb Personnes"</span><span class="token punctuation">)</span>
  tricountSettings<span class="token punctuation">.</span>people<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">person</span><span class="token operator">=></span><span class="token punctuation">{</span>
    liste<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">"Coût "</span><span class="token operator">+</span>person<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  liste<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span>
  liste<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">"Check somme"</span><span class="token punctuation">)</span>
  liste<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">"Mois"</span><span class="token punctuation">)</span>
  liste<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">"Dernière Ligne"</span><span class="token punctuation">)</span>

  targetSheet<span class="token punctuation">.</span><span class="token function">appendRow</span><span class="token punctuation">(</span>liste<span class="token punctuation">)</span>
  targetSheet<span class="token punctuation">.</span><span class="token function">getRange</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token operator">+</span><span class="token number">2</span><span class="token operator">*</span>nb_people<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFormula</span><span class="token punctuation">(</span><span class="token string">"=COUNTIF(A1:A,\"&lt;>\")"</span><span class="token punctuation">)</span>

  <span class="token comment">// StatSheet</span>

  statSheet<span class="token punctuation">.</span><span class="token function">appendRow</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"Somme"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  statSheet<span class="token punctuation">.</span><span class="token function">appendRow</span><span class="token punctuation">(</span>tricountSettings<span class="token punctuation">.</span>people<span class="token punctuation">)</span>
  liste<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>

  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>nb_people<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    liste<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">"=SUM("</span><span class="token operator">+</span>tricountSettings<span class="token punctuation">.</span>targetSheet<span class="token operator">+</span><span class="token string">"!"</span><span class="token operator">+</span><span class="token function">columnToLetter</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token operator">+</span>nb_people<span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"2:"</span><span class="token operator">+</span><span class="token function">columnToLetter</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token operator">+</span>nb_people<span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">")"</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  statSheet<span class="token punctuation">.</span><span class="token function">appendRow</span><span class="token punctuation">(</span>liste<span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>


</article>

        </main>


        <footer class="min-h-[50px] border-t-2 border-gray-200 mt-4">
            <div class="max-w-[1000px] mx-auto px-4">
                <div class="min-h-[50px] flex justify-center items-center">
                    <p class="text-center">
                        <span style="font-family: Consolas, sans-serif;">Do_<span style="color: #4a86e8">It</span></span> : Développent et Organisation en IT
                    </p>
                </div>
            </div>
        </footer>

        <script>
        MathJax
            .startup
            .document
            .getMathItemsWithin(document.body);
        </script>
    </body>
</html>
