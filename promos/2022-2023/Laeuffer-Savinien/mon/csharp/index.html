
<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>C# et .NET (Bases, création d&#39;une API)</title>

        <link href="/do-it/assets/node_modules/prismjs/themes/prism-solarizedlight.min.css" rel="stylesheet">
        <link href="/do-it/assets/node_modules/prismjs/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet">

        <link href="/do-it/assets/stylesheets/main.css" rel="stylesheet">
    </head>
    <body>
        <script>
        window.MathJax = {
            tex: {
            inlineMath: [
                [
                '$', '$'
                ],
                [
                '\\(', '\\)'
                ]
            ]
            },
            svg: {
            fontCache: 'global'
            }
        };
        </script>
        <script type="text/javascript" id="MathJax-script" src="/do-it/assets/node_modules/mathjax/es5/tex-svg-full.js"></script>

        <header class="border-b-2 border-gray-200 mb-4">
        <div class="max-w-[1000px] mx-auto px-4">
            <div class="min-h-[50px] flex justify-between items-center">
                <a class="mx-2" href="/do-it/">Home</a>
                <div class="flex items-center gap-4 sm:gap-6 ">
                    <a class="" href="/do-it/cs">CS</a>
                    <a class="" href="/do-it/pok">POK</a>
                    <a class="" href="/do-it/mon">MON</a>
                    <a class="" href="/do-it/projets">Projets</a>
                    <a class="hidden sm:block" href="/do-it/promos">Promos</a>
                    <a href="/do-it/search">
                        <svg class="h-5 aspect-square" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"></path>
                        </svg>
                    </a>
                    <a class="hidden sm:block" href="https://github.com/FrancoisBrucker/do-it" target="_blank">
                        <svg class="h-5 aspect-square" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg>
                    </a>
                </div>
            </div>
        </div>
        </header>

        <main class="max-w-[1000px] mx-auto px-4" data-pagefind-body="">
            
<article class="relative">
<h1 class="mb-1">C# et .NET (Bases, création d&#39;une API)</h1>
<div class="mb-4">
    
        <div class="px-4 flex flex-wrap items-center">
            
                <div class="font-bold">Tags : </div>
            
            <ul class="flex flex-wrap overflow-auto not-prose list-none my-1 mx-0 px-1 gap-1" data-pagefind-meta="Tags">
                
                    <li class="bg-yellow-200 rounded-full px-2" data-pagefind-filter="Tags">MON</li>
                
                    <li class="bg-yellow-200 rounded-full px-2" data-pagefind-filter="Tags">2022-2023</li>
                
                    <li class="bg-yellow-200 rounded-full px-2" data-pagefind-filter="Tags">temps 2</li>
                

            </ul>
            
            
            <div class="hidden" data-pagefind-meta="Type">
                
                    
                
                    
                
                    
                
            </div>
        </div>
    

    
        <div class="px-4 flex flex-wrap items-center">
            <div class="font-bold">Auteurs : </div>
            <ul class="flex flex-wrap not-prose list-none my-1 mx-0 px-1 gap-1" data-pagefind-meta="Auteurs">
                
                    <li class="bg-blue-200 rounded-full px-2" data-pagefind-filter="Auteurs">Savinien Laeuffer</li>
                
            </ul>
        </div>
    

    
</div>



    
<div class="quote relative  py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-purple-500 bg-purple-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-purple-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"></path>
</svg>
<div class="pl-8 mr-8">

<a href="/do-it/promos/">Promotions</a><span class="px-1">/</span><a href="/do-it/promos/2022-2023/">2022-2023</a><span class="px-1">/</span><a href="/do-it/promos/2022-2023/Laeuffer-Savinien/">Savinien Laeuffer</a><span class="px-1">/</span><a href="/do-it/promos/2022-2023/Laeuffer-Savinien/mon/">MONs de Savinien</a><span class="px-1">/</span><a href="/do-it/promos/2022-2023/Laeuffer-Savinien/mon/csharp/">C# et .NET (Bases, création d&#39;une API)</a>

</div></div>




<!-- début résumé -->
<p>C# et .NET (Bases, création d'une API)</p>
<!-- fin résumé -->
<h2>Description</h2>
<p>Ayant trouvé mon stage de fin d'études chez Lucca, j'aurai besoin de connaître le langage C# et la plateforme .NET. J'ai donc cherché sur internet des cours afin d'apprendre ce langage et j'ai trouvé ce que je cherchais sur le site de Microsoft, qui propose de nombreux cours pour faire de différentes choses en C#.</p>
<p>Microsoft fournit beaucoup de cours, de videos et de documentations afin d'apprendre le C# et .NET, c'est donc de ça dont je me suis servi afin d'apprendre.</p>
<h2>Présentation de C# et .NET</h2>
<h5>C#</h5>
<p>C# est un langage de programmation orienté objet créé par Microsoft en 2000. Il est principalement utilisé pour développer des applications Windows mais peut également être utilisé pour développer des applications web, des jeux vidéo, des applications mobiles et des applications de réalité virtuelle. C# est basé sur le langage C++ et est similaire à Java en termes de syntaxe. Il est utilisé dans le développement d'applications avec la plateforme .NET de Microsoft. Il est également utilisé pour développer des applications avec les frameworks <a href="http://ASP.NET">ASP.NET</a> et Xamarin pour développer des applications mobiles multiplateformes.</p>
<div style="width:100%;">
  <figure style="text-align:center">
    <img style="height:200px; margin-left: auto; margin-right: auto" src="../csharp.png">
    <figcaption>C#</figcaption>
  </figure>
</div>
<h5>.NET</h5>
<p>.NET est un framework de développement d'applications créé par Microsoft. Il permet aux développeurs de créer des applications pour Windows, web, mobile, jeux, IoT et d'autres types d'applications en utilisant des langages de programmation tels que C#, F#, et Visual Basic. Il fournit un ensemble de bibliothèques de classes, un runtime pour l'exécution des applications, ainsi qu'un environnement de développement intégré (IDE) pour faciliter le développement d'applications.</p>
<p>.NET est conçu pour être une plateforme de développement moderne et polyvalente, il offre des fonctionnalités telles que la gestion de la mémoire automatique, la sécurité, les services Web, et un support pour les applications multi-plateformes. .NET Core est une version open-source de .NET qui peut être utilisée sur différentes plateformes comme Windows, Linux et macOS.</p>
<div style="width:100%;">
  <figure style="text-align:center">
    <img style="height:200px; margin-left: auto; margin-right: auto" src="../dotnet.png">
    <figcaption>C#</figcaption>
  </figure>
</div>
<p>Voici un tableau résumant les différents frameworks .NET:</p>
<table>
<thead>
<tr>
<th>Modèle d’application</th>
<th>Infrastructure</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>Web</td>
<td><a href="http://ASP.NET">ASP.NET</a> Core</td>
<td>Infrastructure pour générer une logique côté serveur.</td>
</tr>
<tr>
<td>Web</td>
<td><a href="http://ASP.NET">ASP.NET</a> Core MVC</td>
<td>Infrastructure pour générer une logique côté serveur pour les pages ou les API web.</td>
</tr>
<tr>
<td>Web</td>
<td><a href="http://ASP.NET">ASP.NET</a> Core Razor Pages</td>
<td>Infrastructure pour créer une application HTML générée par le serveur.</td>
</tr>
<tr>
<td>Client web</td>
<td>Blazor</td>
<td>Blazor fait partie de <a href="http://ASP.NET">ASP.NET</a> Core. Ses deux modes autorisent soit la manipulation de Document Object Model (DOM) par le biais de sockets en tant que véhicule de communication pour l’exécution de code côté serveur, soit une implémentation de WebAssembly pour l’exécution du langage C# compilé sur un navigateur.</td>
</tr>
<tr>
<td>Bureau</td>
<td>WinForms</td>
<td>Infrastructure pour créer des applications de style Windows « battleship gray ».</td>
</tr>
<tr>
<td>Bureau</td>
<td>Windows Presentation Foundation (WPF)</td>
<td>Framework pour la génération d’applications de bureau dynamiques conformes à différents facteurs de forme. WPF permet aux éléments de formulaire d’effectuer des mouvements, des fondus, des glissements et d’autres effets à l’aide d’une bibliothèque enrichie d’animations.</td>
</tr>
<tr>
<td>Mobile</td>
<td>Xamarin</td>
<td>Permet aux développeurs .NET de créer des applications pour les appareils iOS et Android.</td>
</tr>
</tbody>
</table>
<h2>Bases en C#</h2>
<h5>Prérequis</h5>
<p>Pour coder en C# il faut quelques prérequis:</p>
<ul>
<li>On installe <a href="https://code.visualstudio.com/">Visual Studio Code</a> ou un autre editeur de code.</li>
<li>On installe aussi <a href="https://marketplace.visualstudio.com/items?itemName=ms-dotnettools.csharp">l'extension C#</a> pour VSCode.</li>
<li>On installe localement le <a href="https://dotnet.microsoft.com/en-us/download">SDK .NET</a> pour VSCode.</li>
</ul>
<h5>Hello World</h5>
<p>Le tutoriel Hello World n'est pas très utile en soi, mais il faut bien commencer quelque part, j'ai donc passé moins de 2 minutes sur l'exécution de la commande:</p>
<pre><code>Console.WriteLine(&quot;Hello World!&quot;);
</code></pre>
<p>Ce premier cours est disponible <a href="https://learn.microsoft.com/fr-fr/training/modules/csharp-write-first/2-exercise-hello-world?WT.mc_id=dotnet-35129-website&amp;ns-enrollment-type=learningpath&amp;ns-enrollment-id=learn.build-dotnet-applications-csharp">ici</a></p>
<h2>Créer une API web avec <a href="http://ASP.NET">ASP.NET</a> Core</h2>
<p>Supposons que nous souhaitons créer une gestion de profils d'utilisateurs pour une application web quelconque. Un utilisateur doit comporter un pseudo, un numéro unique en guise d'id, un âge, et un booléen indiquant si le compte a été activé ou non.
Le service créer permettra d'ajouter, d'afficher, de modifier et de supprimer des utilisateurs. On cherche donc à créer des requêtes CRUD (Create, Read, Update, Delete) en C# pour des objets User.</p>
<p>On apprendra ici à créer une application d'API web grâce à <a href="http://ASP.NET">ASP.NET</a> Core. On executera cette API et on pourra la tester à partir du CLI en ajoutant, supprimant, updatant, lisant des utilisateurs.</p>
<p>Les méthodes HTTP que nous allons créer seront les méthodes</p>
<ul>
<li><code>GET</code></li>
<li><code>POST</code></li>
<li><code>PUT</code></li>
<li><code>DELETE</code></li>
</ul>
<h3>Création du projet</h3>
<p>Tout d'abord, afin d'utiliser le module nécessaire à la création de l'API, on vérifie que .NET 6.0 est correctement installé en entrant la commande suivante:</p>
<pre><code>dotnet --list-sdks
</code></pre>
<p>Si la sortie ressemble à ceci, alors c'est bon.</p>
<pre><code>3.1.100 [C:\program files\dotnet\sdk]
5.0.100 [C:\program files\dotnet\sdk]
6.0.100 [C:\program files\dotnet\sdk]
</code></pre>
<p>Dans Visual Studio Code, on commence par ouvrir un dossier au nom de notre projet, ici je l'appelerai &quot;APIUser&quot;
Une fois le dossier ouvert, on créer notre projet d'API web de base en entrant dans le terminal</p>
<pre><code>dotnet new webapi -f net6.0
</code></pre>
<p>On aura maintenant accès à ces dossiers et fichiers dans notre répertoire:</p>
<pre class="language-bash " style="counter-reset: linenumber 0"><code class="language-bash">-<span class="token operator">|</span> Controllers
-<span class="token operator">|</span> obj
-<span class="token operator">|</span> Properties
-<span class="token operator">|</span> appsettings.Development.json
-<span class="token operator">|</span> appsettings.json
-<span class="token operator">|</span> APIWeb.csproj
-<span class="token operator">|</span> Program.cs
-<span class="token operator">|</span> WeatherForecast.cs
</code></pre>
<p>Ces fichiers correspondent à une API météo. On peut se baser sur le contenu de ces fichiers pour créer notre API, mais dans notre cas nous crérons un autre contrôleur.</p>
<h3>La classe User</h3>
<p>Dans un dossier Models que l'on crée avec la commande <code>mkdir Models</code> on créera notre fichier <code>User.cs</code> qui comportera notre classe utilisateur.</p>
<p>Dans ce fichier on écrit le code suivant afin de définir la classe User:</p>
<pre class="language-csharp " style="counter-reset: linenumber 0"><code class="language-csharp"><span class="token keyword">namespace</span> <span class="token namespace">APIUser<span class="token punctuation">.</span>Models</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span><span class="token punctuation">?</span></span> Age <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span><span class="token punctuation">?</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsActivated <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3>Le service de données</h3>
<p>Pareil que précédemment, on se sert de la commande <code>mkdir Services</code> pour créer un dossier Services dans lequel nous créerons le fichier <code>UserService.cs</code>.
Ce fichier va nous permettre de créer des méthodes de stockage d'utilisateur en local.</p>
<p>On entre le code suivant:</p>
<pre class="language-csharp " style="counter-reset: linenumber 0"><code class="language-csharp"><span class="token keyword">using</span> <span class="token namespace">APIUser<span class="token punctuation">.</span>Models</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">APIUser<span class="token punctuation">.</span>Services</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span>
<span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>User<span class="token punctuation">></span></span> Users <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">static</span> <span class="token class-name"><span class="token keyword">int</span></span> nextId <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token function">UserService</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Users <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>User<span class="token punctuation">></span></span>
        <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token constructor-invocation class-name">User</span> <span class="token punctuation">{</span> Id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> Name <span class="token operator">=</span> <span class="token string">"admin"</span><span class="token punctuation">,</span> Age <span class="token operator">=</span> <span class="token string">"99"</span><span class="token punctuation">,</span> IsActivated <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>User<span class="token punctuation">></span></span> <span class="token function">GetAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> Users<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">User<span class="token punctuation">?</span></span> <span class="token function">Get</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">)</span> <span class="token operator">=></span> Users<span class="token punctuation">.</span><span class="token function">FirstOrDefault</span><span class="token punctuation">(</span>u <span class="token operator">=></span> u<span class="token punctuation">.</span>Id <span class="token operator">==</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Add</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        user<span class="token punctuation">.</span>Id <span class="token operator">=</span> nextId<span class="token operator">++</span><span class="token punctuation">;</span>
        Users<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Delete</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> user <span class="token operator">=</span> <span class="token function">Get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>user <span class="token keyword">is</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>

        Users<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> index <span class="token operator">=</span> Users<span class="token punctuation">.</span><span class="token function">FindIndex</span><span class="token punctuation">(</span>u <span class="token operator">=></span> u<span class="token punctuation">.</span>Id <span class="token operator">==</span> user<span class="token punctuation">.</span>Id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>index <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>

        Users<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> user<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Les méthodes Get, GetAll, Add, Delete et Update sont maintenant créées afin de gérer la liste d'utilisateur stockée localement dans la variable de liste Users. Le code est assez facile à comprendre, il faut simplement réapprendre la syntaxe de ce langage.</p>
<h3>Ajout d'un contrôleur</h3>
<p>Dans le dossier <code>Controllers</code> déjà existant, on crée notre fichier <code>UserController</code>, et dans ce fichier on ajoute le code suivant:</p>
<pre class="language-csharp " style="counter-reset: linenumber 0"><code class="language-csharp"><span class="token keyword">using</span> <span class="token namespace">APIUser<span class="token punctuation">.</span>Models</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">APIUser<span class="token punctuation">.</span>Services</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Mvc</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">APIUser<span class="token punctuation">.</span>Controllers</span><span class="token punctuation">;</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ApiController</span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"[controller]"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ControllerBase</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token function">UserController</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// C'est ici que nous rédigerons nos fonction GET, GETALL, POST, PUT, et DELETE</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Notre classe UserController fraichement créée se base sur la classe ControllerBase fournit par <a href="http://ASP.NET">ASP.NET</a> Core pour l'utilisation des requêtes HTTP.</p>
<p>Dans la suite, il faut savoir que les attributs entre crochets vont définir quel type de méthode on aura affaire. Le type ActionResult est la classe de base pour les résultats d'action d'<a href="http://ASP.NET">ASP.NET</a> Core</p>
<h5>Méthode GETALL</h5>
<p>Pour afficher tous les utilisateurs on se sert donc de l'attribut <code>[HttpGet]</code>:</p>
<pre class="language-csharp " style="counter-reset: linenumber 0"><code class="language-csharp"><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpGet</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name">ActionResult<span class="token punctuation">&lt;</span>List<span class="token punctuation">&lt;</span>User<span class="token punctuation">></span><span class="token punctuation">></span></span> <span class="token function">GetAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span>
    UserService<span class="token punctuation">.</span><span class="token function">GetAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h5>Méthode GET(id)</h5>
<p>Pour afficher un seul utilisateur on se sert de l'attribut <code>[HttpGet]</code> en ajoutant le fait que l'on veuille le chercher par ID. Si l'utilisateur n'existe pas, on renvoie le résultat NotFound() qui renvoie un code 404:</p>
<pre class="language-csharp " style="counter-reset: linenumber 0"><code class="language-csharp"><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpGet</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"{id}"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name">ActionResult<span class="token punctuation">&lt;</span>User<span class="token punctuation">></span></span> <span class="token function">Get</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> user <span class="token operator">=</span> UserService<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token function">NotFound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> user<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h5>Méthode POST(user)</h5>
<p>Pour ajouter un nouvel utilisateur, on se sert de l'attribut <code>[HttpPost]</code>. Ici on remplace ActionResult par IActionResult qui est un type permettant de savoir si la demande a bien réussi et fournit l'ID de l'utilisateur fraichement créé.</p>
<pre class="language-csharp " style="counter-reset: linenumber 0"><code class="language-csharp"><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpPost</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">Create</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span>
<span class="token punctuation">{</span>            
    UserService<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">CreatedAtAction</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>Get<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token punctuation">{</span> id <span class="token operator">=</span> user<span class="token punctuation">.</span>Id <span class="token punctuation">}</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h5>Méthode PUT(user)</h5>
<p>Pour update un utilisateur, , on se sert de l'attribut <code>[HttpPut]</code>. On vérifie bien sûr que l'élément existe avant de l'updater. Elle prend deux paramètres qui sont l'id et l'objet User que l'on veut mettre à jour.</p>
<pre class="language-csharp " style="counter-reset: linenumber 0"><code class="language-csharp"><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpPut</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"{id}"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">,</span> <span class="token class-name">User</span> user<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">!=</span> user<span class="token punctuation">.</span>Id<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token function">BadRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           
    <span class="token class-name"><span class="token keyword">var</span></span> existingUser <span class="token operator">=</span> UserService<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>existingUser <span class="token keyword">is</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token function">NotFound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   
    UserService<span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>           
   
    <span class="token keyword">return</span> <span class="token function">NoContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h5>Méthode DELETE(id)</h5>
<p>Pour supprimer un utilisateur on utilise <code>[HttpDelete(&quot;{id}&quot;)]</code>. On cherche si l'utilisateur existe bien avant de le supprimer à l'aide de la méthode GET par id, sinon on renvoie une erreur 404 NotFound().</p>
<pre class="language-csharp " style="counter-reset: linenumber 0"><code class="language-csharp"><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpDelete</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"{id}"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">Delete</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> user <span class="token operator">=</span> UserService<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
   
    <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token keyword">is</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token function">NotFound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       
    UserService<span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
   
    <span class="token keyword">return</span> <span class="token function">NoContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h3>Execution de l'API</h3>
<p>Pour générer l'API web, on peut exécuter la commande suivante:</p>
<pre><code>dotnet run
</code></pre>
<p>Dans un autre terminal (on peut ouvrir un 2ème terminal dans Visual Studio Code), on accède à l'API Web grâce à la commande:</p>
<pre><code>httprepl https://localhost:{PORT}
</code></pre>
<p>Il faut bien sûr renseigner le port adéquat qui est fournit dans le CLI après avoir lancé la première commande.</p>
<p>On accède au point de terminaison <code>User</code> grâce à la commande:</p>
<pre><code>cd User
</code></pre>
<p>Puis pour afficher les actions que l'on peut faire sur l'API User, on exécute la commande suivante:</p>
<pre><code>ls
</code></pre>
<p>Si tout est correct, on devrait voir afficher ceci:</p>
<pre><code>    https://localhost:{PORT}/User&gt; ls
    .      [GET|POST]
    ..     []
    {id}   [GET|PUT|DELETE]
</code></pre>
<p>Ce qui indique que les méthodes ont bien été compilées.</p>
<h3>Exemple de requêtes</h3>
<p>On peut exécuter une requête POST pour ajouter un nouvel User dans HttpRepl en utilisant la commande suivante :</p>
<pre><code>post -c &quot;{&quot;age&quot;:90, &quot;name&quot;:&quot;Savinien&quot;,, &quot;isActivated&quot;:false}&quot;
</code></pre>
<p>On peut le mettre à jour grâce à la commande (il faut préciser l'id):</p>
<pre><code>put 2 -c &quot;{&quot;age&quot;:90, &quot;name&quot;:&quot;Savinien&quot;,, &quot;isActivated&quot;:true}&quot;
</code></pre>
<p>Si la sortie est la suivante alors ça a fonctionné:</p>
<pre><code>HTTP/1.1 204 No Content
Date: Fri, 20 Jan 2022 22:14:43 GMT
Server: Kestrel
</code></pre>
<p>Pour vérifier que l'utilisateur a été mis à jour on essaye de l'afficher:</p>
<pre><code>get 2
</code></pre>
<p>Notre utilisateur devrait donc s'afficher:</p>
<pre><code>HTTP/1.1 200 OK
Content-Type: application/json; charset=utf-8
Date: Fri, 20 Jan 2022 22:15:55 GMT
Server: Kestrel
Transfer-Encoding: chunked

{
    &quot;id&quot;: 2,
    &quot;age&quot;: 90, 
    &quot;name&quot;: &quot;Savinien&quot;, 
    &quot;isActivated&quot;: true
}
</code></pre>
<p>Pour le supprimer, il suffit d'exécuter:</p>
<pre><code>delete 2
</code></pre>
<p>Cette commande renvoie un résultat 204 No Content pour une réussite, et affiche:</p>
<pre><code>HTTP/1.1 204 No Content
Date: Fri, 20 Jan 2022 22:18:20 GMT
Server: Kestrel
</code></pre>
<p>En exécutant la commande suivante, on affiche tous les utilisateurs et on se rend compte que l'utilisateur précédemment créé est bien supprimé et ne figure plus dans la liste.</p>
<pre><code>get
</code></pre>
<h2>Ressources</h2>
<p>La plupart des ressources utilises pour apprendre le C# se trouvent sur le site web de Microsoft et sont très bien faites.</p>
<ul>
<li>
<p><a href="https://learn.microsoft.com/fr-fr/">Microsoft Learn</a></p>
</li>
<li>
<p><a href="https://dotnet.microsoft.com/en-us/learn/videos">Video .NET</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/fr-fr/training/modules/csharp-write-first/">Écrire vos premières lignes de code en C#</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/fr-fr/training/modules/build-web-api-aspnet-core/">Créer une API web avec des contrôleurs ASP.NET Core</a></p>
</li>
</ul>


</article>

        </main>


        <footer class="min-h-[50px] border-t-2 border-gray-200 mt-4">
            <div class="max-w-[1000px] mx-auto px-4">
                <div class="min-h-[50px] flex justify-center items-center">
                    <p class="text-center">
                        <span style="font-family: Consolas, sans-serif;">Do_<span style="color: #4a86e8">It</span></span> : Développent et Organisation en IT
                    </p>
                </div>
            </div>
        </footer>

        <script>
        MathJax
            .startup
            .document
            .getMathItemsWithin(document.body);
        </script>

    </body>
</html>
