
<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>Coté Web</title>

        <link href="/do-it/assets/node_modules/prismjs/themes/prism-solarizedlight.min.css" rel="stylesheet">
        <link href="/do-it/assets/node_modules/prismjs/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet">

        <link href="/do-it/assets/stylesheets/main.css" rel="stylesheet">
    </head>
    <body>
        <script>
        window.MathJax = {
            tex: {
            inlineMath: [
                [
                '$', '$'
                ],
                [
                '\\(', '\\)'
                ]
            ]
            },
            svg: {
            fontCache: 'global'
            }
        };
        </script>
        <script type="text/javascript" id="MathJax-script" src="/do-it/assets/node_modules/mathjax/es5/tex-svg-full.js"></script>

        <header class="border-b-2 border-gray-200 mb-4">
        <div class="max-w-[1000px] mx-auto px-4">
            <div class="min-h-[50px] flex justify-between items-center">
                <a class="mx-2" href="/do-it/">Home</a>
                <div class="flex items-center gap-4 sm:gap-6 ">
                    <a class="" href="/do-it/cs">CS</a>
                    <a class="" href="/do-it/pok">POK</a>
                    <a class="" href="/do-it/mon">MON</a>
                    <a class="" href="/do-it/projets">Projets</a>
                    <a class="hidden sm:block" href="/do-it/promos">Promos</a>
                    <a href="/do-it/search">
                        <svg class="h-5 aspect-square" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"></path>
                        </svg>
                    </a>
                    <a class="hidden sm:block" href="https://github.com/FrancoisBrucker/do-it" target="_blank">
                        <svg class="h-5 aspect-square" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg>
                    </a>
                </div>
            </div>
        </div>
        </header>

        <main class="max-w-[1000px] mx-auto px-4" data-pagefind-body="">
            
<article class="relative">
<h1 class="mb-1">Coté Web</h1>
<div class="mb-4">
    
        <div class="px-4 flex flex-wrap items-center">
            
                <div class="font-bold">Tags : </div>
            
            <ul class="flex flex-wrap overflow-auto not-prose list-none my-1 mx-0 px-1 gap-1" data-pagefind-meta="Tags">
                
                    <li class="bg-yellow-200 rounded-full px-2" data-pagefind-filter="Tags">MON</li>
                
                    <li class="bg-yellow-200 rounded-full px-2" data-pagefind-filter="Tags">2022-2023</li>
                
                    <li class="bg-yellow-200 rounded-full px-2" data-pagefind-filter="Tags">serveur</li>
                
                    <li class="bg-yellow-200 rounded-full px-2" data-pagefind-filter="Tags">temps 2</li>
                

            </ul>
            
            
            <div class="hidden" data-pagefind-meta="Type">
                
                    
                
                    
                
                    
                
                    
                
            </div>
        </div>
    

    
        <div class="px-4 flex flex-wrap items-center">
            <div class="font-bold">Auteurs : </div>
            <ul class="flex flex-wrap not-prose list-none my-1 mx-0 px-1 gap-1" data-pagefind-meta="Auteurs">
                
                    <li class="bg-blue-200 rounded-full px-2" data-pagefind-filter="Auteurs">Gabriel BARBE</li>
                
            </ul>
        </div>
    

    
</div>



    
<div class="quote relative  py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-purple-500 bg-purple-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-purple-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"></path>
</svg>
<div class="pl-8 mr-8">

<a href="/do-it/promos/">Promotions</a><span class="px-1">/</span><a href="/do-it/promos/2022-2023/">2022-2023</a><span class="px-1">/</span><a href="/do-it/promos/2022-2023/Barbé-Gabriel/">Gabriel Barbé</a><span class="px-1">/</span><a href="/do-it/promos/2022-2023/Barbé-Gabriel/mon/">MON de Gabriel</a><span class="px-1">/</span><a href="/do-it/promos/2022-2023/Barbé-Gabriel/mon/coteweb/">Coté Web</a>

</div></div>




<!-- Début Résumé -->
<p>MON sur le developpement côté serveur suivi sur le site de M. Brucker puis sur mdn developper. <br>
Nous apprendrons entre autre à créer une base de données, l'utiliser, la modifier depuis le site web mais aussi apprendre le &quot;back-end&quot; et l'associer au &quot;front-end&quot;. Ce cours sera constitué de deux partie. <br>
Niveau : Intermédiaire<br>
Prérequis : <a href="Devweb1.md">DevWeb1</a>, <a href="Devweb2.md">DevWeb2</a></p>
<!-- Fin Résumé -->
<h2>Préambule</h2>
<p>J'ai affiché un niveau intermédiaire mais j'aurais tout aussi bien pu mettre facile, en effet le cours est relativement accessible étant donné que je suis moi-même un débutant, et qu'avec le temps alloué j'ai été capable d'effectuer les taches voulues. Néanmoins, pour les débutants, il vous faudra sortir de votre zone de confort et être motivé car il y a des passages quelques peu ardus où avoir un projet en tête aide. Pour moi ce cours a été suivi dans l'idée de réaliser mon projet <a href="/do-it/src/pok/GB-TB/index.md">PFC</a> que vous pouvez aussi visiter pour mieux comprendre mes intentions. <br>
Mes sources principales sont le cours de François Brucker <a href="https://francoisbrucker.github.io/cours_informatique/cours/web/">Web</a> et un cours en anglais  sur le site <a href="https://developer.mozilla.org/en-US/docs/Learn/Server-side/Express_Nodejs/development_environment">MDN Developer</a><br>
Bon cours !</p>
<h2>Coté serveur</h2>
<h3>Lire des données</h3>
<p>Afin de lire des données sur un site web et les réutiliser ensuite, on utilise la fonction javascript &quot;fetch&quot;. Cette dernière est fondamentale dans l'utilisation des bases de données. La fonction fetch peut être utilisé sur des fichiers textes, des images ou du json (<a href="Devweb1.md">voir Devweb 1</a>) à condition que ces dernières soient sur un serveur web !</p>
<h3>Serveur web minimal</h3>
<p>On peut créer un &quot;serveur minimal&quot; grâce à node simplement avec la commande shell :</p>
<pre class="language-bash " style="counter-reset: linenumber 0"><code class="language-bash"><span class="token function">node</span> index.js
</code></pre>
<p>Cette commande crée un serveur minimal en local.
Ce serveur suit le protocole http c'est à dire une suite de requête de l'utilsateur et de réponse de la machine.</p>
<h3>Création du premier projet grâce à Node/Express</h3>
<p>Express est un framework de node, lui-même environnement de développement, permettant de coder des sites côtés serveurs. Tout l'intéret de l'apprentissage de ce MON est de basculer le site créer avec le premier POK : &quot;Mon site chez moi&quot; coté serveur.<br>
Le framework Express crée tout le &quot;squelette&quot; de notre site web et l'importe sur un serveur local. Ce serveur est localisé à <a href="http://localhost:3000/">http://localhost:3000/</a>.
Nous obtenons donc notre premier site web sur serveur : <img src="../Images/Express.png">
Nous avons pour le moment les dossiers suivants dans notre environnement de programmation : <img src="../Images/Dossiers.PNG"></p>
<ul>
<li>le dossier &quot;bin&quot; contient un fichier &quot;www&quot; qui représente l'hébergement de notre site</li>
<li>les dossiers &quot;models&quot; ainsi que &quot;public&quot; sont vides pour le moment : &quot;models&quot; nous servira pour la base de données et &quot;public&quot; pour les images et les styles.</li>
<li>&quot;routes&quot; indique les routes</li>
<li>&quot;views&quot; est là où l'on code l'interface.</li>
<li>les fichiers &quot;.json&quot; sont l'identité de notre projet et le fichier app.js est l'endroit où l'on programme notre site et ressemble pour le moment à ceci :</li>
</ul>
<pre class="language-bash " style="counter-reset: linenumber 0"><code class="language-bash">var createError <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">'http-errors'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
var express <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
var path <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
var cookieParser <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">'cookie-parser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
var logger <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">'morgan'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

var indexRouter <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">'./routes/index'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
var usersRouter <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">'./routes/users'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

var app <span class="token operator">=</span> express<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

// view engine setup
app.set<span class="token punctuation">(</span><span class="token string">'views'</span>, path.join<span class="token punctuation">(</span>__dirname, <span class="token string">'views'</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
app.set<span class="token punctuation">(</span><span class="token string">'view engine'</span>, <span class="token string">'jade'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app.use<span class="token punctuation">(</span>logger<span class="token punctuation">(</span><span class="token string">'dev'</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
app.use<span class="token punctuation">(</span>express.json<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
app.use<span class="token punctuation">(</span>express.urlencoded<span class="token punctuation">(</span><span class="token punctuation">{</span> extended: <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
app.use<span class="token punctuation">(</span>cookieParser<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
app.use<span class="token punctuation">(</span>express.static<span class="token punctuation">(</span>path.join<span class="token punctuation">(</span>__dirname, <span class="token string">'public'</span><span class="token punctuation">))</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app.use<span class="token punctuation">(</span><span class="token string">'/'</span>, indexRouter<span class="token punctuation">)</span><span class="token punctuation">;</span>
app.use<span class="token punctuation">(</span><span class="token string">'/users'</span>, usersRouter<span class="token punctuation">)</span><span class="token punctuation">;</span>

// catch <span class="token number">404</span> and forward to error handler
app.use<span class="token punctuation">(</span>function<span class="token punctuation">(</span>req, res, next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  next<span class="token punctuation">(</span>createError<span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

// error handler
app.use<span class="token punctuation">(</span>function<span class="token punctuation">(</span>err, req, res, next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  // <span class="token builtin class-name">set</span> locals, only providing error <span class="token keyword">in</span> development
  res.locals.message <span class="token operator">=</span> err.message<span class="token punctuation">;</span>
  res.locals.error <span class="token operator">=</span> req.app.get<span class="token punctuation">(</span><span class="token string">'env'</span><span class="token punctuation">)</span> <span class="token operator">==</span><span class="token operator">=</span> <span class="token string">'development'</span> ? err <span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  // render the error page
  res.status<span class="token punctuation">(</span>err.status <span class="token operator">||</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res.render<span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module.exports <span class="token operator">=</span> app<span class="token punctuation">;</span>
</code></pre>
<h3>Utiliser une base de donnée</h3>
<p>Dans cette troisième partie nous apprenons à insérer une base de données sur notre site express via mongoose et mangodb. Cette partie fondamentale est surement la plus compliqué que j'ai effectuée en informatique depuis cette année. <br>
Nous avons commencé par créer un compte sur hhtp://cloud.mongodb.com/ puis le tout est de connecter notre application ou site avec la database présente sur le cloud. Pour se faire, nous utilisons le lien que nous donne mangodb : 'mongodb+srv://username:password!@cluster0.kngjtje.mongodb.net/?retryWrites=true&amp;w=majority' que nous lions avec notre projet dans le fichier app.js :</p>
<pre class="language-bash " style="counter-reset: linenumber 0"><code class="language-bash">var mongoose <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">'mongoose'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
var dev_db_url <span class="token operator">=</span> <span class="token string">'mongodb+srv://username:password!@cluster0.kngjtje.mongodb.net/?retryWrites=true&amp;w=majority'</span><span class="token punctuation">;</span>
var mongoDB <span class="token operator">=</span> process.env.MONGODB_URI <span class="token operator">||</span> dev_db_url<span class="token punctuation">;</span>
mongoose.connect<span class="token punctuation">(</span>mongoDB, <span class="token punctuation">{</span>useNewUrlParser: true, useUnifiedTopology: true<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mongoose.Promise <span class="token operator">=</span> global.Promise<span class="token punctuation">;</span>
var db <span class="token operator">=</span> mongoose.connection<span class="token punctuation">;</span>
db.on<span class="token punctuation">(</span><span class="token string">'error'</span>, console.error.bind<span class="token punctuation">(</span>console, <span class="token string">'MongoDB connection error:'</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
</code></pre>
<p>Nous crééons ensuite une base de donnée comprenant des chaines de caractères, des dates, des nombres etc. Cette base est crée par l'intermédiaire d'un nouveau fichier &quot;populatedb.js&quot; qui nous sert à peupler la base de données. Ce fichier contient par exemple des fonctions telles que :</p>
<pre class="language-bash " style="counter-reset: linenumber 0"><code class="language-bash"><span class="token keyword">function</span> personCreate<span class="token punctuation">(</span>first_name, family_name, d_birth, d_death, cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  persondetail <span class="token operator">=</span> <span class="token punctuation">{</span>first_name:first_name , family_name: family_name <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>d_birth <span class="token operator">!=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> persondetail.date_of_birth <span class="token operator">=</span> d_birth
  <span class="token keyword">if</span> <span class="token punctuation">(</span>d_death <span class="token operator">!=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> persondetail.date_of_death <span class="token operator">=</span> d_death
  
  var person <span class="token operator">=</span> new Person<span class="token punctuation">(</span>authordetail<span class="token punctuation">)</span><span class="token punctuation">;</span>
       
  person.save<span class="token punctuation">(</span>function <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      cb<span class="token punctuation">(</span>err, null<span class="token punctuation">)</span>
      <span class="token builtin class-name">return</span>
    <span class="token punctuation">}</span>
    console.log<span class="token punctuation">(</span><span class="token string">'New Player: '</span> + person<span class="token punctuation">)</span><span class="token punctuation">;</span>
    persons.push<span class="token punctuation">(</span>person<span class="token punctuation">)</span>
    cb<span class="token punctuation">(</span>null, person<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> createGenrePersons<span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    async.series<span class="token punctuation">(</span><span class="token punctuation">[</span>
        function<span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          playerCreate<span class="token punctuation">(</span><span class="token string">'Patrick'</span>, <span class="token string">'Rothfuss'</span>, <span class="token string">'1973-06-06'</span>, false, callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>,
        function<span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          playerCreate<span class="token punctuation">(</span><span class="token string">'Ben'</span>, <span class="token string">'Bova'</span>, <span class="token string">'1932-11-8'</span>, false, callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>,
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Cette fonction renvoi à un autre fichier, &quot;person.js&quot;, stocké dans &quot;models&quot; définissant l'objet &quot;personne&quot;.</p>
<pre class="language-bash " style="counter-reset: linenumber 0"><code class="language-bash">const mongoose <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">"mongoose"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

const Schema <span class="token operator">=</span> mongoose.Schema<span class="token punctuation">;</span>

const PersonSchema <span class="token operator">=</span> new Schema<span class="token punctuation">(</span><span class="token punctuation">{</span>
  first_name: <span class="token punctuation">{</span> type: String, required: true, maxLength: <span class="token number">100</span> <span class="token punctuation">}</span>,
  family_name: <span class="token punctuation">{</span> type: String, required: true, maxLength: <span class="token number">100</span> <span class="token punctuation">}</span>,
  date_of_birth: <span class="token punctuation">{</span> type: Date <span class="token punctuation">}</span>,
  date_of_death: <span class="token punctuation">{</span> type: Date <span class="token punctuation">}</span>,
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

PersonSchema.virtual<span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span>.get<span class="token punctuation">(</span><span class="token function-name function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 
  <span class="token builtin class-name">let</span> fullname <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>this.first_name <span class="token operator">&amp;&amp;</span> this.family_name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fullname <span class="token operator">=</span> <span class="token variable"><span class="token variable">`</span>$<span class="token punctuation">{</span>this.family_name<span class="token punctuation">}</span>, $<span class="token punctuation">{</span>this.first_name<span class="token punctuation">}</span><span class="token variable">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>this.first_name <span class="token operator">||</span> <span class="token operator">!</span>this.family_name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fullname <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token builtin class-name">return</span> fullname<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

PersonSchema.virtual<span class="token punctuation">(</span><span class="token string">"url"</span><span class="token punctuation">)</span>.get<span class="token punctuation">(</span><span class="token function-name function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin class-name">return</span> <span class="token variable"><span class="token variable">`</span>/catalog/person/$<span class="token punctuation">{</span>this._id<span class="token punctuation">}</span><span class="token variable">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

// Export model
module.exports <span class="token operator">=</span> mongoose.model<span class="token punctuation">(</span><span class="token string">"Person"</span>, PersonSchema<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Nous pouvons retrouver cette base de données à tout moment sur mangodb : <img src="../Images/database.PNG"></p>
<h3>Routes</h3>
<p>Définition : Une route est une section de code qui associe un HTTP, un chemin URL et une fonction qui les associe sur le site. <br>
Express possède un middleware (sorte de pont entre différentes applications web) permettant de créer des routes directement. Ce middleware permet de créer des routes pour les requêtes : &quot;get&quot;, &quot;post&quot;, &quot;delete&quot;, &quot;copy&quot;, &quot;subscribe&quot;... et bien d'autres. Ainsi, pour chaque filtre de notre base de données, nous créons un fichier où l'on code toutes les requêtes souhaitées. Nous plaçons ces fonctions dans un dossier &quot;controller&quot;.<br>
Un exemple de fichier &quot;listController&quot; peut-être :</p>
<pre class="language-bash " style="counter-reset: linenumber 0"><code class="language-bash">const Element <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">"../models/element"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

//Liste tous les éléments
exports.list <span class="token operator">=</span> <span class="token punctuation">(</span>req, res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  res.send<span class="token punctuation">(</span><span class="token string">"NOT IMPLEMENTED: Element list"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>Ce code crée un URL où l'on listera tous les éléments de notre base de données. Nous verrons plus tard comment l'associer réellement à notre BDD.
Le code suivant permet ensuite de créer la route en tant que tel, nous le plaçons donc dans le dossier express &quot;routes&quot; :</p>
<pre class="language-bash " style="counter-reset: linenumber 0"><code class="language-bash">const list_controller <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">"../controllers/listController"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

//Page principale <span class="token function">du</span> site
router.get<span class="token punctuation">(</span><span class="token string">"/"</span>, list_controller.index<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Les routes &quot;index&quot; et &quot;users&quot; sont automatiquement implantées dans le fichier &quot;app.js&quot; mais on peut rajoutés des fichiers dans &quot;Routes&quot; et les relier dans &quot;app.js&quot;. <br></p>
<h3>Mis en page du site web</h3>
<p>Nous avons désormais nos routes et notre base de donnée prête à être utilisée. Il nous reste donc à exploiter (dans un premier temps plus simplement afficher) les données sur notre site. Pour se faire, nous allons effectuer des modifications dans 2 dossiers : controller et view. Ces deux dossiers sont reliés et on peut considérer que les fichier controllers sont le &quot;back&quot; alors que les fichiers views sont le &quot;front&quot;. En effet, les dossier view sont écrit en pug, un dérivé de html, et décrira explicitement ce que &quot;verra&quot; l'utilisateur. <br>
En l'état actuel, notre page affiche le message : &quot;Not implemented : Element list&quot;. Il nous suffit simplement de remplacer la fonction &quot;export.list&quot; dans &quot;listController&quot; et elle pourra ensuite afficher notre base de donnée :</p>
<pre class="language-bash " style="counter-reset: linenumber 0"><code class="language-bash">exports.list <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req, res, next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Element.find<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span>, <span class="token string">"Information 1"</span><span class="token punctuation">)</span>
    .sort<span class="token punctuation">(</span><span class="token punctuation">{</span> title: <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    .exec<span class="token punctuation">(</span>function <span class="token punctuation">(</span>err, list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token builtin class-name">return</span> next<span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      res.render<span class="token punctuation">(</span><span class="token string">"list"</span>, <span class="token punctuation">{</span> title: <span class="token string">"List"</span>, list: books <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>Que l'on associe avec un fichier &quot;list.pug&quot; dans notre dossier &quot;View&quot; :</p>
<pre class="language-bash " style="counter-reset: linenumber 0"><code class="language-bash">extends layout

block content
  <span class="token assign-left variable">h1</span><span class="token operator">=</span> title

  ul
    each element <span class="token keyword">in</span> list
      li
        a<span class="token punctuation">(</span>href<span class="token operator">=</span>element.url<span class="token punctuation">)</span> <span class="token comment">#{element.title}</span>
    <span class="token keyword">else</span>
      li There are no books.
</code></pre>
<p>Nous pouvons bien-sûr associer ce fichier à un fichier CSS et à un fichier JS comme nous l'avons vu auparavant (voir <a href="../index.md">DevWeb</a>)</p>
<h3>Forms</h3>
<p>Nous sommes désormais capable de créer une base de données et de l'afficher sur notre site. Afin de créer des interactions avec l'utilisateur, nous souhaiterions lui donner la possibilité de modifier la base de données. Pour ceci, nous utilisons les &quot;forms&quot;. Ce sont des balises html qui donnent la possibilité à l'utilisateur de donner des informations et de les rentrer sur le serveur. <br>
Après que l'utilisateur ait rentré son nouvel élément, express-validator, que nous devons installer, se chargera de vérifier que la donnée correspond bien à celle attendue et sinon, enverra un message d'erreur.
Pour exemple, si l'on veut vérifier que notre donnée n'est pas un texte vide, il nous suffit d'insérer une ligne dans &quot;controller :</p>
<pre class="language-bash " style="counter-reset: linenumber 0"><code class="language-bash"><span class="token punctuation">[</span>
  body<span class="token punctuation">(</span><span class="token string">"name"</span>, <span class="token string">"Empty name"</span><span class="token punctuation">)</span>.trim<span class="token punctuation">(</span><span class="token punctuation">)</span>.isLength<span class="token punctuation">(</span><span class="token punctuation">{</span> min: <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>.escape<span class="token punctuation">(</span><span class="token punctuation">)</span>,
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre>
<p>Attention, il faut au préalable définir dans nos routes et nos controller si la donnée est de type &quot;GET&quot; ou &quot;POST&quot;. <br>
Nous crééons donc notre fonction de création puis nous la reportons dans un fichier view :</p>
<pre class="language-bash " style="counter-reset: linenumber 0"><code class="language-bash">exports.humain_create_post <span class="token operator">=</span> <span class="token punctuation">[</span>

  body<span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span>
    .trim<span class="token punctuation">(</span><span class="token punctuation">)</span>
    .isLength<span class="token punctuation">(</span><span class="token punctuation">{</span> min: <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    .escape<span class="token punctuation">(</span><span class="token punctuation">)</span>
    .withMessage<span class="token punctuation">(</span><span class="token string">"First name must be specified."</span><span class="token punctuation">)</span>
    .isAlphanumeric<span class="token punctuation">(</span><span class="token punctuation">)</span>
    .withMessage<span class="token punctuation">(</span><span class="token string">"First name has non-alphanumeric characters."</span><span class="token punctuation">)</span>,
    <span class="token punctuation">(</span>req, res, next<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    
    const errors <span class="token operator">=</span> validationResult<span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>errors.isEmpty<span class="token punctuation">(</span><span class="token punctuation">))</span> <span class="token punctuation">{</span>
      res.render<span class="token punctuation">(</span><span class="token string">"person_form"</span>, <span class="token punctuation">{</span>
        title: <span class="token string">"Create Humain"</span>,
        person: req.body,
        errors: errors.array<span class="token punctuation">(</span><span class="token punctuation">)</span>,
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token builtin class-name">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    const person <span class="token operator">=</span> new Person<span class="token punctuation">(</span><span class="token punctuation">{</span>
      name: req.body.name,
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    person.save<span class="token punctuation">((</span>err<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token builtin class-name">return</span> next<span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      res.redirect<span class="token punctuation">(</span>person.url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>,
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre>
<p>Nous créons finalement un fichier &quot;person_form.pug&quot; dans view où nous mettons :</p>
<pre class="language-bash " style="counter-reset: linenumber 0"><code class="language-bash">form<span class="token punctuation">(</span>method<span class="token operator">=</span><span class="token string">'POST'</span> <span class="token assign-left variable">action</span><span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>
    div.form-group
      label<span class="token punctuation">(</span>for<span class="token operator">=</span><span class="token string">'name'</span><span class="token punctuation">)</span> Name:
      input<span class="token comment">#name.form-control(type='text' placeholder='Name' name='name' required='true' value=(undefined===person ? '' : person.first_name) )</span>
    button.btn.btn-primary<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'submit'</span><span class="token punctuation">)</span> Submit
  <span class="token keyword">if</span> errors
    ul
      <span class="token keyword">for</span> <span class="token for-or-select variable">error</span> <span class="token keyword">in</span> errors
        li<span class="token operator">!=</span> error.msg
</code></pre>
<p>Nous sommes désormais capable de mettre à jour notre base de données !</p>


</article>

        </main>


        <footer class="min-h-[50px] border-t-2 border-gray-200 mt-4">
            <div class="max-w-[1000px] mx-auto px-4">
                <div class="min-h-[50px] flex justify-center items-center">
                    <p class="text-center">
                        <span style="font-family: Consolas, sans-serif;">Do_<span style="color: #4a86e8">It</span></span> : Développent et Organisation en IT
                    </p>
                </div>
            </div>
        </footer>

        <script>
        MathJax
            .startup
            .document
            .getMathItemsWithin(document.body);
        </script>

    </body>
</html>
