
<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>Docker</title>

        <link href="/do-it/assets/node_modules/prismjs/themes/prism-solarizedlight.min.css" rel="stylesheet">
        <link href="/do-it/assets/node_modules/prismjs/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet">

        <link href="/do-it/assets/stylesheets/main.css" rel="stylesheet">
    </head>
    <body>
        <script>
        window.MathJax = {
            tex: {
            inlineMath: [
                [
                '$', '$'
                ],
                [
                '\\(', '\\)'
                ]
            ]
            },
            svg: {
            fontCache: 'global'
            }
        };
        </script>
        <script type="text/javascript" id="MathJax-script" src="/do-it/assets/node_modules/mathjax/es5/tex-svg-full.js"></script>

        <header class="border-b-2 border-gray-200 mb-4">
        <div class="max-w-[1000px] mx-auto px-4">
            <div class="min-h-[50px] flex justify-between items-center">
                <a class="mx-2" href="/do-it/">Home</a>
                <div class="flex items-center gap-4 sm:gap-6 ">
                    <a class="" href="/do-it/cs">CS</a>
                    <a class="" href="/do-it/pok">POK</a>
                    <a class="" href="/do-it/mon">MON</a>
                    <a class="" href="/do-it/projets">Projets</a>
                    <a class="hidden sm:block" href="/do-it/promos">Promos</a>
                    <a href="/do-it/search">
                        <svg class="h-5 aspect-square" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"></path>
                        </svg>
                    </a>
                    <a class="hidden sm:block" href="https://github.com/FrancoisBrucker/do-it" target="_blank">
                        <svg class="h-5 aspect-square" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg>
                    </a>
                </div>
            </div>
        </div>
        </header>

        <main class="max-w-[1000px] mx-auto px-4" data-pagefind-body="">
            
<article class="relative">
<h1 class="mb-1">Docker</h1>
<div class="mb-4">
    
        <div class="px-4 flex flex-wrap items-center">
            
                <div class="font-bold">Tags : </div>
            
            <ul class="flex flex-wrap overflow-auto not-prose list-none my-1 mx-0 px-1 gap-1" data-pagefind-meta="Tags">
                
                    <li class="bg-yellow-200 rounded-full px-2" data-pagefind-filter="Tags">MON</li>
                
                    <li class="bg-yellow-200 rounded-full px-2" data-pagefind-filter="Tags">2022-2023</li>
                
                    <li class="bg-yellow-200 rounded-full px-2" data-pagefind-filter="Tags">temps 1</li>
                
                    <li class="bg-yellow-200 rounded-full px-2" data-pagefind-filter="Tags">Docker</li>
                

            </ul>
            
            
            <div class="hidden" data-pagefind-meta="Type">
                
                    
                
                    
                
                    
                
                    
                
            </div>
        </div>
    

    
        <div class="px-4 flex flex-wrap items-center">
            <div class="font-bold">Auteurs : </div>
            <ul class="flex flex-wrap not-prose list-none my-1 mx-0 px-1 gap-1" data-pagefind-meta="Auteurs">
                
                    <li class="bg-blue-200 rounded-full px-2" data-pagefind-filter="Auteurs">Tuncay Bilgi</li>
                
            </ul>
        </div>
    

    
</div>



    
<div class="quote relative  py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-purple-500 bg-purple-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-purple-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"></path>
</svg>
<div class="pl-8 mr-8">

<a href="/do-it/promos/">Promotions</a><span class="px-1">/</span><a href="/do-it/promos/2022-2023/">2022-2023</a><span class="px-1">/</span><a href="/do-it/promos/2022-2023/Bilgi-Tuncay/">Tuncay Bilgi</a><span class="px-1">/</span><a href="/do-it/promos/2022-2023/Bilgi-Tuncay/mon/">MON de Tuncay Bilgi</a><span class="px-1">/</span><a href="/do-it/promos/2022-2023/Bilgi-Tuncay/mon/Docker/">Docker</a>

</div></div>




<h2>Docker :</h2>
<p>Docker est un outil qui peut empaqueter une application et ses dépendances dans un conteneur isolé, qui pourra être exécuté sur n'importe quel serveur
Il est largement utiliser dans la mise en production des applications.
Le MON consiste à prendre l'outil en main en suivant <a href="https://docs.docker.com/">la doc officielle</a> et un workshop <a href="https://www.youtube.com/watch?v=gAGEar5HQoU&amp;t=1400s&amp;ab_channel=Docker">officiel</a>.
Le but est d'en faire un maximum puisque l'on a moins de 10h sur ce MON.</p>
<div class="quote relative  py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-cyan-500 bg-cyan-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-cyan-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
</svg>
<div class="pl-8 mr-8">
<p>Le projet est mis en place sur Windows et je ne mettrais pas la doc pour Linux ou Mac.</p>
</div></div>
<div class="quote relative  py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-pink-500 bg-pink-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-pink-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
</svg>
<div class="pl-8 mb-2 mr-8">
<p>MON débutant</p>
</div><div class="pl-8 mr-8">
<p>Il faut connaître :</p>
<ul>
<li>des bases de bash et de Linux</li>
<li>l'utilisation d'un CLI (un terminal de commande)</li>
</ul>
</div></div>
<h2>Le Workshop :</h2>
<h3>Initialisation et premiers pas.</h3>
<p>Il faut installer Docker depuis <a href="https://www.docker.com/">le site officiel</a>.</p>
<p>Ensuite, on suit le workshop.</p>
<p>Docker permet d'empaqueter une application dans un conteneur, c'est à dire que le but est de créer, sur notre ordinateur, une boite isolée du reste du système. Cette boite va contenir le code de l'application que l'on veut mettre en production, et tout ce dont elle a besoin pour fonctionner.
Ces boites doivent donc posséder leur propre système d'exploitation. Nous n'allons pas recréer ce système nous même, mais nous allons chercher une image (une copie) de ce système sur un &quot;drive d'images&quot; sur internet. ON se dirige donc sur DockerHub qui contient pleins d'images, par exemple, on peut y récupérer l'image d'un système Linux avec la distribution Ubuntu.</p>
<h4>Hello World</h4>
<p>Pour chercher une image, ici une image de la distribution Linux Fedora, on se place dans le répertoire de notre projet et on lance :</p>
<p>docker pull fedora latest</p>
<p>Ensuite, pour notre premier hello world, on va effectuer une commande Linux avec le système fedora que l'on a téléchargé :</p>
<p>docker run fedora echo 'hello world'</p>
<p>Cette commande va initialiser un container à partir de l'image fedora et va l'utiliser pour lancer un echo, puis va s'arrêter.</p>
<p>on reçoit donc l'echo :</p>
<p>hello world</p>
<p>On peut utiliser cette commande avec des options à chercher dans docker --help .</p>
<div class="quote relative  py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-cyan-500 bg-cyan-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-cyan-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
</svg>
<div class="pl-8 mr-8">
<p>docker run --help //liste les commandes et les options
-i  //maintenir le container ouvert après l'executions des tâches
-t  //ouvrir un pseudo terminale
-d  // exécuter les taches en daemon -&gt; en arrière plan, dans un autre terminale.</p>
</div></div>
<p>D'autres commandes importantes :</p>
<p>docker ps //liste tous les containers en marche
docker stop [id] // arrête le container proprement
docker kill [id] // force l'arrêt
docker log -f [id] // renvoie tous les logs du container sur le terminale</p>
<h4>Dockerfile</h4>
<p>Une image est un template pour créer un container. Au lieu de simplement copier celle des autres, nous pouvons créer ou modifier les nôtres avec des Dockerfile.</p>
<p>On crée un Dockerfile dans le projet et on ouvre vscode dans le dossier courant :</p>
<p>&gt;&gt; New-Item Dockerfile
&gt;&gt; code .</p>
<p>On crée notre Dockerfile, il va chercher l'image fedora et lancer une commande pour nous qui va installer une dépendance, ici figlet, qui permet de faire de jolies echos.
Le Dockerfile ressemble à ça :</p>
<p>FROM fedora:latest</p>
<p>RUN yum install -y figlet</p>
<p>Enfin, on construit l'image dans le dossier courant (où il y a le Dockerfile) et on le nomme figlet :</p>
<p>&gt;&gt; docker build -t figlet .</p>
<p>Nous voila avec une nouvelle image figlet, que l'on peut utiliser pour instancier des containers comme au début du tutoriel!</p>
<div class="quote relative  py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-cyan-500 bg-cyan-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-cyan-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
</svg>
<div class="pl-8 mr-8">
<p>Les dockerfiles fonctionnent avec des mots clefs tel que FROM,RUN,CMD,ENTRYPOINT.. voir la doc pour savoir à quoi ils servent.</p>
</div></div>
<p>On peut publier notre image sur le dockerhub avec une commande spéciale :</p>
<p>docker build -t mon_pseudo_docker/nom_image:latest .</p>
<p>Puis sur docker desktop on clique sur push to hub.</p>
<h3>Conteneurisation d'un premier projet :</h3>
<p>Lors des cours de flask, on à eu l'occasion de coder un front en React et un back en flask, nous allons essayer de conteneuriser ça.
On commence à créer une image qui va créer le conteneur du front.</p>
<p>Le front utilise node et react.js.
On écrit un Dockerfile qui cherche l'image node de dockerhub, qui va chercher les dossiers spécifiant les dépendances et qui les installes avec npm. Ensuite, on exécute la commande qui lance le serveur pour le front.</p>
<p>FROM node:18-slim</p>
<p>WORKDIR /app</p>
<p>COPY [&quot;package.json&quot;, &quot;package-lock.json*&quot;, &quot;./&quot;]</p>
<p>RUN npm install</p>
<p>COPY . .</p>
<p>EXPOSE 3000</p>
<p>CMD [ &quot;npm&quot;,&quot;start&quot; ]</p>
<p>On lance ensuite un container de cette image en spécifiant le port 3000 et voila, on peut aller voir notre front sur localhost:3000.</p>
<div style=" display: grid;grid-template-columns: repeat(2, minmax(0, 1fr))">
  <img src="../images/container.png" alt="DockerDeskop" style="height: 200px; margin: 0 auto; border: 0;grid-column : 1 ;grid-row : 1">
  <img src="../images/front.png" alt="Front" style="height: 200px; margin: 0 auto; border: 0;grid-column : 2;grid-row : 1">
</div>
<h3>DockerCompose</h3>
<p>Pour containériser une application, il est plus utile de découper l'applications en différentes parties et de containériser chacune des composantes et de les faire communiquer. Pour cela, on utilise un fichier Dockercompose, qui construit plusieurs containers à partir de plusieurs images et qui les relies, d'une traite.</p>
<p>Pour tester cela, on continue la containérisation de l'app du cours de flask.</p>
<h4>Container Back-end</h4>
<p>on créer un Dockerfile qui va créer l'image de l'application flask :</p>
<p>FROM python:latest</p>
<p>WORKDIR /app</p>
<p>COPY requirements.txt requirements.txt</p>
<p>COPY requirements.dev.txt requirements.dev.txt</p>
<p>RUN pip install -r requirements.txt
RUN pip install -r requirements.dev.txt</p>
<p>COPY  . .</p>
<p>EXPOSE 5000</p>
<p>CMD [ &quot;python3&quot;, &quot;-m&quot; , &quot;flask&quot;, &quot;run&quot;, &quot;--host=0.0.0.0&quot;]</p>
<p>Puis on lance le container <code>docker run -d -p 5000:5000  python-flash</code> . On peut maintenant écouter le port 5000 et voir que tout fonctionne.</p>
<h4>Dockercompose file</h4>
<p>On possède maintenant deux images, une pour le front, une pour le back, on peut essayer de faire fonctionner les deux.</p>
<p>Pour cela on créer un Docker-composer.yml file.</p>
<p>version : '3'
services:
web :
build: flask
ports:
- '5000:5000'
environment:
FLASK_ENV: development
volumes :
- ./flask:/app</p>
<p>front :
build: react-todo
ports :
- '3000:3000'</p>
<p>db:
image : postgres
ports :
- '5432:5432'
environment:
POSTGRES_USER : test
POSTGRES_PASSWORD : test
POSTGRES_DB : postgres
volumes:
- db:/var/lib/postgresql/data</p>
<p>volumes:
db:
driver : local</p>
<p>Ce fichier préparer le lancement de trois containers basées sur :</p>
<ul>
<li>L'image présente dans ./flask</li>
<li>L'image dans ./react-todo</li>
<li>L'image du nom de postgres qu'il va chercher dans le dockerhub</li>
</ul>
<p>Ensuite, il relie les ports entre eux et fait passer les variables d'environnement, qui sont par défaut stockées dans le .env</p>
<p>Le résultat :</p>
<img src="../images/front+back.png" alt="Composer" style="height: 200px; margin: 0 auto; border: 0">
<p>Le Front communique avec le back et donc notre page Todo n'est plus toute blanche mais elle fetch les tasks présentes dans le back flask et sa base de données sqlite.</p>


</article>

        </main>


        <footer class="min-h-[50px] border-t-2 border-gray-200 mt-4">
            <div class="max-w-[1000px] mx-auto px-4">
                <div class="min-h-[50px] flex justify-center items-center">
                    <p class="text-center">
                        <span style="font-family: Consolas, sans-serif;">Do_<span style="color: #4a86e8">It</span></span> : Développent et Organisation en IT
                    </p>
                </div>
            </div>
        </footer>

        <script>
        MathJax
            .startup
            .document
            .getMathItemsWithin(document.body);
        </script>

    </body>
</html>
