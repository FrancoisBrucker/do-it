
<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>VSCode Extension: Achievements</title>

        <link href="/do-it/assets/node_modules/prismjs/themes/prism-solarizedlight.min.css" rel="stylesheet">
        <link href="/do-it/assets/node_modules/prismjs/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet">
        <link href="/do-it/assets/node_modules/prismjs/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.css" rel="stylesheet">

        <link href="/do-it/assets/stylesheets/main.css" rel="stylesheet">
    </head>
    <body>
        <script>
        window.MathJax = {
            tex: {
            inlineMath: [
                [
                '$', '$'
                ],
                [
                '\\(', '\\)'
                ]
            ]
            },
            svg: {
            fontCache: 'global'
            }
        };
        </script>
        <script type="text/javascript" id="MathJax-script" src="/do-it/assets/node_modules/mathjax/es5/tex-svg-full.js"></script>

        <header class="border-b-2 border-gray-200 mb-4">
        <div class="max-w-[1000px] mx-auto px-4">
            <div class="min-h-[50px] flex justify-between items-center">
                <a class="mx-2" href="/do-it/">Home</a>
                <div class="flex items-center gap-4 sm:gap-6 ">
                    <a class="" href="/do-it/cs">CS</a>
                    <a class="" href="/do-it/pok">POK</a>
                    <a class="" href="/do-it/mon">MON</a>
                    <a class="" href="/do-it/projets">Projets</a>
                    <a class="hidden sm:block" href="/do-it/promos">Promos</a>
                    <a href="/do-it/search">
                        <svg class="h-5 aspect-square" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"></path>
                        </svg>
                    </a>
                    <a class="hidden sm:block" href="https://github.com/FrancoisBrucker/do-it" target="_blank">
                        <svg class="h-5 aspect-square" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg>
                    </a>
                </div>
            </div>
        </div>
        </header>

        <main class="max-w-[1000px] mx-auto px-4" data-pagefind-body="">
            
<article class="relative">
<h1 class="mb-1">VSCode Extension: Achievements</h1>
<div class="mb-4">
    
        <div class="px-4 flex flex-wrap items-center">
            
                <div class="font-bold">Tags : </div>
            
            <ul class="flex flex-wrap overflow-auto not-prose list-none my-1 mx-0 px-1 gap-1" data-pagefind-meta="Tags">
                
                    <li class="bg-yellow-200 rounded-full px-2" data-pagefind-filter="Tags">POK</li>
                
                    <li class="bg-yellow-200 rounded-full px-2" data-pagefind-filter="Tags">2024-2025</li>
                
                    <li class="bg-yellow-200 rounded-full px-2" data-pagefind-filter="Tags">temps 2</li>
                
                    <li class="bg-yellow-200 rounded-full px-2" data-pagefind-filter="Tags">dev</li>
                
                    <li class="bg-yellow-200 rounded-full px-2" data-pagefind-filter="Tags">vscode</li>
                

            </ul>
            
            
            <div class="hidden" data-pagefind-meta="Type">
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </div>
        </div>
    

    
        <div class="px-4 flex flex-wrap items-center">
            <div class="font-bold">Auteurs : </div>
            <ul class="flex flex-wrap not-prose list-none my-1 mx-0 px-1 gap-1" data-pagefind-meta="Auteurs">
                
                    <li class="bg-blue-200 rounded-full px-2" data-pagefind-filter="Auteurs">Loïck Goupil-Hallay</li>
                
            </ul>
        </div>
    

    
</div>

        <p class="mb-4 text-lg">

                Développement d'une extension permettant de débloquer des succès en fonction de l'utilisation de VSCode.

        </p>



    
<div class="quote relative  py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-purple-500 bg-purple-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-purple-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"></path>
</svg>
<div class="pl-8 mr-8">

<a href="/do-it/promos/">Promotions</a><span class="px-1">/</span><a href="/do-it/promos/2024-2025/">2024-2025</a><span class="px-1">/</span><a href="/do-it/promos/2024-2025/Loick-GoupilHallay/">Bienvenue sur ma page Do_It</a><span class="px-1">/</span><a href="/do-it/promos/2024-2025/Loick-GoupilHallay/pok/">POKs Loïck Goupil-Hallay</a><span class="px-1">/</span><a href="/do-it/promos/2024-2025/Loick-GoupilHallay/pok/temps-2/">VSCode Extension: Achievements</a>

</div></div>




<head>
  <link rel="icon" href="https://github.com/BoxBoxJason/achievements/blob/203309903d67090188814ce491a9d418ab71891e/assets/icons/pusheen_holding_trophy.png?raw=true" type="image/x-icon">
</head>
<script type="module">
  // Mermaid configuration
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';
  mermaid.initialize({ startOnLoad: true });
</script>
<div class="quote relative  py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-pink-500 bg-pink-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-pink-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
</svg>
<div class="pl-8 mb-2 mr-8">
<p><strong>POK avancé</strong></p>
</div><div class="pl-8 mr-8">
<ul>
<li><a href="https://code.visualstudio.com/">VSCode</a></li>
<li><a href="https://www.typescriptlang.org/">TypeScript</a></li>
</ul>
</div></div>
<div class="quote relative py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-emerald-500 bg-emerald-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-emerald-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5 0 011.242 7.244l-4.5 4.5a4.5 4.5 0 01-6.364-6.364l1.757-1.757m13.35-.622l1.757-1.757a4.5 4.5 0 00-6.364-6.364l-4.5 4.5a4.5 4.5 0 001.242 7.244"></path>
</svg>
<div class="pl-8 mb-2 mr-8">
<p><strong>Liens utiles</strong></p>
</div><div class="pl-8 mr-8">
<ul>
<li><a href="https://github.com/boxboxjason/achievements">Repo Achievements sur GitHub</a></li>
<li><a href="https://code.visualstudio.com/api">API VSCode</a></li>
<li><a href="https://code.visualstudio.com/api/get-started/your-first-extension">Développer son extension VSCode</a></li>
</ul>
</div></div>

<div class="image-title" style="display: flex; justify-content: center; align-items: center; margin-top: 10px;">
  <img src="https://github.com/BoxBoxJason/achievements/blob/203309903d67090188814ce491a9d418ab71891e/assets/icons/pusheen_holding_trophy.png?raw=true" alt="Achievements logo" width="200px" style="image-rendering: pixelated; border: none; margin: 0">
  <h1 style="width: fit-content; font-size: 3rem; padding-top: 10px;">Achievements</h1>
</div>
<h2>Introduction</h2>
<p>Toujours dans l'optique de créer le <strong>meilleur environnement de développement possible</strong>, je me suis demandé ce qui permet au <strong>développeur</strong> d'<strong>être le plus heureux quand il travaille</strong>. C'est alors que je me suis rappelé que la majorité des développeurs a un passif (ou un présent) de joueur de jeux vidéo. Un système de succès pousse les joueurs à <strong>continuer de jouer</strong> et les <strong>récompense</strong> pour leur temps passé sur le jeu. Cela <strong>booste la motivation</strong> et la <strong>satisfaction</strong> du joueur.</p>
<p>Et puis <em>Qui n'a jamais rêvé de terminer VSCode</em> ? C'est pourquoi j'ai décidé de développer une extension pour VSCode permettant de débloquer des achievements en fonction de l'utilisation de l'éditeur.</p>
<p>Il existe déjà deux extensions de ce type sur le marché, mais elles ne sont pas complètes du tout et ne sont plus maintenues. J'ai donc décidé de développer la mienne, qui sera plus complète et plus à jour.</p>
<h2>Fonctionnement</h2>
<p>L'extension <code>Achievements</code> fonctionne de manière assez simple. Le but est de ne pas impacter les performances de l'éditeur et de pouvoir fonctionner hors ligne.</p>
<h3>Workflow</h3>
<p>Le workflow de l'extension est le suivant:</p>
<ol>
<li>L'intégrité de la <strong>base de données</strong> est vérifiée à chaque démarrage de l'extension. S'il y a un problème, elle est patchée comme il faut.</li>
<li>Des <strong>listeners</strong> sont mis en place pour écouter les événements de l'éditeur (ouverture de fichier, sauvegarde, etc.).</li>
<li>Chaque listener déclenche l'<strong>augmentation</strong> d'un ou plusieurs critère de <strong>progression</strong>.</li>
<li>Lorsqu'une progression est augmentée, on vérifie si elle permet de <strong>débloquer un succès</strong>.</li>
<li>Si un succès est débloqué, on le notifie à l'utilisateur.</li>
<li>A tout moment, l'utilisateur peut aller consulter la liste des succès débloqués / en cours sur la Webview de l'extension.</li>
</ol>
<h3>Webview</h3>
<p>L'extension dispose d'une <strong>Webview</strong> qui permet à l'utilisateur de consulter la liste des succès débloqués et en cours. Cela permet de garder un historique des succès débloqués et de voir les succès restants à débloquer.
<img src="webview.png" alt="Webview"></p>
<h3>Commandes</h3>
<p>L'extension ajoute des commandes custom à la palette VSCode à vscode:
<img src="commands.png" alt="Commandes"></p>
<ul>
<li><code>achievements.enable</code>: Active / désactive l'extension</li>
<li><code>achievements.settings</code>: Ouvre la configuration de l'extension</li>
<li><code>achievements.show</code>: Ouvre la Webview des succès</li>
</ul>
<p>Il s'agit de raccourcis pour les actions les plus courantes.</p>
<h3>Base de données</h3>
<ul>
<li>J'utilise une base de données SQLite pour <strong>stocker les succès</strong>, leurs conditions de déblocage, leur état, la date de complétion, et tout un tas de propriétés.</li>
<li>Je stocke aussi la <strong>progression de chaque critère</strong> pour débloquer les succès. Cela me permet de savoir si un succès est débloqué ou non.</li>
<li>Il y a de nombreux achievements qui ne peuvent se débloquer que si certains autres sont débloqués. Pour cela, j'utilise une table qui <strong>stocke les dépendances entre les succès</strong>.</li>
<li>Enfin, je <strong>stocke les versions de la base de données</strong> pour pouvoir mettre à jour les tables en fonction de la version de l'extension. (C'est utile pour les mises à jour qui vont nécessiter des migrations de bases de données).</li>
</ul>
<pre class="mermaid">
erDiagram
    SchemaVersion {
        int id PK
        int version
        datetime applied_at
    }

    Achievement {
        int id PK
        string title
        string icon
        string category
        string group
        string description
        int tier
        int exp
        int hidden
        int repeatable
        boolean achieved
        datetime achievedAt
    }

    AchievementLabel {
        int achievement_id FK
        string label
    }

    AchievementCriteria {
        int id PK
        int achievement_id FK
        int progression_id FK
        string required_value
        string type
        string comparison_operator
    }

    AchievementRequirement {
        int achievement_id FK
        int requirement_id FK
    }

    Progression {
        int id PK
        string name
        string type
        string value
    }

    DailySession {
        int id PK
        string date
        int duration
    }

    Achievement ||--o{ AchievementLabel : "has"
    Achievement ||--|{ AchievementCriteria : "has"
    Achievement ||--o{ AchievementRequirement : "has"
    AchievementRequirement ||--|| Achievement : "references"
    AchievementCriteria }|--|{ Progression : "references"
</pre>
<h2>Développement</h2>
<p>VSCode fonctionne grâce à Electron, ce qui signifie qu'il fonctionne exactement comme un site web. Le développement des extensions se fait donc en JavaScript / TypeScript.
J'ai choisi d'utiliser <strong>TypeScript</strong> pour mon extension car il permet de <u>s'assurer que le code est correctement typé</u> avant de l'exécuter. Cela permet de réduire les erreurs et de gagner du temps.</p>
<p>Le développement se centre sur l'<strong>optimisation des performances</strong> et la réduction de l'impact sur l'éditeur. Cela passe par deux choses essentielles:</p>
<ul>
<li>l'<strong>optimisation SQL</strong> pour réduire le nombre de requêtes et traiter les données le plus rapidement possible</li>
<li>la <strong>gestion des listeners</strong> pour ne pas surcharger l'éditeur avec des événements inutiles ou dupliquer les fonctionnalités déjà existantes</li>
</ul>
<h3>Dépendances</h3>
<p>Pour mon extension, j'ai utilisé les dépendances suivantes :</p>
<ul>
<li>Développement
<ul>
<li><code>npm</code> pour le management des dépendances</li>
<li><code>esbuild</code> pour le bundling du code (le lint, la compilation de TypeScript)</li>
<li><code>eslint</code> pour l'analyse statique du code</li>
<li><code>typescript</code> pour le typage du code</li>
</ul>
</li>
<li>Run
<ul>
<li><code>vscode</code> pour l'API de VSCode</li>
<li><code>better-sqlite3</code> pour la base de données</li>
<li><code>react</code> pour l'interface utilisateur</li>
<li><code>styled-components</code> pour les styles de l'interface des composants react</li>
</ul>
</li>
</ul>
<h2>Post-mortem</h2>
<p>La documentation de l'API de VSCode concernant les webviews est TRES MAUVAISE, contrairement à ce qu'on pourrait croire, il est très difficile de trouver des exemples concrets pour réaliser des actions relativement peu complexes. On dirait que les développeurs de VSCode ont oublié de documenter leur propre API.</p>
<p>Au niveau de l'extensibilité, qui est un des arguments principaux de VSCode, c'est un peu la déception. Il est très difficile de faire des choses qui sortent de l'ordinaire concernant les webviews. Je suis obligé de passer par de multiples hacks pour arriver à mes fins (afficher des images ?????). La communication extension &lt;-&gt; webview est un véritable calvaire avec 0 documentation mis à par un exemple miteux. Le framework n'est vraiment pas bon pour le développement de vues personnalisées et complexes (ils déconseillent aux utilisateurs de développer des webviews pour des raisons de performances mais ce n'est pas une raison pour ne pas prendre en charge leur ajout).</p>
<p>Le bundle des vues n'est pas prévu par défaut par VSCode, c'est une catastrophe pour packager ses images / icones / css / js. Il faut tout mettre à la main dans le bundle, ce qui est une perte de temps et d'énergie pour des choses qui devraient être automatisées.</p>
<h3>Planning</h3>
<table>
<thead>
<tr>
<th>Date</th>
<th>Heures passées</th>
<th>Indications</th>
</tr>
</thead>
<tbody>
<tr>
<td>Mercredi 12/11</td>
<td>3H</td>
<td>Etablissement du projet, création du premier modèle de base de données</td>
</tr>
<tr>
<td>Jeudi 13/11</td>
<td>4H</td>
<td>Création des premiers succès (1200), standardisation de l'attribution des points, des difficultés,...</td>
</tr>
<tr>
<td>Samedi 15/11</td>
<td>3H</td>
<td>Création de la webview et communication extension &lt;-&gt; webview</td>
</tr>
<tr>
<td>Samedi 01/12</td>
<td>6H</td>
<td>Migration / Optimisation SQL pour minimiser l'impact sur les performances</td>
</tr>
<tr>
<td>Samedi 08/12</td>
<td>4H</td>
<td>Création des listeners d'events et tests d'intégration</td>
</tr>
</tbody>
</table>


</article>

        </main>


        <footer class="min-h-[50px] border-t-2 border-gray-200 mt-4">
            <div class="max-w-[1000px] mx-auto px-4">
                <div class="min-h-[50px] flex justify-center items-center">
                    <p class="text-center">
                        <span style="font-family: Consolas, sans-serif;">Do_<span style="color: #4a86e8">It</span></span> : Développent et Organisation en IT
                    </p>
                </div>
            </div>
        </footer>

        <script>
        MathJax
            .startup
            .document
            .getMathItemsWithin(document.body);
        </script>
    </body>
</html>
