
<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>Automatisation d&#39;Excel avec Python</title>

        <link href="/do-it/assets/node_modules/prismjs/themes/prism-solarizedlight.min.css" rel="stylesheet">
        <link href="/do-it/assets/node_modules/prismjs/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet">

        <link href="/do-it/assets/stylesheets/main.css" rel="stylesheet">
    </head>
    <body>
        <script>
        window.MathJax = {
            tex: {
            inlineMath: [
                [
                '$', '$'
                ],
                [
                '\\(', '\\)'
                ]
            ]
            },
            svg: {
            fontCache: 'global'
            }
        };
        </script>
        <script type="text/javascript" id="MathJax-script" src="/do-it/assets/node_modules/mathjax/es5/tex-svg-full.js"></script>

        <header class="border-b-2 border-gray-200 mb-4">
        <div class="max-w-[1000px] mx-auto px-4">
            <div class="min-h-[50px] flex justify-between items-center">
                <a class="mx-2" href="/do-it/">Home</a>
                <div class="flex items-center gap-4 sm:gap-6 ">
                    <a class="" href="/do-it/cs">CS</a>
                    <a class="" href="/do-it/pok">POK</a>
                    <a class="" href="/do-it/mon">MON</a>
                    <a class="" href="/do-it/projets">Projets</a>
                    <a class="hidden sm:block" href="/do-it/promos">Promos</a>
                    <a href="/do-it/search">
                        <svg class="h-5 aspect-square" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"></path>
                        </svg>
                    </a>
                    <a class="hidden sm:block" href="https://github.com/FrancoisBrucker/do-it" target="_blank">
                        <svg class="h-5 aspect-square" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg>
                    </a>
                </div>
            </div>
        </div>
        </header>

        <main class="max-w-[1000px] mx-auto px-4" data-pagefind-body="">
            
<article class="relative">
<h1 class="mb-1">Automatisation d&#39;Excel avec Python</h1>
<div class="mb-4">
    
        <div class="px-4 flex flex-wrap items-center">
            
                <div class="font-bold">Tags : </div>
            
            <ul class="flex flex-wrap overflow-auto not-prose list-none my-1 mx-0 px-1 gap-1" data-pagefind-meta="Tags">
                
                    <li class="bg-yellow-200 rounded-full px-2" data-pagefind-filter="Tags">MON</li>
                
                    <li class="bg-yellow-200 rounded-full px-2" data-pagefind-filter="Tags">2023-2024</li>
                
                    <li class="bg-yellow-200 rounded-full px-2" data-pagefind-filter="Tags">temps 1</li>
                
                    <li class="bg-yellow-200 rounded-full px-2" data-pagefind-filter="Tags">Excel</li>
                
                    <li class="bg-yellow-200 rounded-full px-2" data-pagefind-filter="Tags">Python</li>
                
                    <li class="bg-yellow-200 rounded-full px-2" data-pagefind-filter="Tags">Openpyxl</li>
                

            </ul>
            
            
            <div class="hidden" data-pagefind-meta="Type">
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </div>
        </div>
    

    
        <div class="px-4 flex flex-wrap items-center">
            <div class="font-bold">Auteurs : </div>
            <ul class="flex flex-wrap not-prose list-none my-1 mx-0 px-1 gap-1" data-pagefind-meta="Auteurs">
                
                    <li class="bg-blue-200 rounded-full px-2" data-pagefind-filter="Auteurs">Nicolas Ouzoulias</li>
                
            </ul>
        </div>
    

    
</div>

        <p class="mb-4 text-lg">

                Mon second MON pour m'améliorer à l'utilisation de Python pour la gestion de tableaux Excel.

        </p>



    
<div class="quote relative  py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-purple-500 bg-purple-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-purple-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"></path>
</svg>
<div class="pl-8 mr-8">

<a href="/do-it/promos/">Promotions</a><span class="px-1">/</span><a href="/do-it/promos/2023-2024/">2023-2024</a><span class="px-1">/</span><a href="/do-it/promos/2023-2024/Ouzoulias-Nicolas/">Nicolas OUZOULIAS</a><span class="px-1">/</span><a href="/do-it/promos/2023-2024/Ouzoulias-Nicolas/mon/">MON de Nicolas Ouzoulias</a><span class="px-1">/</span><a href="/do-it/promos/2023-2024/Ouzoulias-Nicolas/mon/temps-1.2/">Automatisation d&#39;Excel avec Python</a>

</div></div>




<h2>Sommaire</h2>
<p>I. Introduction</p>
<p>II. Présentation de <em>openpyxl</em></p>
<p>III. Mise en pratique</p>
<p>IV. Conclusion</p>
<h2>I. Introduction</h2>
<p>Lors de ce deuxième MON de l'année j'ai suivi le chapitre 13 du livre <strong>Automate the boring stuff with Python</strong> pour travailler sur les documents Excel depuis Python grâce à la bibliothèque <em>openpyxl</em>.</p>
<p>Ce dernier est disponible <a href="https://automatetheboringstuff.com/2e/chapter13/">ici</a>.</p>
<p>J'ai voulu suivre cette formation car lors de mon stage 2A j'ai principalement travaillé sur un code Python pour étudier des cycles de pression dans des canalisations. Ces dernières étaient initialement stockées dans un tableau Excel, j'ai donc dû utiliser quelques fois la bibliothèque <em>openpyxl</em> mais uniquement quelques lignes, je n'ai pas eu le temps de rentrer en détail et de vraiment comprendre le fonctionnement et les bonnes habitudes à avoir pour optimiser son utilisation.</p>
<h2>II. Présentation de <em>openpyxl</em></h2>
<p>La bibliothèque python <em>openpyxl</em> est utilisée pour la lecture et la modification des tableaux Excel, cette dernière facilite l'utilisation et donc l'automatisation de nombreuses tâches</p>
<h3>Initialisation et lecture des données</h3>
<p><em>openpyxl</em> n'est initialement pas dans Python il faut donc commencer par l'installer.</p>
<pre class="language-python " style="counter-reset: linenumber 0"><code class="language-python">pip install openpyxl
</code></pre>
<p>Une fois installée et opérationnelle il faut écrire sur quel document Excel nous souhaitons travailler. Pour cela on utilise <code>openpyxl.load_workbook()</code> si le document existe déjà ou <code>openpyxl.Workbook()</code> pour en créer un.</p>
<p>Pour travailler sur un document il faut comprendre comment Python visualise ce dernier. Les deux métohdes précédentes créent une donnée de type <em>worbook</em>, mais ce n'est pas celle-ci qui nous intéresse, elle sert uniquement à dire à Python où regarder et quel document lire/modifier.</p>
<p>Un <em>workbook</em> est tout d'abord divisé en plusieurs <em>sheets</em> (feuilles). Et chaque <em>sheet</em> est divisé en de multiples <em>cells</em> (cellules).</p>
<p>Une cellule est caractérisée par :</p>
<ul>
<li>une valeur : <strong>value</strong> (texte, date, nombre,...)</li>
<li>une ligne : <strong>row</strong> (1,2,3,...)</li>
<li>une colonne : <strong>column</strong> (A,B,C,...)</li>
<li>des coordonnées : [<strong>column</strong>+<strong>row</strong>] (A7,B12,...)</li>
</ul>
<p>Tout comme pour le document, il faut indiquer à Python quelle feuille sélectionner. Un exemple de début de code sur <em>openpyxl</em> va avoir cette forme :</p>
<pre class="language-python " style="counter-reset: linenumber 0"><code class="language-python"><span class="token keyword">import</span> openpyxl

table <span class="token operator">=</span> openpyxl<span class="token punctuation">.</span>load_workbook<span class="token punctuation">(</span><span class="token string">'mon_excel.xlsx'</span><span class="token punctuation">)</span>

feuille1 <span class="token operator">=</span> classeur<span class="token punctuation">.</span>active<span class="token punctuation">(</span><span class="token punctuation">)</span>
feuille2 <span class="token operator">=</span> table<span class="token punctuation">[</span><span class="token string">'Sheet2'</span><span class="token punctuation">]</span>
</code></pre>
<p>Ici nous avons deux manières différentes de sélectionner une feuille dans le tableau.</p>
<ul>
<li><code>.active()</code> pour celle qui s'ouvre par défaut</li>
<li><code>nom_document['nom_sheet']</code> pour en sélectionner une précisément.</li>
</ul>
<p>Cependant la deuxième méthode nécessite de connaître le nom des différentes feuilles et donc d'avoir le document sous les yeux ce qui est contraignant pour une optimisation. Pour contrer cela on peut utiliser <code>nom_document.sheetnames</code> qui renvoie une liste avec le nom de chaque feuille de <code>nom_document</code>.</p>
<p>Une fois bien initialisé nous pouvons enfin lire des cellules. Pour cela il faut utiliser <code>.value</code>.</p>
<pre class="language-python " style="counter-reset: linenumber 0"><code class="language-python">cell1 <span class="token operator">=</span> feuille1<span class="token punctuation">[</span><span class="token string">'A7'</span><span class="token punctuation">]</span>
cell2 <span class="token operator">=</span> feuille1<span class="token punctuation">.</span>cell<span class="token punctuation">(</span>row<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> column<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

valeur1 <span class="token operator">=</span> cell1<span class="token punctuation">.</span>value
valeur2 <span class="token operator">=</span> cell2<span class="token punctuation">.</span>value
</code></pre>
<p>Les 2 façons précédentes permettent de lire et de stocker les valeurs d'une cellule. Ici on a évidemment <em>valeur1</em> = <em>valeur2</em>.</p>
<div class="quote relative drop-shadow  py-2 pr-2 rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-amber-800 bg-amber-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-amber-800" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
</svg>
<div class="pl-8 mr-8">
<p>NB : Contrairement à de nombreuses données comme les listes, les <em>array</em> et les boucles <em>for</em>, les coordonnées d'une feuille commencent par 1 et non 0.</p>
</div></div>
<p>La seconde méthode est plus facile à utiliser avec des boucles car elle utilise uniquement des nombres et non des lettres, même si le problème est évitable grâce à <code>get_column_letter()</code> et <code>column_index_from_string()</code>.</p>
<h3>Écriture et modification de données</h3>
<p>Maintenant que nous savons comment lire efficacement un tableau Excel nous allons chercher à le modifier depuis Python.</p>
<p>La modification de la valeur d'une cellule se fait très facilement à l'aide une nouvelle fois de <code>.value</code>.</p>
<p>Pour l'exemple nous avons initialement ce tableau :</p>
<p><img src="excel_avant_modif.png" alt="Excel initial"></p>
<p>Nous pouvons donc en utilisant la méthode précédent modifier une cellule en particulier comme par exemple la B2 et ainsi avoir :</p>
<p><img src="excel_apres_modif.png" alt="Excel modifié"></p>
<p>Cependant notre valeur est désormais écrite en gras, comment cela se fait-il ?</p>
<p>En effet en plus de simplement modifier la valeur nous pouvons modifier le style. Le code utilisé pour passer d'un tableau à l'autre a ici été :</p>
<pre class="language-python " style="counter-reset: linenumber 0"><code class="language-python"><span class="token keyword">import</span> openpyxl
<span class="token keyword">from</span> openpyxl<span class="token punctuation">.</span>styles <span class="token keyword">import</span> Font

wb <span class="token operator">=</span> openpyxl<span class="token punctuation">.</span>load_workbook<span class="token punctuation">(</span><span class="token string">'test1.xlsx'</span><span class="token punctuation">)</span>
sheet <span class="token operator">=</span> wb<span class="token punctuation">.</span>active
c1 <span class="token operator">=</span> sheet<span class="token punctuation">.</span>cell<span class="token punctuation">(</span>row<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> column<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>

c1<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">"Pineapple"</span>
c1<span class="token punctuation">.</span>font <span class="token operator">=</span> Font<span class="token punctuation">(</span>bold<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

wb<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">'test1.xlsx'</span><span class="token punctuation">)</span>
</code></pre>
<p>L'importation de la classe <strong>Font</strong> issue de la bibliothèque <em>openpyxl.styles</em> permet de modifier le style de la police d'écriture. Le code modifie donc initialement la valeur de la cellule <em><strong>c1</strong></em> grâce à la ligne <code>c1.value = &quot;Pineapple&quot;</code> avant de la mettre en gras avec <code>c1.font = Font(bold=True)</code>.</p>
<p>La dernière ligne du code quant à elle permet de sauvegarder les modifications.</p>
<div class="quote relative drop-shadow  py-2 pr-2 rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-amber-800 bg-amber-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-amber-800" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
</svg>
<div class="pl-8 mr-8">
<p><strong>Attention</strong> cependant au nom de fichier utilisé pour la sauvegarde, ici le nouveau document va prendre la place de l'ancien ! Il est donc recommandé d'utiliser un nouveau nom pour ne pas écraser les données et revenir en arrière en cas de problème.</p>
</div></div>
<p>De nombreux paramètres sont modifiables grâce à <em>openpyxl.styles</em> comme la police, l'alignement, les couleurs,...
Il est également possible de fusionner des cellules et modifier leurs tailles.</p>
<p>L'utilisation de Python pour automatiser les tableaux Excel peut être extrêmement utile mais il ne faut pas oublier que de nombreuses formules Excel existent déjà et rien ne sert d'écrire une fonction Python qui peut se faire directement depuis Excel. Par exemple si nous possédons une colonne de nombres et que nous souhaitons sommer ces derniers, il est plus rapide d'écrire une cellule avec <code>cellule_somme.value = '=SUM(A1:A12)'</code> que d'écrire :</p>
<pre class="language-python " style="counter-reset: linenumber 0"><code class="language-python">somme <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">)</span> <span class="token punctuation">:</span>
  cell <span class="token operator">=</span> sheet<span class="token punctuation">.</span>cell<span class="token punctuation">(</span>row<span class="token operator">=</span>i<span class="token punctuation">,</span> column<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
  somme<span class="token operator">+=</span>cell<span class="token punctuation">.</span>value

cellule_somme<span class="token punctuation">.</span>value <span class="token operator">=</span> somme
</code></pre>
<h2>III. Mise en pratique</h2>
<p>Afin d'utiliser les différentes méthodes vues précédemment je vais reprendre le code sur lequel je travaillais lors de mon stage et pour lequel j'ai à peine utilisé <em>openpyxl</em>.</p>
<p>Mon code sert à étudier des relevés de pression dans des canalisations, les données initiales que j'avais étaient donc un tableau Excel avec une colonne de dates et une autre de pressions.</p>
<p>Après avoir importé les données dans Python et après de nombreux calculs j'obtenais un tableau correspondant à une matrice que j'affichais grâce à la bibliothèque <em>matplotlib.pyplot</em>.</p>
<p><img src="graphe_python.png" alt="Graphe Python"></p>
<p>Le tableau derrière cette matrice est rangé sous forme d'<em>array</em> dans mon code mais il peut être utile de l'avoir en Excel pour visualiser et le manipuler plus facilement pour les clients.</p>
<div class="relative drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-indigo-500 bg-indigo-100">
<details class="group">
<summary class="list-none py-0.5">
<svg class="group-open:hidden absolute w-7 h-7 pl-1 pt-0.5 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"></path>
</svg>
<svg class="group-open:block hidden absolute w-7 h-7 pl-1 pt-0.5 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path>
</svg>
<div class="pl-8 font-bold inline-block">
<p>Cliquez pour afficher la fonction de création du tableau Excel</p>
</div>
<svg class="group-open:hidden inline-block pl-3 w-10 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M5 12h.01M12 12h.01M19 12h.01M6 12a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0z"></path>
</svg>
</summary>
<div class="mx-8 pb-2">
<pre class="language-python " style="counter-reset: linenumber 0"><code class="language-python"><span class="token keyword">def</span> <span class="token function">convert_excel</span> <span class="token punctuation">(</span>matrice<span class="token punctuation">,</span> chemin_fichier<span class="token punctuation">)</span> <span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" Permet d'enregistrer une matrice dans un tableau Excel.

        Paramètre
        ---------
        matrice : np.array
            Matrice Rainflow avec en première colonne
            et en première ligne les échelles.

        Return
        ------
        None
    """</span>
    <span class="token comment"># Créer un nouveau classeur Excel :</span>
    classeur <span class="token operator">=</span> openpyxl<span class="token punctuation">.</span>Workbook<span class="token punctuation">(</span><span class="token punctuation">)</span>
    feuille <span class="token operator">=</span> classeur<span class="token punctuation">.</span>active

    <span class="token comment"># Parcourir la matrice et insérer les valeurs dans les cellules :</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> ligne <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>matrice<span class="token punctuation">)</span><span class="token punctuation">:</span>

        <span class="token keyword">for</span> j<span class="token punctuation">,</span> valeur <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>ligne<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> i <span class="token operator">></span> <span class="token number">0</span> <span class="token keyword">or</span> j <span class="token operator">></span> <span class="token number">0</span> <span class="token punctuation">:</span>
                cellule <span class="token operator">=</span> feuille<span class="token punctuation">.</span>cell<span class="token punctuation">(</span>row<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">,</span> column<span class="token operator">=</span>j<span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">)</span>
                cellule<span class="token punctuation">.</span>value <span class="token operator">=</span> valeur
                <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">or</span> j <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">:</span>
                    cellule<span class="token punctuation">.</span>font <span class="token operator">=</span> Font<span class="token punctuation">(</span>bold<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    classeur<span class="token punctuation">.</span>save<span class="token punctuation">(</span>chemin_fichier<span class="token punctuation">)</span>
</code></pre>
</div>
</details>     
</div>
<p>On obtient alors le tableau Excel suivant :</p>
<p><img src="matrice_excel1.png" alt="matrice Excel 1"></p>
<p>Afin de le rendre plus visuel nous allons recréer une mise en page conditionnelle afin de recréer la matrice colorée obtenue sur Python.</p>
<div class="relative drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-indigo-500 bg-indigo-100">
<details class="group">
<summary class="list-none py-0.5">
<svg class="group-open:hidden absolute w-7 h-7 pl-1 pt-0.5 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"></path>
</svg>
<svg class="group-open:block hidden absolute w-7 h-7 pl-1 pt-0.5 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path>
</svg>
<div class="pl-8 font-bold inline-block">
<p>Cliquez pour afficher la fonction de création du tableau Excel avec la mise en page conditionnelle</p>
</div>
<svg class="group-open:hidden inline-block pl-3 w-10 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M5 12h.01M12 12h.01M19 12h.01M6 12a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0z"></path>
</svg>
</summary>
<div class="mx-8 pb-2">
<pre class="language-python " style="counter-reset: linenumber 0"><code class="language-python"><span class="token keyword">def</span> <span class="token function">convert_excel</span> <span class="token punctuation">(</span>matrice<span class="token punctuation">,</span>chemin_fichier<span class="token punctuation">)</span> <span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" Permet d'enregistrer une matrice dans un tableau Excel.

        Paramètre
        ---------
        matrice : np.array
            Matrice Rainflow 'Amplitude-Moyenne' avec en première colonne
            et en première ligne les échelles.

        Return
        ------
        None
    """</span>
    <span class="token comment"># Créer un nouveau classeur Excel :</span>
    classeur <span class="token operator">=</span> openpyxl<span class="token punctuation">.</span>Workbook<span class="token punctuation">(</span><span class="token punctuation">)</span>

    feuille <span class="token operator">=</span> classeur<span class="token punctuation">.</span>active
    liste_nbr_cycles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token comment"># Parcourir la matrice et insérer les valeurs dans les cellules :</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> ligne <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>matrice<span class="token punctuation">)</span><span class="token punctuation">:</span>

        <span class="token keyword">for</span> j<span class="token punctuation">,</span> valeur <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>ligne<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> i <span class="token operator">></span> <span class="token number">0</span> <span class="token keyword">or</span> j <span class="token operator">></span> <span class="token number">0</span> <span class="token punctuation">:</span>
                cellule <span class="token operator">=</span> feuille<span class="token punctuation">.</span>cell<span class="token punctuation">(</span>row<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">,</span> column<span class="token operator">=</span>j<span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">)</span>
                cellule<span class="token punctuation">.</span>value <span class="token operator">=</span> valeur
                liste_nbr_cycles<span class="token punctuation">.</span>append<span class="token punctuation">(</span>valeur<span class="token punctuation">)</span>
                <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">or</span> j <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">:</span>
                    cellule<span class="token punctuation">.</span>font <span class="token operator">=</span> Font<span class="token punctuation">(</span>bold<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
                    
                <span class="token keyword">if</span> valeur <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">:</span>
                    cellule<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">0</span> 
        
    max_nbr_cycles <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>liste_nbr_cycles<span class="token punctuation">)</span>

    <span class="token keyword">for</span> i<span class="token punctuation">,</span> ligne <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>matrice<span class="token punctuation">)</span><span class="token punctuation">:</span>

        <span class="token keyword">for</span> j<span class="token punctuation">,</span> valeur <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>ligne<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> i <span class="token operator">></span> <span class="token number">0</span> <span class="token keyword">or</span> j <span class="token operator">></span> <span class="token number">0</span> <span class="token punctuation">:</span>
                cellule <span class="token operator">=</span> feuille<span class="token punctuation">.</span>cell<span class="token punctuation">(</span>row<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">,</span> column<span class="token operator">=</span>j<span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">)</span>
                cellule<span class="token punctuation">.</span>alignment <span class="token operator">=</span> Alignment<span class="token punctuation">(</span>horizontal <span class="token operator">=</span> <span class="token string">"center"</span><span class="token punctuation">,</span> vertical <span class="token operator">=</span> <span class="token string">"center"</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> valeur <span class="token operator">>=</span> <span class="token number">0.9</span><span class="token operator">*</span>max_nbr_cycles <span class="token punctuation">:</span>
                    cellule<span class="token punctuation">.</span>fill<span class="token operator">=</span>PatternFill<span class="token punctuation">(</span><span class="token string">"solid"</span><span class="token punctuation">,</span> start_color<span class="token operator">=</span><span class="token string">"CC160C"</span><span class="token punctuation">)</span>
                <span class="token keyword">elif</span> valeur<span class="token operator">&lt;</span><span class="token number">0.9</span><span class="token operator">*</span>max_nbr_cycles <span class="token keyword">and</span> valeur<span class="token operator">>=</span><span class="token number">0.5</span><span class="token operator">*</span>max_nbr_cycles <span class="token punctuation">:</span>
                    cellule<span class="token punctuation">.</span>fill<span class="token operator">=</span>PatternFill<span class="token punctuation">(</span><span class="token string">"solid"</span><span class="token punctuation">,</span> start_color<span class="token operator">=</span><span class="token string">"CC730C"</span><span class="token punctuation">)</span>
                <span class="token keyword">elif</span> valeur<span class="token operator">&lt;</span><span class="token number">0.5</span><span class="token operator">*</span>max_nbr_cycles <span class="token keyword">and</span> valeur<span class="token operator">>=</span><span class="token number">0.2</span><span class="token operator">*</span>max_nbr_cycles <span class="token punctuation">:</span>
                    cellule<span class="token punctuation">.</span>fill<span class="token operator">=</span>PatternFill<span class="token punctuation">(</span><span class="token string">"solid"</span><span class="token punctuation">,</span> start_color<span class="token operator">=</span><span class="token string">"E3DF07"</span><span class="token punctuation">)</span>
                <span class="token keyword">elif</span> valeur<span class="token operator">&lt;</span><span class="token number">0.2</span><span class="token operator">*</span>max_nbr_cycles <span class="token keyword">and</span> valeur<span class="token operator">></span><span class="token number">0</span> <span class="token punctuation">:</span>
                    cellule<span class="token punctuation">.</span>fill<span class="token operator">=</span>PatternFill<span class="token punctuation">(</span><span class="token string">"solid"</span><span class="token punctuation">,</span> start_color<span class="token operator">=</span><span class="token string">"A1E00D"</span><span class="token punctuation">)</span>
                <span class="token keyword">else</span> <span class="token punctuation">:</span>
                    cellule<span class="token punctuation">.</span>fill<span class="token operator">=</span>PatternFill<span class="token punctuation">(</span><span class="token string">"solid"</span><span class="token punctuation">,</span> start_color<span class="token operator">=</span><span class="token string">"00FF1B"</span><span class="token punctuation">)</span>
                    
                <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">or</span> j <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">:</span>
                    cellule<span class="token punctuation">.</span>fill<span class="token operator">=</span>PatternFill<span class="token punctuation">(</span><span class="token string">"solid"</span><span class="token punctuation">,</span> start_color<span class="token operator">=</span><span class="token string">"919191"</span><span class="token punctuation">)</span>

    classeur<span class="token punctuation">.</span>save<span class="token punctuation">(</span>chemin_fichier<span class="token punctuation">)</span>              
</code></pre>
</div>
</details>     
</div>
<p><img src="matrice_excel2.png" alt="matrice Excel 2"></p>
<h2>IV. Conclusion</h2>
<p>A travers ce MON j'ai pu mieux comprendre la bibliothèque <em>openpyxl</em> de Python et ainsi être plus apte à utilier facilement ce langage pour automatiser les tableaux Excel qui sont extrêmement présents dans le monde professionel.</p>
<p>J'en ai profité pour améliorer le code de mon précédent stage et plonger plus en détail dans l'affichage des résultats.</p>
<h3>Sources</h3>
<ul>
<li><em>OpenPyxl - a Python library to read/write Excel 2010 xLsx/xlsm files — OpenPyXl 3.1.2 documentation</em>. <a href="https://openpyxl.readthedocs.io/en/stable/">https://openpyxl.readthedocs.io/en/stable/</a></li>
<li><em>Automate the boring stuff with Python</em>. <a href="https://automatetheboringstuff.com/2e/chapter13/">https://automatetheboringstuff.com/2e/chapter13/</a></li>
</ul>


</article>

        </main>


        <footer class="min-h-[50px] border-t-2 border-gray-200 mt-4">
            <div class="max-w-[1000px] mx-auto px-4">
                <div class="min-h-[50px] flex justify-center items-center">
                    <p class="text-center">
                        <span style="font-family: Consolas, sans-serif;">Do_<span style="color: #4a86e8">It</span></span> : Développent et Organisation en IT
                    </p>
                </div>
            </div>
        </footer>

        <script>
        MathJax
            .startup
            .document
            .getMathItemsWithin(document.body);
        </script>

    </body>
</html>
