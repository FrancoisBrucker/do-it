
<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>Apprendre Rust en codant un jeu</title>

        <link href="/do-it/assets/node_modules/prismjs/themes/prism-solarizedlight.min.css" rel="stylesheet">
        <link href="/do-it/assets/node_modules/prismjs/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet">

        <link href="/do-it/assets/stylesheets/main.css" rel="stylesheet">
    </head>
    <body>
        <script>
        window.MathJax = {
            tex: {
            inlineMath: [
                [
                '$', '$'
                ],
                [
                '\\(', '\\)'
                ]
            ]
            },
            svg: {
            fontCache: 'global'
            }
        };
        </script>
        <script type="text/javascript" id="MathJax-script" src="/do-it/assets/node_modules/mathjax/es5/tex-svg-full.js"></script>

        <header class="border-b-2 border-gray-200 mb-4">
        <div class="max-w-[1000px] mx-auto px-4">
            <div class="min-h-[50px] flex justify-between items-center">
                <a class="mx-2" href="/do-it/">Home</a>
                <div class="flex items-center gap-4 sm:gap-6 ">
                    <a class="" href="/do-it/cs">CS</a>
                    <a class="" href="/do-it/pok">POK</a>
                    <a class="" href="/do-it/mon">MON</a>
                    <a class="" href="/do-it/projets">Projets</a>
                    <a class="hidden sm:block" href="/do-it/promos">Promos</a>
                    <a href="/do-it/search">
                        <svg class="h-5 aspect-square" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"></path>
                        </svg>
                    </a>
                    <a class="hidden sm:block" href="https://github.com/FrancoisBrucker/do-it" target="_blank">
                        <svg class="h-5 aspect-square" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg>
                    </a>
                </div>
            </div>
        </div>
        </header>

        <main class="max-w-[1000px] mx-auto px-4" data-pagefind-body="">
            
<article class="relative">
<h1 class="mb-1">Apprendre Rust en codant un jeu</h1>
<div class="mb-4">
    
        <div class="px-4 flex flex-wrap items-center">
            
                <div class="font-bold">Tags : </div>
            
            <ul class="flex flex-wrap overflow-auto not-prose list-none my-1 mx-0 px-1 gap-1" data-pagefind-meta="Tags">
                
                    <li class="bg-yellow-200 rounded-full px-2" data-pagefind-filter="Tags">MON</li>
                
                    <li class="bg-yellow-200 rounded-full px-2" data-pagefind-filter="Tags">2023-2024</li>
                
                    <li class="bg-yellow-200 rounded-full px-2" data-pagefind-filter="Tags">temps 2</li>
                
                    <li class="bg-yellow-200 rounded-full px-2" data-pagefind-filter="Tags">Rust</li>
                

            </ul>
            
            
            <div class="hidden" data-pagefind-meta="Type">
                
                    
                
                    
                
                    
                
                    
                
            </div>
        </div>
    

    
        <div class="px-4 flex flex-wrap items-center">
            <div class="font-bold">Auteurs : </div>
            <ul class="flex flex-wrap not-prose list-none my-1 mx-0 px-1 gap-1" data-pagefind-meta="Auteurs">
                
                    <li class="bg-blue-200 rounded-full px-2" data-pagefind-filter="Auteurs">Vladimir Jeantroux</li>
                
            </ul>
        </div>
    

    
</div>



    
<div class="quote relative  py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-purple-500 bg-purple-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-purple-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"></path>
</svg>
<div class="pl-8 mr-8">

<a href="/do-it/promos/">Promotions</a><span class="px-1">/</span><a href="/do-it/promos/2023-2024/">2023-2024</a><span class="px-1">/</span><a href="/do-it/promos/2023-2024/Vladimir-Jeantroux/">Vladimir Jeantroux</a><span class="px-1">/</span><a href="/do-it/promos/2023-2024/Vladimir-Jeantroux/mon/">MON de Vladimir Jeantroux</a><span class="px-1">/</span><a href="/do-it/promos/2023-2024/Vladimir-Jeantroux/mon/temps-2-2/">Apprendre Rust en codant un jeu</a>

</div></div>




<p>Après m'être familiarisé avec plusieurs types de programmation avec les MON précédents, celui-ci aborde le Rust. Il est largement utilisé pour le développement de systèmes embarqués, d'outils système, et même dans des projets liés à la programmation web. Des notions innovantes comme le &quot;ownership&quot; en font un langage performant et sécurisé.</p>
<p>Après avoir lu les MON d'<a href="https://francoisbrucker.github.io/do-it/promos/2023-2024/Diouf-Asssane/mon/Rust/">Assane Diouf</a> et de <a href="https://francoisbrucker.github.io/do-it/promos/2023-2024/Vietor-Paul/mon/temps-1.2/">Paul Vietor</a>, je me suis attaqué au <a href="https://doc.rust-lang.org/stable/book/title-page.html">livre de Rust</a> afin d'avoir plus de détails et faire mon premier Hello World.</p>
<div class="quote relative  py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-pink-500 bg-pink-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-pink-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
</svg>
<div class="pl-8 mr-8">
<p>Pré-requis :
Un peu d'expérience en programmation, car le livre part du principe qu'on en a avec d'autres langages. Il serait judicieux d'avoir aussi des connaissances en C, car il y a des notions dans la gestion de mémoire.</p>
</div></div>
<h2>Approfondissements</h2>
<p>Ce MON ne reviendra pas sur ce qui a déjà été expliqué par ceux mentionnés au-dessus, comme par exemple les notions d'ownership ou d'objets comme les structures et les énumérations. Je souhaite cependant aborder certains concepts que j'ai moins bien compris ou que j'ai estimé necessiter des explications lors de mon apprentissage de Rust.</p>
<h3>Les macros</h3>
<p>En Rust, une macro-abréviation, ou macro, est une fonctionnalité puissante du langage qui permet la création de code source à la compilation. Les macros sont une façon d'écrire du code qui écrit d'autres codes, ce qui est connu sous le nom de métaprogrammation. Contrairement à une fonction, qui appelle un nombre et un type spécifique de paramètres, une macro peut prendre un nombre variable de paramètres. En effet, en Rust, <code>println!</code> est une macro; on peut écrire <code>println!(&quot;hello world&quot;)</code> ou bien <code>println!(&quot;hello{}&quot;,name)</code>, et les deux fourniront un output correct (si la variable <code>name</code> est bien définie dans le deuxième exemple, bien évidemment). Les macros sont indiquées par un point d'exclamation à la fin de leur nom.</p>
<p>En outre, les macros sont développées avant que le compilateur n'interprète la signification du code, de sorte qu'une macro peut, par exemple, implémenter un trait sur un type donné. Une fonction ne le peut pas, car elle est appelée au moment de l'exécution, alors qu'un trait doit être implémenté au moment de la compilation.</p>
<p>L'inconvénient d'implémenter une macro plutôt qu'une fonction est que les définitions de macros sont plus complexes, ce qui les rend plus difficiles à les écrire, les lire, à comprendre et à maintenir que les définitions de fonctions. C'est pour cela qu'il faut être prudent avec l'utilisation des macros, pour maintenir la lisibilité et la compréhension du code.</p>
<p>On peut définir des macros grâce à la commande <code>macro_rules!</code></p>
<h2>Eléments de game design en Rust</h2>
<p>Après m'être entraîné avec les exemples du livre de Rust, j'ai voulu créer un jeu simple avec le temps qu'il me restait. Ayant réussi à mettre la main sur le livre &quot;Hands-on Rust : Effective learning through 2D Game Development and Play&quot; par Herbert Wolverson, j'ai souhaité m'intéressé à la philosophie de programmation d'un jeu vidéo lorsqu'on utilise Rust, en faisant un jeu &quot;Flappy Dragon&quot;.</p>
<h3>Game Loop</h3>
<p>Une fonction normale en Rust dans le fichier <code>main.rs</code> s'exécute de haut en bas, attendant une entrée de l'utilisateur (s'il y en a) avant de continuer à s'exécuter. Ce n'est évidemment pas possible dans un jeu vidéo, le jeu doit continuer de tourner même si l'utilisateur ne fait rien. Lorsqu'on joue à Flappy Bird, l'oiseau continue de tomber même si le joueur ne touche pas à son écran. On fait donc appel à une boucle qui s'appelle &quot;Game loop&quot;, qui va s'exécuter à chaque fois que l'écran s'actualise.</p>
<p><img src="gameloop.JPG" alt="Schéma d'un Game Loop">
<em>Image : Schéma d'un game loop et de ses étapes, Hands-on Rust : Effective learning through 2D Game Development and Play, Herbert Wolverson.</em></p>
<p>En premier lieu, il faut initialiser l'application afin qu'on soit capable d'afficher quelque chose à l'écran (1). Ensuite, pendant l'exécution de la boucle, on va demander en premier lieu à l'OS s'il y a eu des entrées de la part de l'utilisateur et lesquelles (appuyer sur son clavier, mouvements/clics de souris,...) (2). Le moteur du jeu va alors traduire ces événements, en faisant appel à la fonction <em>tick</em>, et va fournir la réponse du jeu à ces événements, comme les mouvements du personnage par exemple (3). Le jeu met ensuite l'écran à jour (4), et vérifie si le programme doit être fermé (5). Si oui, le jeu se ferme, sinon, on retourne à l'étape 2, et continuer le jeu.</p>
<p>Cette vision du jeu implique beaucoup d'interactions avec l'OS de la machine, ce qui implique qu'il faudra s'adapter pour chaque type de machine, une solution peut très bien fonctionner sur une machine particulière et pas du tout sur une autre. C'est pour ça que les développeurs utilisent des <code>moteurs</code>, qui permettent de s'affranchir des problèmes liés à une plateforme spécifique, entre autres.</p>
<h3>Création du jeu</h3>
<p>On commence par créer dans le main une structure nommée <code>State</code> : il faut stocker l'était du jeu (game state) quelque part, afin que la fonction <code>tick</code> puisse y accéder et opérer. On utilise la librairie <code>bracket-lib</code> pour concevoir le jeu qui contient de multiples algorithmes, génération de nombres aléatoires, etc.</p>
<pre class="language-rust"><code class="language-rust"><span class="token keyword">impl</span>​ <span class="token class-name">GameState</span> ​<span class="token keyword">for</span>​ <span class="token class-name">State</span> <span class="token punctuation">{</span>
​​​    ​<span class="token keyword">fn</span>​ ​tick​<span class="token punctuation">(</span><span class="token operator">&amp;</span>​<span class="token keyword">mut</span>​ ​<span class="token keyword">self</span>​<span class="token punctuation">,</span> ctx<span class="token punctuation">:</span> <span class="token operator">&amp;</span>​<span class="token keyword">mut</span>​ <span class="token class-name">BTerm</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
​​​    ctx​<span class="token punctuation">.</span>cls​<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
​​​	   ctx​<span class="token punctuation">.</span>print​<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> ​<span class="token lifetime-annotation symbol">'Hello</span><span class="token punctuation">,</span> <span class="token class-name">Bracket</span> <span class="token macro property">Terminal!</span>'​<span class="token punctuation">)</span><span class="token punctuation">;</span> 
​ 	    <span class="token punctuation">}</span>
​ 	<span class="token punctuation">}</span></code></pre>
<p>On va ensuite créer un trait &quot;GameState&quot; pour notre état, qui vient avec la fonction tick (ligne 2). <code>ctx.cls</code> permet d'effacer le contenu de l'écran, et print nous donne un affichage basique pour voir si ça marche (1,1 sont les coordonnées du print, un peu comme des coordonnées dans une matrice).</p>
<p>Une particularité de la programmation en Rust est que l'on va devoir gérer les erreurs dans la fonction <code>main</code>, chose à laquelle je n'étais pas confronté lorsque j'utilisais Godot.</p>
<p>On doit aussi soi-même appeler un affichage pour notre programme (là encore, en Godot c'est automatique).</p>
<pre class="language-rust"><code class="language-rust">​<span class="token keyword">let</span>​ context <span class="token operator">=</span> ​<span class="token class-name">BTermBuilder</span>​<span class="token punctuation">::</span>​simple80x50​<span class="token punctuation">(</span><span class="token punctuation">)</span> 
​​​	    ​<span class="token punctuation">.</span>with_title​<span class="token punctuation">(</span>​<span class="token lifetime-annotation symbol">'Flappy</span> <span class="token class-name">Dragon</span>'​<span class="token punctuation">)</span> 
​​​	    ​<span class="token punctuation">.</span>build​<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span> </code></pre>
<p>Une autre particularité de Rust est qu'il n'y a pas de tabulation, on utilise 4 espaces à la place.
Un autre exemple d'application est la création du personnage joueur. On initialise ses coordonnées horizontales et verticales avec des entiers codés sur 32 bits, ainsi que sa vitesse, qui est un flottant. On va aussi initialiser un constructeur pour le joueur, le plaçant sur des coordonnées x et y avec une vitesse initiale.</p>
<pre class="language-rust"><code class="language-rust">​<span class="token keyword">struct</span>​ <span class="token class-name">Player</span> <span class="token punctuation">{</span>
​​​	    x<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span> 
​​​	    y<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span> 
​​​	    velocity<span class="token punctuation">:</span> <span class="token keyword">f32</span><span class="token punctuation">,</span> 
​ 	<span class="token punctuation">}</span>

​<span class="token keyword">impl</span>​ <span class="token class-name">Player</span> <span class="token punctuation">{</span>
    ​<span class="token keyword">fn</span>​ ​new​<span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">)</span> ​<span class="token punctuation">-></span>​ <span class="token keyword">Self</span> <span class="token punctuation">{</span>
​ 	     <span class="token class-name">Player</span> <span class="token punctuation">{</span>
​ 	         x<span class="token punctuation">,</span>
​ 	         y<span class="token punctuation">,</span>
​​ ​	         velocity<span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
​ 	        <span class="token punctuation">}</span>
​ 	    <span class="token punctuation">}</span></code></pre>
<p>On constate ainsi des éléments de POO, où on a un objet Joueur déterminé par sa position, et sa vitesse. (Souvenirs de C#...)</p>
<h2>Conclusion</h2>
<p>Cette programmation d'un jeu simple m'a permis d'appliquer les notions du livre officiel de Rust, qui était en somme assez théorique. J'ai pu ainsi cerner tous les objets de Rust, qui au premier abord paraissaient assez abstraits. J'ai aussi pu comparer avec mon expérience de programmation sur Godot, où je me suis rendu compte que je me suis fait vraiment tenir la main par le moteur, et j'ai pu découvrir beaucoup d'aspects de gamedev que le développement avec Godot ne m'aurait jamais fait voir. Je pense continuer à jouer avec Rust dans mon temps libre, mais plus de jeu vidéo. C'était très enrichissant, mais Godot reste tout de même bien pratique.</p>
<h2>Bibliographie</h2>
<ul>
<li>MON d'Assane Diouf <a href="https://francoisbrucker.github.io/do-it/promos/2023-2024/Diouf-Asssane/mon/Rust/">https://francoisbrucker.github.io/do-it/promos/2023-2024/Diouf-Asssane/mon/Rust/</a></li>
<li>MON de Paul Vietor <a href="https://francoisbrucker.github.io/do-it/promos/2023-2024/Vietor-Paul/mon/temps-1.2/">https://francoisbrucker.github.io/do-it/promos/2023-2024/Vietor-Paul/mon/temps-1.2/</a></li>
<li>The Rust Programming Language <a href="https://doc.rust-lang.org/stable/book/title-page.html">https://doc.rust-lang.org/stable/book/title-page.html</a></li>
<li>Hands-on Rust : Effective learning through 2D Game Development and Play, Herbert Wolverson (2021)</li>
</ul>


</article>

        </main>


        <footer class="min-h-[50px] border-t-2 border-gray-200 mt-4">
            <div class="max-w-[1000px] mx-auto px-4">
                <div class="min-h-[50px] flex justify-center items-center">
                    <p class="text-center">
                        <span style="font-family: Consolas, sans-serif;">Do_<span style="color: #4a86e8">It</span></span> : Développent et Organisation en IT
                    </p>
                </div>
            </div>
        </footer>

        <script>
        MathJax
            .startup
            .document
            .getMathItemsWithin(document.body);
        </script>
        
            <script src="/do-it/assets/node_modules/prismjs/components/prism-python.min.js"></script>
        
            <script src="/do-it/assets/node_modules/prismjs/components/prism-bash.min.js"></script>
        
            <script src="/do-it/assets/node_modules/prismjs/components/prism-yaml.min.js"></script>
        
            <script src="/do-it/assets/node_modules/prismjs/components/prism-json.min.js"></script>
        
            <script src="/do-it/assets/node_modules/prismjs/components/prism-sql.min.js"></script>
        
            <script src="/do-it/assets/node_modules/prismjs/components/prism-docker.min.js"></script>
        
            <script src="/do-it/assets/node_modules/prismjs/components/prism-toml.min.js"></script>
        
            <script src="/do-it/assets/node_modules/prismjs/components/prism-markdown.min.js"></script>
        
            <script src="/do-it/assets/node_modules/prismjs/components/prism-java.min.js"></script>
        
            <script src="/do-it/assets/node_modules/prismjs/components/prism-javascript.min.js"></script>
        
            <script src="/do-it/assets/node_modules/prismjs/components/prism-typescript.min.js"></script>
        
            <script src="/do-it/assets/node_modules/prismjs/components/prism-css.min.js"></script>
        
            <script src="/do-it/assets/node_modules/prismjs/components/prism-scss.min.js"></script>
        
            <script src="/do-it/assets/node_modules/prismjs/components/prism-html.min.js"></script>
        
            <script src="/do-it/assets/node_modules/prismjs/components/prism-c.min.js"></script>
        
            <script src="/do-it/assets/node_modules/prismjs/components/prism-cpp.min.js"></script>
        
            <script src="/do-it/assets/node_modules/prismjs/components/prism-rust.min.js"></script>
        
            <script src="/do-it/assets/node_modules/prismjs/components/prism-go.min.js"></script>
        
            <script src="/do-it/assets/node_modules/prismjs/components/prism-ada.min.js"></script>
        
            <script src="/do-it/assets/node_modules/prismjs/components/prism-csharp.min.js"></script>
        
            <script src="/do-it/assets/node_modules/prismjs/components/prism-apex.min.js"></script>
        
            <script src="/do-it/assets/node_modules/prismjs/components/prism-arduino.min.js"></script>
        
            <script src="/do-it/assets/node_modules/prismjs/components/prism-csv.min.js"></script>
        
            <script src="/do-it/assets/node_modules/prismjs/components/prism-javadoc.min.js"></script>
        
            <script src="/do-it/assets/node_modules/prismjs/components/prism-kotlin.min.js"></script>
        
            <script src="/do-it/assets/node_modules/prismjs/components/prism-objectivec.min.js"></script>
        
            <script src="/do-it/assets/node_modules/prismjs/components/prism-pascal.min.js"></script>
        
            <script src="/do-it/assets/node_modules/prismjs/components/prism-perl.min.js"></script>
        
            <script src="/do-it/assets/node_modules/prismjs/components/prism-php.min.js"></script>
        
            <script src="/do-it/assets/node_modules/prismjs/components/prism-r.min.js"></script>
        
            <script src="/do-it/assets/node_modules/prismjs/components/prism-ruby.min.js"></script>
        
            <script src="/do-it/assets/node_modules/prismjs/components/prism-scala.min.js"></script>
        
            <script src="/do-it/assets/node_modules/prismjs/components/prism-swift.min.js"></script>
        
            <script src="/do-it/assets/node_modules/prismjs/components/prism-lua.min.js"></script>
        
            <script src="/do-it/assets/node_modules/prismjs/components/prism-makefile.min.js"></script>
        
            <script src="/do-it/assets/node_modules/prismjs/components/prism-matlab.min.js"></script>
        
            <script src="/do-it/assets/node_modules/prismjs/components/prism-mermaid.min.js"></script>
        
            <script src="/do-it/assets/node_modules/prismjs/components/prism-ocaml.min.js"></script>
        
            <script src="/do-it/assets/node_modules/prismjs/components/prism-powershell.min.js"></script>
        
            <script src="/do-it/assets/node_modules/prismjs/components/prism-visual-basic.min.js"></script>
        
            <script src="/do-it/assets/node_modules/prismjs/components/prism-wasm.min.js"></script>
        
            <script src="/do-it/assets/node_modules/prismjs/components/prism-xml-doc.min.js"></script>
        
            <script src="/do-it/assets/node_modules/prismjs/components/prism-zig.min.js"></script>
        
    </body>
</html>
