
<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>SérénaDo_It - Du POC à la production</title>

        <link href="/do-it/assets/node_modules/prismjs/themes/prism-solarizedlight.min.css" rel="stylesheet">
        <link href="/do-it/assets/node_modules/prismjs/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet">

        <link href="/do-it/assets/stylesheets/main.css" rel="stylesheet">
    </head>
    <body>
        <script>
        window.MathJax = {
            tex: {
            inlineMath: [
                [
                '$', '$'
                ],
                [
                '\\(', '\\)'
                ]
            ]
            },
            svg: {
            fontCache: 'global'
            }
        };
        </script>
        <script type="text/javascript" id="MathJax-script" src="/do-it/assets/node_modules/mathjax/es5/tex-svg-full.js"></script>

        <header class="border-b-2 border-gray-200 mb-4">
        <div class="max-w-[1000px] mx-auto px-4">
            <div class="min-h-[50px] flex justify-between items-center">
                <a class="mx-2" href="/do-it/">Home</a>
                <div class="flex items-center gap-4 sm:gap-6 ">
                    <a class="" href="/do-it/cs">CS</a>
                    <a class="" href="/do-it/pok">POK</a>
                    <a class="" href="/do-it/mon">MON</a>
                    <a class="" href="/do-it/projets">Projets</a>
                    <a class="hidden sm:block" href="/do-it/promos">Promos</a>
                    <a href="/do-it/search">
                        <svg class="h-5 aspect-square" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"></path>
                        </svg>
                    </a>
                    <a class="hidden sm:block" href="https://github.com/FrancoisBrucker/do-it" target="_blank">
                        <svg class="h-5 aspect-square" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg>
                    </a>
                </div>
            </div>
        </div>
        </header>

        <main class="max-w-[1000px] mx-auto px-4" data-pagefind-body="">
            
<article class="relative">
<h1 class="mb-1">SérénaDo_It - Du POC à la production</h1>
<div class="mb-4">
    
        <div class="px-4 flex flex-wrap items-center">
            
                <div class="font-bold">Tags : </div>
            
            <ul class="flex flex-wrap overflow-auto not-prose list-none my-1 mx-0 px-1 gap-1" data-pagefind-meta="Tags">
                
                    <li class="bg-yellow-200 rounded-full px-2" data-pagefind-filter="Tags">POK</li>
                
                    <li class="bg-yellow-200 rounded-full px-2" data-pagefind-filter="Tags">2023-2024</li>
                
                    <li class="bg-yellow-200 rounded-full px-2" data-pagefind-filter="Tags">temps 2</li>
                
                    <li class="bg-yellow-200 rounded-full px-2" data-pagefind-filter="Tags">Data</li>
                
                    <li class="bg-yellow-200 rounded-full px-2" data-pagefind-filter="Tags">Excel</li>
                
                    <li class="bg-yellow-200 rounded-full px-2" data-pagefind-filter="Tags">Google Spreadsheet</li>
                
                    <li class="bg-yellow-200 rounded-full px-2" data-pagefind-filter="Tags">Python</li>
                

            </ul>
            
            
            <div class="hidden" data-pagefind-meta="Type">
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </div>
        </div>
    

    
        <div class="px-4 flex flex-wrap items-center">
            <div class="font-bold">Auteurs : </div>
            <ul class="flex flex-wrap not-prose list-none my-1 mx-0 px-1 gap-1" data-pagefind-meta="Auteurs">
                
                    <li class="bg-blue-200 rounded-full px-2" data-pagefind-filter="Auteurs">Arthur Louradou</li>
                
            </ul>
        </div>
    

    
</div>

        <p class="mb-4 text-lg">

                Ce POK, modestement nommé selon le nom de son grand frère Sérénade, est un projet de création d'un site web de gestion de calendrier pour les élèves en 3A.

        </p>



    
<div class="quote relative  py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-purple-500 bg-purple-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-purple-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"></path>
</svg>
<div class="pl-8 mr-8">

<a href="/do-it/promos/">Promotions</a><span class="px-1">/</span><a href="/do-it/promos/2023-2024/">2023-2024</a><span class="px-1">/</span><a href="/do-it/promos/2023-2024/Louradou-Arthur/">Arthur Louradou</a><span class="px-1">/</span><a href="/do-it/promos/2023-2024/Louradou-Arthur/pok/">POKs</a><span class="px-1">/</span><a href="/do-it/promos/2023-2024/Louradou-Arthur/pok/temps-2/">SérénaDo_It - Du POC à la production</a>

</div></div>




<a href="http://node.oignon.ovh1.ec-m.fr/" class="buttonGithub">
  <span>Accéder à SérénaDo_It !</span>
</a>
<h2>Sommaire</h2>
<ul>
<li><a href="#objectifs">Objectifs</a></li>
<li><a href="#sprint-planning">Sprint planning</a>
<ul>
<li><a href="#sprint-1">Sprint 1</a></li>
<li><a href="#sprint-2">Sprint 2</a></li>
</ul>
</li>
<li><a href="#de-la-recherche-au-poc">De la recherche au POC</a>
<ul>
<li><a href="#google-spredsheet">Google Spredsheet</a></li>
<li><a href="#traitement">Traitement</a></li>
</ul>
</li>
<li><a href="#du-poc-%C3%A0-la-r%C3%A9alisation">Du POC à la réalisation</a></li>
<li><a href="#revue-de-sprint-1">Revue de Sprint 1</a></li>
<li><a href="#suite--sprint-2">Suite : Sprint 2</a>
<ul>
<li><a href="#objectifs-fin-sprint1">Objectifs à l'issue du Sprint 1</a></li>
<li><a href="#documentation-google-api">Lecture de documentation de <strong>Google Workspace APIs</strong> pour déployer en local</a></li>
<li><a href="#solution">Une solution inespérée, plus simple..!</a></li>
<li><a href="#integration-poc">Intégration du POC au code</a></li>
<li><a href="#traitement-donnees">Traitement des données</a></li>
<li><a href="#tests-unitaires">Tests unitaires</a></li>
</ul>
</li>
<li><a href="#perspectives-et-conclusion">Perspectives et conclusion</a></li>
<li><a href="#liens-et-documentation">Liens et documentation</a></li>
</ul>
<h2 id="objectifs">Objectifs</h2>
<p>Les objectifs de cette réalisation sont les suivants :</p>
<ul>
<li>Extraire l'information pertinente du calendrier de la filière Do_It</li>
<li>Exporter cette donnée à la main dans un fichier .ics</li>
<li>Créer un site web permettant de s'abonner au calendrier élève par élève, à partir du travail de Duc</li>
</ul>
<h2 id="sprint-planning">Sprint planning</h2>
<h3 id="sprint-1">Sprint 1</h3>
<table>
<thead>
<tr>
<th>Tâche</th>
<th>Difficulté</th>
<th>Temps</th>
</tr>
</thead>
<tbody>
<tr>
<td>Interagir avec l'API Google Spreadsheet</td>
<td>1</td>
<td>1h</td>
</tr>
<tr>
<td>Extraire les informations du tableur sous forme de DataFrame</td>
<td>2</td>
<td>2h</td>
</tr>
<tr>
<td>Extraire du DataFrame les informations pertinentes</td>
<td>3</td>
<td>2h</td>
</tr>
<tr>
<td>Tester, débugger, chercher des solutions</td>
<td>5</td>
<td>3h</td>
</tr>
<tr>
<td>Exporter ces informations dans un fichier .ics</td>
<td>1</td>
<td>1h</td>
</tr>
<tr>
<td>Générer l'architecture propre du projet</td>
<td>2</td>
<td>2h</td>
</tr>
</tbody>
</table>
<p>À la fin de ce sprint, nous devrions avoir un programme qui s'éxécute en ligne de commande et qui permet d'extraire les informations de l'Excel (Google Spreadsheet, en réalité) du calendrier de la filière Do_It.</p>
<h3 id="sprint-2">Sprint 2</h3>
<table>
<thead>
<tr>
<th>Tâche</th>
<th>Difficulté</th>
<th>Temps</th>
</tr>
</thead>
<tbody>
<tr>
<td>Écrire les tests unitaires</td>
<td>5</td>
<td>3h</td>
</tr>
<tr>
<td>Mettre le POC du POK dans les classes python</td>
<td>3</td>
<td>2h</td>
</tr>
<tr>
<td>Dégugger le code jusqu'à export du .ics</td>
<td>5</td>
<td>3h</td>
</tr>
<tr>
<td>Créer une interface web pour exporter le .ics</td>
<td>3</td>
<td>2h</td>
</tr>
</tbody>
</table>
<p>Dans cette partie, nous allons créer une interface permettant d'exporte un .ics et de s'abonner au calendrier de la filière Do_It, en tâchant de personnaliser cela aux élèves en utilisant le travail de Duc.</p>
<h2 id="de-la-recherche-au-poc">De la recherche au POC</h2>
<p>Je vais vous présenter dans cette partie les pistes de codes envisagées au cours de la phase de recherche nécessaire à l'analyse de données.
En effet, ce projet comporte une phase de recherche importante, car il faut comprendre le fonctionnement de l'API Google Spreadsheet, et trouver un moyen de l'utiliser pour traiter les données du calendrier de la filière Do_It.</p>
<h3 id="google-spredsheet">Google Spredsheet</h3>
<p>Pour commencer, voilà comment importer notre fichier dans Google Colab :</p>
<div class="relative drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-indigo-500 bg-indigo-100">
<details class="group">
<summary class="list-none py-0.5">
<svg class="group-open:hidden absolute w-7 h-7 pl-1 pt-0.5 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"></path>
</svg>
<svg class="group-open:block hidden absolute w-7 h-7 pl-1 pt-0.5 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path>
</svg>
<div class="pl-8 font-bold inline-block">
<p>Authentification Google Colab et traitement de la donnée</p>
</div>
<svg class="group-open:hidden inline-block pl-3 w-10 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M5 12h.01M12 12h.01M19 12h.01M6 12a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0z"></path>
</svg>
</summary>
<div class="mx-8 pb-2">
<pre class="language-python " style="counter-reset: linenumber 0"><code class="language-python"><span class="token keyword">from</span> google<span class="token punctuation">.</span>colab <span class="token keyword">import</span> drive
drive<span class="token punctuation">.</span>mount<span class="token punctuation">(</span><span class="token string">'/content/drive'</span><span class="token punctuation">)</span>
</code></pre>
<p>Ensuite, il faut autoriser google à nous authentifier sur ses services :</p>
<pre class="language-python " style="counter-reset: linenumber 0"><code class="language-python"><span class="token keyword">from</span> google<span class="token punctuation">.</span>colab <span class="token keyword">import</span> auth
auth<span class="token punctuation">.</span>authenticate_user<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">import</span> gspread
<span class="token keyword">from</span> google<span class="token punctuation">.</span>auth <span class="token keyword">import</span> default
creds<span class="token punctuation">,</span> _ <span class="token operator">=</span> default<span class="token punctuation">(</span><span class="token punctuation">)</span>

gc <span class="token operator">=</span> gspread<span class="token punctuation">.</span>authorize<span class="token punctuation">(</span>creds<span class="token punctuation">)</span>

workbook <span class="token operator">=</span> gc<span class="token punctuation">.</span>open_by_url<span class="token punctuation">(</span><span class="token operator">&lt;</span>url du spreadsheet Do_It<span class="token operator">></span><span class="token punctuation">)</span>
ws <span class="token operator">=</span> workbook<span class="token punctuation">.</span>worksheet<span class="token punctuation">(</span><span class="token string">'année'</span><span class="token punctuation">)</span>
</code></pre>
<p>On peut ensuite récupérer les données de la feuille de calcul :</p>
<pre class="language-python " style="counter-reset: linenumber 0"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>ws<span class="token punctuation">.</span>get_all_records<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

sheet_titles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token keyword">for</span> sheet <span class="token keyword">in</span> workbook<span class="token punctuation">.</span>worksheets<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  sheet_titles<span class="token punctuation">.</span>append<span class="token punctuation">(</span>sheet<span class="token punctuation">.</span>title<span class="token punctuation">)</span>

<span class="token comment"># Get_all_values from sheets and store in dictionary</span>
dict_of_sheets <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">for</span> sheet_title <span class="token keyword">in</span> sheet_titles<span class="token punctuation">:</span>
  sheet <span class="token operator">=</span> workbook<span class="token punctuation">.</span>worksheet<span class="token punctuation">(</span>sheet_title<span class="token punctuation">)</span>
  values <span class="token operator">=</span> sheet<span class="token punctuation">.</span>get_all_values<span class="token punctuation">(</span><span class="token punctuation">)</span>
  dict_of_sheets<span class="token punctuation">[</span>sheet_title<span class="token punctuation">]</span> <span class="token operator">=</span> values
<span class="token comment"># To confirm all sheets made it into the dictionary</span>
dict_of_sheets<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span>

df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">.</span>from_records<span class="token punctuation">(</span>dict_of_sheets<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'année'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>nan<span class="token punctuation">)</span>
<span class="token comment"># df = df.fillna(axis=1, method='ffill')</span>
df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>method<span class="token operator">=</span><span class="token string">'ffill'</span><span class="token punctuation">)</span>

two_first <span class="token operator">=</span> df<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>
two_first <span class="token operator">=</span> two_first<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span><span class="token punctuation">)</span>
first <span class="token operator">=</span> two_first<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">","</span> <span class="token operator">+</span> two_first<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>

headers <span class="token operator">=</span> df<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values
df<span class="token punctuation">.</span>columns <span class="token operator">=</span> first
</code></pre>
</div>
</details>     
</div>
<p>À ce stade, le code n'est pas propre et il faut encore le nettoyer. Cependant, il permet d'obtenir un DataFrame contenant les données du calendrier :</p>
<div class="relative drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-indigo-500 bg-indigo-100">
<details class="group">
<summary class="list-none py-0.5">
<svg class="group-open:hidden absolute w-7 h-7 pl-1 pt-0.5 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"></path>
</svg>
<svg class="group-open:block hidden absolute w-7 h-7 pl-1 pt-0.5 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path>
</svg>
<div class="pl-8 font-bold inline-block">
<p>Voir la DataFrame</p>
</div>
<svg class="group-open:hidden inline-block pl-3 w-10 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M5 12h.01M12 12h.01M19 12h.01M6 12a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0z"></path>
</svg>
</summary>
<div class="mx-8 pb-2">
<div style="overflow: scroll">
<table>
<thead>
<tr>
<th>index</th>
<th>Ors,</th>
<th>Ors,</th>
<th>Semaine,du</th>
<th>Semaine,au</th>
<th>Lundi,8h-9h</th>
<th>Lundi,9h-10h</th>
<th>Lundi,10h-11h</th>
<th>Lundi,11h-12h15</th>
<th>Lundi,14h-15h</th>
<th>Lundi,15h-16h</th>
<th>Lundi,16h15-17h15</th>
<th>Lundi,17h15-18h15</th>
<th>Mardi,8h-9h</th>
<th>Mardi,9h-10h</th>
<th>Mardi,10h15-11h15</th>
<th>Mardi,11h15-12h15</th>
<th>Mardi,14h-15h</th>
<th>Mardi,15h-16h</th>
<th>Mardi,16h15-17h15</th>
<th>Mardi,17h15-18h15</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr>
<td>1</td>
<td></td>
<td></td>
<td>du</td>
<td>au</td>
<td>8h-9h</td>
<td>9h-10h</td>
<td>10h-11h</td>
<td>11h-12h15</td>
<td>14h-15h</td>
<td>15h-16h</td>
<td>16h15-17h15</td>
<td>17h15-18h15</td>
<td>8h-9h</td>
<td>9h-10h</td>
<td>10h15-11h15</td>
<td>11h15-12h15</td>
<td>14h-15h</td>
<td>15h-16h</td>
<td>16h15-17h15</td>
<td>17h15-18h15</td>
</tr>
<tr>
<td>2</td>
<td>temps 1</td>
<td></td>
<td>28/08</td>
<td>01/09</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>3</td>
<td></td>
<td></td>
<td>04/09</td>
<td>08/09</td>
<td>tronc commun 3A</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>4</td>
<td></td>
<td>1</td>
<td>11/09</td>
<td>15/09</td>
<td></td>
<td></td>
<td>Bonjour !(FB--LP)218</td>
<td></td>
<td>TC1 : Agilité(Florian Magnani)Visio/218</td>
<td></td>
<td></td>
<td></td>
<td>Langues</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div>
</div>
</details>     
</div>
<p>On voit que le header a une forme satisfaisante pour être exploitable par la suite.</p>
<p>Un point important à noter est que les cases fusionnées dans Excel ne sont présenter que dans la première ligne du DataFrame. On pourrait considérer les remplir avec la méthode <code>fillna(method='ffill')</code>, mais cela engenderait des incohérences et des &quot;trous&quot; dans l'emploi du temps seraient remplis.</p>
<p>Pour combler ceci, il va falloir extraire les informations de fusion du google spreadsheet. Après de longues recherches, ceci s'est avéré impossible.</p>
<p>Il faut donc trouver une autre solution, dont l'une retenue est d'exporter la taille des cours du fichier excel exporté, qui lui possède bien les informations de fusion.</p>
<p>Nous verrons dans un second temps comment procéder.</p>
<h3 id="traitement">Traitement</h3>
<p>À l'aide de fonctions utilitaires et d'une boucle, on peut extraire les informations de l'emploi du temps :</p>
<div class="relative drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-indigo-500 bg-indigo-100">
<details class="group">
<summary class="list-none py-0.5">
<svg class="group-open:hidden absolute w-7 h-7 pl-1 pt-0.5 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"></path>
</svg>
<svg class="group-open:block hidden absolute w-7 h-7 pl-1 pt-0.5 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path>
</svg>
<div class="pl-8 font-bold inline-block">
<p>Extraction des informations</p>
</div>
<svg class="group-open:hidden inline-block pl-3 w-10 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M5 12h.01M12 12h.01M19 12h.01M6 12a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0z"></path>
</svg>
</summary>
<div class="mx-8 pb-2">
<pre class="language-python " style="counter-reset: linenumber 0"><code class="language-python"><span class="token keyword">from</span> icalendar <span class="token keyword">import</span> Calendar<span class="token punctuation">,</span> Event
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime<span class="token punctuation">,</span> timedelta

row <span class="token operator">=</span> df<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span>  <span class="token comment"># Prenons un ligne pour exemple</span>
row <span class="token operator">=</span> row<span class="token punctuation">.</span>fillna<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token comment"># On enlève les deux premières colonnes, qui ne nous intéressent pas</span>

cal <span class="token operator">=</span> Calendar<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> col_name<span class="token punctuation">,</span> col_value <span class="token keyword">in</span> row<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> col_name <span class="token operator">==</span> <span class="token string">'Semaine,du'</span><span class="token punctuation">:</span>
        week_start_date <span class="token operator">=</span> datetime<span class="token punctuation">.</span>strptime<span class="token punctuation">(</span>col_value<span class="token operator">+</span><span class="token string">"/2023"</span><span class="token punctuation">,</span> <span class="token string">'%d/%m/%Y'</span><span class="token punctuation">)</span>
        week_end_date <span class="token operator">=</span> week_start_date <span class="token operator">+</span> timedelta<span class="token punctuation">(</span>days<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Traitement de la semaine du"</span><span class="token punctuation">,</span>week_start_date<span class="token punctuation">,</span><span class="token string">"au"</span><span class="token punctuation">,</span>week_end_date<span class="token punctuation">)</span>
    <span class="token keyword">elif</span> col_value<span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            event_start_date<span class="token punctuation">,</span> event_end_date <span class="token operator">=</span> parse_custom_time<span class="token punctuation">(</span>
                df<span class="token punctuation">[</span>col_name<span class="token punctuation">]</span><span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">(</span>week_start_date <span class="token operator">+</span> timedelta<span class="token punctuation">(</span>days<span class="token operator">=</span>df<span class="token punctuation">[</span>col_name<span class="token punctuation">]</span><span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>date<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span>

            event_end_date <span class="token operator">=</span> event_start_date <span class="token operator">+</span> timedelta<span class="token punctuation">(</span>hours<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>

            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Événement détecté le"</span><span class="token punctuation">,</span>event_start_date<span class="token punctuation">,</span>event_end_date<span class="token punctuation">,</span><span class="token string">":"</span><span class="token punctuation">,</span>col_value<span class="token punctuation">)</span>

            event <span class="token operator">=</span> Event<span class="token punctuation">(</span><span class="token punctuation">)</span>
            event<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">'summary'</span><span class="token punctuation">,</span> col_value<span class="token punctuation">)</span>  <span class="token comment"># Ajoutez le contenu de la cellule comme titre de l'événement</span>
            event<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">'dtstart'</span><span class="token punctuation">,</span> event_start_date<span class="token punctuation">)</span>
            event<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">'dtend'</span><span class="token punctuation">,</span> event_end_date<span class="token punctuation">)</span> <span class="token comment"># + compute_duration()</span>

            cal<span class="token punctuation">.</span>add_component<span class="token punctuation">(</span>event<span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Erreur dans la colonne"</span><span class="token punctuation">,</span>col_value<span class="token punctuation">,</span><span class="token string">": "</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span>
</code></pre>
</div>
</details>     
</div>
<p>Ce code parcourt donc les colonnes pour une ligne donnée, et crée un événement pour chaque cours détecté.
Le fait que cela fonctionne, et donne des cours d'une heure dans mon calendrier, est satisfaisant et démontre que l'on peut faire un Proof Of Concept de ce POK.</p>
<p>Le problème subsiste avec les cours de deux ou trois heures, qui sont détectés comme des cours d'une heure.</p>
<h2 id="du-poc-à-la-réalisation">Du POC à la réalisation</h2>
<p>Pour passer du POC à la réalisation, il convient de quitter l'environnement Google Colab et d'ouvrir un repository Git digne de ce nom.</p>
<p>Nous travaillerons donc sur un environnement local en utilisant au maximum des classes python pour rendre le code plus lisible et plus facilement maintenable.</p>
<p>Je vous propose donc pour cette revue de Sprint 1 de vous présenter la structure qu'aura le code au repo suivant : <a href="https://github.com/alouradou/SerenaDo_It">https://github.com/alouradou/SerenaDo_It</a></p>
<h2 id="revue-de-sprint-1">Revue de Sprint 1</h2>
<p>Dans ce Sprint, nous avons vu comment extraire les informations de l'emploi du temps de la filière Do_It, et comment les traiter pour les exporter dans un fichier .ics.</p>
<p>Nous avons ainsi produit un Proof Of Concept qui nous permet de voir que le projet est réalisable, puis nous avons défini la structure du code sous forme de classes qui sera utilisée pour la suite du projet.</p>
<p>Vous pourrez noter ici que la structure du code est générée à l'aide de l'assistant chatGPT et je m'assurerai que le contenu qui s'y trouve en dernier lieu sera bien vérifié et testé par mes soins.
Petit point méthodologique cependant : j'utilise principalement chatGPT dans ce genre de cas, à l'initialisation d'un projet, car ses réponses sont bonnes pour établir une architecture globale et &quot;dans les règles de l'art&quot; (respectant des bonnes pratiques dès le départ) d'une application.</p>
<h2 id="suite--sprint-2">Suite : Sprint 2</h2>
<h3 id="objectifs-fin-sprint1">Objectifs à l'issue du Sprint 1</h3>
<ul>
<li>Faire des Tests Unitaires ! Cela facilitera l'intégration des fonctions de traitement de données</li>
<li>Intégrer le POC au code</li>
<li>Automatiser l'exportation du (des !) fichier .ics pour les élèves</li>
</ul>
<h3 id="documentation-google-api">Lecture de documentation de <strong>Google Workspace APIs</strong> pour déployer en local</h3>
<p>La solution prometteuse semblait être l’utilisation de l’API de Google pour le projet en dehors d’un environnement Google Workspace. Cependant, celle-ci a des règles bien spécifiques pour être utilisée sur n’importe quelle application, incluant un environnement de test contraignant ou bien une validation de la part de Google. Ce détour est néanmoins intéressant pour comprendre le fonctionnement de certaines applications Cloud. [3]</p>
<p>J’ai donc abandonné cette piste qui m’a conduit à d’autres recherches.</p>
<h3 id="solution">Une solution inespérée, plus simple..!</h3>
<p>Durant les recherches sur l’API, certains posts ont mentionné des liens d’export et nous aurions pu commencer par là : analyser les requêtes effectuées par le navigateur pour télécharger un Google Spreadsheet en PDF, Excel, CSV, etc. En effet, à l’aide d’un simple lien composé de cette façon :</p>
<pre class="language-python " style="counter-reset: linenumber 0"><code class="language-python">csv_url <span class="token operator">=</span> <span class="token string">"https://docs.google.com/spreadsheets/d/"</span> <span class="token operator">+</span> sheet_id <span class="token operator">+</span> <span class="token string">"/gviz/tq?tqx=out:csv&amp;sheet="</span> <span class="token operator">+</span> sheet_name
xlsx_url <span class="token operator">=</span> <span class="token string">"https://docs.google.com/spreadsheets/d/"</span> <span class="token operator">+</span> sheet_id <span class="token operator">+</span> <span class="token string">"/export?format=xlsx&amp;id="</span> <span class="token operator">+</span> sheet_id
</code></pre>
<p>Avec le Sheet id se trouvant dans l’URL de l’emploi du temps de Do_It.</p>
<aside>
💡 Merveilleux : nous avons désormais un Google Sheet qui se télécharge tout seul et qui peut être exploité par la bibliothèque `openpyxl` comme le fait DUC dans son MON !
</aside>
<h3 id="integration-poc">Intégration du POC au code</h3>
<p>Dans cette phase du projet, nous avons consolidé le Proof Of Concept (POC) que nous avons développé dans le Sprint 1. Pour ce faire, nous avons intégré le code du POC dans la structure du projet définie précédemment. Les fonctionnalités de traitement des données du Google Spreadsheet ont été encapsulées dans des classes Python pour assurer une intégration automatique à tout code python y faisant appel.</p>
<h3 id="traitement-donnees">Traitement des données</h3>
<div style="display:flex;flex-direction: row;">
  <div style="display: block; margin-right: 20px;">
<p>Comme il ne s’agit pas de perdre tout le monde, j’invite les intéressés à regarder le code du projet et à tester par vous même l’interface disponible au moment où je poste ce MON à son adresse de déploiement. Je vais tout de même détailler les classes intéressantes du projet pour le traitement des données.</p>
<p>Dans la phase de traitement des données, nous avons utilisé les bibliothèques <code>openpyxl</code> et <code>pandas</code> pour extraire et manipuler les données de l’Excel et résoudre la problématique des cellules fusionnées.</p>
<p>Comme un schéma vaut mieux que mille mots, voici le schéma de la donnée à mettre en perspective avec le code.</p>
<h3 id="fonctionnement-application">Fonctionnement de l’application</h3>
<a href="http://node.oignon.ovh1.ec-m.fr/" class="buttonGithub">
  <span>Allons voir le projet !</span>
</a>
<p>Le fonctionnement de l’application est possible de plusieurs façons que je vais détailler de la plus stable et fiable à la moins éprouvée.</p>
</div>
<img src="assets/schema_data_serenadoit.png" style="width: 30vw; aspect-ratio: 1/1;">
</div>
<ol>
<li>
<p>Le calendrier général (route <code>/annee</code>)</p>
<p>Dans le cas où vous souhaitez consulter l’agenda général, vous pouvez vous y abonner et voir les cours de tout Do_It. Notez que ce calendrier marche avec l’agenda de l’option CliMaTHs car leur calendrier est de la même forme que celui de l’option Do_It. Pour ce qui est de la génération du calendrier avec abonnement à partir du Google Sheet, celle-ci a lieu lors du clic sur le bouton “La liste complète des cours de l’année”. Vous pouvez donc mettre à jours les cours de toute l’option en parcourant le site !</p>
</li>
<li>
<p>Personnalisation à partir de votre Excel (route POST <code>/annee/source-excel</code>)</p>
<p>Vous pouvez vous-même supprimer les cours que vous n’avez pas choisi au cours de l’année et ainsi personnaliser votre calendrier et ajouter vos propres événements. Veillez à ne pas toucher à la structure de l’Excel et cela sera</p>
</li>
<li>
<p>Scrapping de l’export de Duc depuis Github (route <code>/github</code>)</p>
<p>À l’origine, Duc a sorti un export lors de <a href="../../../Dang-Vu-Duc/mon/temps-1.2/">son MON 1.2.</a> Il est donc possible de récupérer les fichiers Excel bruts sur le repo du site. On affiche ainsi une liste de documents qui peuvent être intégrés au programme de traitement.
Problème relevé : lorsque l’orthographe des cours est inexacte dans la première ligne de la cellule de l’emploi du temps, le cours n’apparait pas. Deux solutions sont envisagées : modifier un peu l’algorithme pour le rendre plus robuste ou écrire des tests unitaires pour garantir l’intégrité du calendrier ainsi généré.</p>
</li>
<li>
<p>Utilisation de l’algorithme de Duc directement dans l’API (route <code>/eleves</code>)</p>
<p>Cette route liste les élèves pour exécuter l’algorithme de sélection des cours directement dans l’application.</p>
</li>
</ol>
<h3 id="tests-unitaires">Tests unitaires</h3>
<p>Pour assurer la fiabilité de ce dernier algorithme (qui est le plus pratique pour les élèves), j’ai pu lors du peu de temps restant exécuter un test dont voici le principe :</p>
<ol>
<li>Créer un élève “Test” qui aurait rempli de “X” toutes les cases de choix de cours.</li>
<li>Parcourir l’Excel généré par la fonction de Duc et l’Excel original, complet.</li>
<li>En relevant les différences, on sait si des problèmes d’orthographe ont été repérés.</li>
</ol>
<p>Pour l’heure, je corrige ces problèmes en ajoutant dans CreateTimetable, la liste des cours problématiques comme s’ils s’agissait de tronc commun :</p>
<pre class="language-python " style="counter-reset: linenumber 0"><code class="language-python"><span class="token string">"architecture si"</span><span class="token punctuation">,</span> <span class="token string">"stratégje &amp; si"</span><span class="token punctuation">,</span> <span class="token string">"people analytics"</span><span class="token punctuation">,</span> <span class="token string">"it &amp; dynamique organisationnelle"</span>
</code></pre>
<p>Il conviendrait d'en réaliser de nouveaux.</p>
<h2 id="perspectives-et-conclusion">Perspectives et conclusion</h2>
<p>Ce projet a été très intéressant à réaliser car il m’a permis de découvrir des outils très utiles pour la gestion de données et de me sentir à l'aise avec des concepts de développement complets pour un résulat utilisable par les élèves de Do_It.</p>
<p>Je pense que ce projet peut être amélioré en plusieurs points :</p>
<ul>
<li>Demander des retours aux utilisateur</li>
<li>Ajouter des tests unitaires pour garantir la fiabilité de l’algorithme de persionnalisations des cours</li>
<li>Ajouter une fonction de mise à jour automatique du calendrier</li>
</ul>
<h2 id="liens-et-documentation">Liens et documentation</h2>
<p>[1] Code du projet : <a href="https://github.com/alouradou/SerenaDo_It">https://github.com/alouradou/SerenaDo_It</a></p>
<p>[2] Testez le projet : <a href="http://node.oignon.ovh1.ec-m.fr/">http://node.oignon.ovh1.ec-m.fr/</a></p>
<p>[3] Documentation Google API : <a href="https://developers.google.com/workspace/guides/enable-apis#sheets-api">https://developers.google.com/workspace/guides/enable-apis#sheets-api</a></p>
<style>
    a.buttonGithub {
      display: inline-block;
      padding: 15px 30px;
      background-color: #2ecc71;
      color: #fff;
      border-radius: 10px;
      border: 2px solid #2ecc71;
      text-decoration: none;
      position: relative;
      overflow: hidden;
      transition: background-color 0.3s, transform 0.3s ease-in-out;
    }

    a.buttonGithub:hover {
      background-color: #2ecc71;
      transform: translateY(-5px);
      color: #2ecc71;
    }

    a.buttonGithub span {
      position: relative;
      z-index: 1;
    }

    a.buttonGithub::before {
      content: "";
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background-color: #fff;
      transition: left 0.3s;
    }

    a.buttonGithub:hover::before {
      left: 0;
    }
  </style>


</article>

        </main>


        <footer class="min-h-[50px] border-t-2 border-gray-200 mt-4">
            <div class="max-w-[1000px] mx-auto px-4">
                <div class="min-h-[50px] flex justify-center items-center">
                    <p class="text-center">
                        <span style="font-family: Consolas, sans-serif;">Do_<span style="color: #4a86e8">It</span></span> : Développent et Organisation en IT
                    </p>
                </div>
            </div>
        </footer>

        <script>
        MathJax
            .startup
            .document
            .getMathItemsWithin(document.body);
        </script>

    </body>
</html>
